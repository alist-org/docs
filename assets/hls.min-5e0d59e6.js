function go(Ne,$t){for(var at=0;at<$t.length;at++){const _e=$t[at];if(typeof _e!="string"&&!Array.isArray(_e)){for(const Pe in _e)if(Pe!=="default"&&!(Pe in Ne)){const qe=Object.getOwnPropertyDescriptor(_e,Pe);qe&&Object.defineProperty(Ne,Pe,qe.get?qe:{enumerable:!0,get:()=>_e[Pe]})}}}return Object.freeze(Object.defineProperty(Ne,Symbol.toStringTag,{value:"Module"}))}var Qt={},vo={get exports(){return Qt},set exports(Ne){Qt=Ne}};(function(Ne,$t){(function at(_e){var Pe;Pe=function(){function qe(s,n){var e=Object.keys(s);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(s);n&&(t=t.filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable})),e.push.apply(e,t)}return e}function ne(s){for(var n=1;n<arguments.length;n++){var e=arguments[n]!=null?arguments[n]:{};n%2?qe(Object(e),!0).forEach(function(t){sa(s,t,e[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(e)):qe(Object(e)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(e,t))})}return s}function li(s,n){for(var e=0;e<n.length;e++){var t=n[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(s,di(t.key),t)}}function ee(s,n,e){return n&&li(s.prototype,n),e&&li(s,e),Object.defineProperty(s,"prototype",{writable:!1}),s}function sa(s,n,e){return(n=di(n))in s?Object.defineProperty(s,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):s[n]=e,s}function $(){return $=Object.assign?Object.assign.bind():function(s){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(s[t]=e[t])}return s},$.apply(this,arguments)}function ae(s,n){s.prototype=Object.create(n.prototype),s.prototype.constructor=s,st(s,n)}function Jt(s){return Jt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},Jt(s)}function st(s,n){return st=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},st(s,n)}function oa(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Zt(s,n,e){return Zt=oa()?Reflect.construct.bind():function(t,r,i){var a=[null];a.push.apply(a,r);var o=new(Function.bind.apply(t,a));return i&&st(o,i.prototype),o},Zt.apply(null,arguments)}function ot(s){var n=typeof Map=="function"?new Map:void 0;return ot=function(e){if(e===null||(t=e,Function.toString.call(t).indexOf("[native code]")===-1))return e;var t;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(n!==void 0){if(n.has(e))return n.get(e);n.set(e,r)}function r(){return Zt(e,arguments,Jt(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),st(r,e)},ot(s)}function ui(s,n){(n==null||n>s.length)&&(n=s.length);for(var e=0,t=new Array(n);e<n;e++)t[e]=s[e];return t}function hi(s,n){var e=typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(e)return(e=e.call(s)).next.bind(e);if(Array.isArray(s)||(e=function(r,i){if(r){if(typeof r=="string")return ui(r,i);var a=Object.prototype.toString.call(r).slice(8,-1);return a==="Object"&&r.constructor&&(a=r.constructor.name),a==="Map"||a==="Set"?Array.from(r):a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?ui(r,i):void 0}}(s))||n&&s&&typeof s.length=="number"){e&&(s=e);var t=0;return function(){return t>=s.length?{done:!0}:{done:!1,value:s[t++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function di(s){var n=function(e,t){if(typeof e!="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}(s,"string");return typeof n=="symbol"?n:String(n)}var lt={};(function(s,n){var e,t,r,i,a;e=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,t=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,i=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(o,l,h){if(h=h||{},o=o.trim(),!(l=l.trim())){if(!h.alwaysNormalize)return o;var u=a.parseURL(o);if(!u)throw new Error("Error trying to parse base URL.");return u.path=a.normalizePath(u.path),a.buildURLFromParts(u)}var d=a.parseURL(l);if(!d)throw new Error("Error trying to parse relative URL.");if(d.scheme)return h.alwaysNormalize?(d.path=a.normalizePath(d.path),a.buildURLFromParts(d)):l;var c=a.parseURL(o);if(!c)throw new Error("Error trying to parse base URL.");if(!c.netLoc&&c.path&&c.path[0]!=="/"){var f=t.exec(c.path);c.netLoc=f[1],c.path=f[2]}c.netLoc&&!c.path&&(c.path="/");var g={scheme:c.scheme,netLoc:d.netLoc,path:null,params:d.params,query:d.query,fragment:d.fragment};if(!d.netLoc&&(g.netLoc=c.netLoc,d.path[0]!=="/"))if(d.path){var m=c.path,T=m.substring(0,m.lastIndexOf("/")+1)+d.path;g.path=a.normalizePath(T)}else g.path=c.path,d.params||(g.params=c.params,d.query||(g.query=c.query));return g.path===null&&(g.path=h.alwaysNormalize?a.normalizePath(d.path):d.path),a.buildURLFromParts(g)},parseURL:function(o){var l=e.exec(o);return l?{scheme:l[1]||"",netLoc:l[2]||"",path:l[3]||"",params:l[4]||"",query:l[5]||"",fragment:l[6]||""}:null},normalizePath:function(o){for(o=o.split("").reverse().join("").replace(r,"");o.length!==(o=o.replace(i,"")).length;);return o.split("").reverse().join("")},buildURLFromParts:function(o){return o.scheme+o.netLoc+o.path+o.params+o.query+o.fragment}},s.exports=a})({get exports(){return lt},set exports(s){lt=s}});var F=Number.isFinite||function(s){return typeof s=="number"&&isFinite(s)},y=function(s){return s.MEDIA_ATTACHING="hlsMediaAttaching",s.MEDIA_ATTACHED="hlsMediaAttached",s.MEDIA_DETACHING="hlsMediaDetaching",s.MEDIA_DETACHED="hlsMediaDetached",s.BUFFER_RESET="hlsBufferReset",s.BUFFER_CODECS="hlsBufferCodecs",s.BUFFER_CREATED="hlsBufferCreated",s.BUFFER_APPENDING="hlsBufferAppending",s.BUFFER_APPENDED="hlsBufferAppended",s.BUFFER_EOS="hlsBufferEos",s.BUFFER_FLUSHING="hlsBufferFlushing",s.BUFFER_FLUSHED="hlsBufferFlushed",s.MANIFEST_LOADING="hlsManifestLoading",s.MANIFEST_LOADED="hlsManifestLoaded",s.MANIFEST_PARSED="hlsManifestParsed",s.LEVEL_SWITCHING="hlsLevelSwitching",s.LEVEL_SWITCHED="hlsLevelSwitched",s.LEVEL_LOADING="hlsLevelLoading",s.LEVEL_LOADED="hlsLevelLoaded",s.LEVEL_UPDATED="hlsLevelUpdated",s.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",s.LEVELS_UPDATED="hlsLevelsUpdated",s.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",s.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",s.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",s.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",s.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",s.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",s.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",s.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",s.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",s.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",s.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",s.CUES_PARSED="hlsCuesParsed",s.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",s.INIT_PTS_FOUND="hlsInitPtsFound",s.FRAG_LOADING="hlsFragLoading",s.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",s.FRAG_LOADED="hlsFragLoaded",s.FRAG_DECRYPTED="hlsFragDecrypted",s.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",s.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",s.FRAG_PARSING_METADATA="hlsFragParsingMetadata",s.FRAG_PARSED="hlsFragParsed",s.FRAG_BUFFERED="hlsFragBuffered",s.FRAG_CHANGED="hlsFragChanged",s.FPS_DROP="hlsFpsDrop",s.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",s.ERROR="hlsError",s.DESTROYING="hlsDestroying",s.KEY_LOADING="hlsKeyLoading",s.KEY_LOADED="hlsKeyLoaded",s.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",s.BACK_BUFFER_REACHED="hlsBackBufferReached",s}({}),N=function(s){return s.NETWORK_ERROR="networkError",s.MEDIA_ERROR="mediaError",s.KEY_SYSTEM_ERROR="keySystemError",s.MUX_ERROR="muxError",s.OTHER_ERROR="otherError",s}({}),k=function(s){return s.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",s.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",s.KEY_SYSTEM_NO_SESSION="keySystemNoSession",s.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",s.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",s.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",s.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",s.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",s.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",s.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",s.MANIFEST_LOAD_ERROR="manifestLoadError",s.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",s.MANIFEST_PARSING_ERROR="manifestParsingError",s.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",s.LEVEL_EMPTY_ERROR="levelEmptyError",s.LEVEL_LOAD_ERROR="levelLoadError",s.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",s.LEVEL_PARSING_ERROR="levelParsingError",s.LEVEL_SWITCH_ERROR="levelSwitchError",s.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",s.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",s.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",s.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",s.FRAG_LOAD_ERROR="fragLoadError",s.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",s.FRAG_DECRYPT_ERROR="fragDecryptError",s.FRAG_PARSING_ERROR="fragParsingError",s.FRAG_GAP="fragGap",s.REMUX_ALLOC_ERROR="remuxAllocError",s.KEY_LOAD_ERROR="keyLoadError",s.KEY_LOAD_TIMEOUT="keyLoadTimeOut",s.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",s.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",s.BUFFER_APPEND_ERROR="bufferAppendError",s.BUFFER_APPENDING_ERROR="bufferAppendingError",s.BUFFER_STALLED_ERROR="bufferStalledError",s.BUFFER_FULL_ERROR="bufferFullError",s.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",s.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",s.INTERNAL_EXCEPTION="internalException",s.INTERNAL_ABORTED="aborted",s.UNKNOWN="unknown",s}({}),Ue=function(){},er={trace:Ue,debug:Ue,log:Ue,warn:Ue,info:Ue,error:Ue},ut=er;function la(s){var n=self.console[s];return n?n.bind(self.console,"["+s+"] >"):Ue}function ci(s,n){if(self.console&&s===!0||typeof s=="object"){(function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];r.forEach(function(a){ut[a]=e[a]?e[a].bind(e):la(a)})})(s,"debug","log","info","warn","error");try{ut.log('Debug logs enabled for "'+n+'" in hls.js version 1.4.0')}catch{ut=er}}else ut=er}var R=ut,ua=/^(\d+)x(\d+)$/,fi=/(.+?)=(".*?"|.*?)(?:,|$)/g,X=function(){function s(e){for(var t in typeof e=="string"&&(e=s.parseAttrList(e)),e)e.hasOwnProperty(t)&&(t.substring(0,2)==="X-"&&(this.clientAttrs=this.clientAttrs||[],this.clientAttrs.push(t)),this[t]=e[t])}var n=s.prototype;return n.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},n.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var r=new Uint8Array(t.length/2),i=0;i<t.length/2;i++)r[i]=parseInt(t.slice(2*i,2*i+2),16);return r}return null},n.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},n.decimalFloatingPoint=function(e){return parseFloat(this[e])},n.optionalFloat=function(e,t){var r=this[e];return r?parseFloat(r):t},n.enumeratedString=function(e){return this[e]},n.bool=function(e){return this[e]==="YES"},n.decimalResolution=function(e){var t=ua.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},s.parseAttrList=function(e){var t,r={};for(fi.lastIndex=0;(t=fi.exec(e))!==null;){var i=t[2];i.indexOf('"')===0&&i.lastIndexOf('"')===i.length-1&&(i=i.slice(1,-1)),r[t[1].trim()]=i}return r},s}();function ha(s){return s==="SCTE35-OUT"||s==="SCTE35-IN"}var gi=function(){function s(n,e){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,e){var t=e.attr;for(var r in t)if(Object.prototype.hasOwnProperty.call(n,r)&&n[r]!==t[r]){R.warn('DATERANGE tag attribute: "'+r+'" does not match for tags with ID: "'+n.ID+'"'),this._badValueForSameId=r;break}n=$(new X({}),t,n)}if(this.attr=n,this._startDate=new Date(n["START-DATE"]),"END-DATE"in this.attr){var i=new Date(this.attr["END-DATE"]);F(i.getTime())&&(this._endDate=i)}}return ee(s,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var n=this.duration;return n!==null?new Date(this._startDate.getTime()+1e3*n):null}},{key:"duration",get:function(){if("DURATION"in this.attr){var n=this.attr.decimalFloatingPoint("DURATION");if(F(n))return n}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}},{key:"endOnNext",get:function(){return this.attr.bool("END-ON-NEXT")}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&F(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),s}(),Rt=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}},se="audio",me="video",tr="audiovideo",vi=function(){function s(n){var e;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((e={})[se]=null,e[me]=null,e[tr]=null,e),this.baseurl=n}return s.prototype.setByteRange=function(n,e){var t=n.split("@",2),r=[];t.length===1?r[0]=e?e.byteRangeEndOffset:0:r[0]=parseInt(t[1]),r[1]=parseInt(t[0])+r[0],this._byteRange=r},ee(s,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=lt.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(n){this._url=n}}]),s}(),rr=function(s){function n(t,r){var i;return(i=s.call(this,r)||this)._decryptdata=null,i.rawProgramDateTime=null,i.programDateTime=null,i.tagList=[],i.duration=0,i.sn=0,i.levelkeys=void 0,i.type=void 0,i.loader=null,i.keyLoader=null,i.level=-1,i.cc=0,i.startPTS=void 0,i.endPTS=void 0,i.startDTS=void 0,i.endDTS=void 0,i.start=0,i.deltaPTS=void 0,i.maxStartPTS=void 0,i.minEndPTS=void 0,i.stats=new Rt,i.urlId=0,i.data=void 0,i.bitrateTest=!1,i.title=null,i.initSegment=null,i.endList=void 0,i.gap=void 0,i.type=t,i}ae(n,s);var e=n.prototype;return e.setKeyFormat=function(t){if(this.levelkeys){var r=this.levelkeys[t];r&&!this._decryptdata&&(this._decryptdata=r.getDecryptData(this.sn))}},e.abortRequests=function(){var t,r;(t=this.loader)==null||t.abort(),(r=this.keyLoader)==null||r.abort()},e.setElementaryStreamInfo=function(t,r,i,a,o,l){l===void 0&&(l=!1);var h=this.elementaryStreams,u=h[t];u?(u.startPTS=Math.min(u.startPTS,r),u.endPTS=Math.max(u.endPTS,i),u.startDTS=Math.min(u.startDTS,a),u.endDTS=Math.max(u.endDTS,o)):h[t]={startPTS:r,endPTS:i,startDTS:a,endDTS:o,partial:l}},e.clearElementaryStreamInfo=function(){var t=this.elementaryStreams;t[se]=null,t[me]=null,t[tr]=null},ee(n,[{key:"decryptdata",get:function(){if(!this.levelkeys&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{var r=Object.keys(this.levelkeys);if(r.length===1)return this._decryptdata=this.levelkeys[r[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!F(this.programDateTime))return null;var t=F(this.duration)?this.duration:0;return this.programDateTime+1e3*t}},{key:"encrypted",get:function(){var t;if((t=this._decryptdata)!=null&&t.encrypted)return!0;if(this.levelkeys){var r=Object.keys(this.levelkeys),i=r.length;if(i>1||i===1&&this.levelkeys[r[0]].encrypted)return!0}return!1}}]),n}(vi),da=function(s){function n(e,t,r,i,a){var o;(o=s.call(this,r)||this).fragOffset=0,o.duration=0,o.gap=!1,o.independent=!1,o.relurl=void 0,o.fragment=void 0,o.index=void 0,o.stats=new Rt,o.duration=e.decimalFloatingPoint("DURATION"),o.gap=e.bool("GAP"),o.independent=e.bool("INDEPENDENT"),o.relurl=e.enumeratedString("URI"),o.fragment=t,o.index=i;var l=e.enumeratedString("BYTERANGE");return l&&o.setByteRange(l,a),a&&(o.fragOffset=a.fragOffset+a.duration),o}return ae(n,s),ee(n,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var e=this.elementaryStreams;return!!(e.audio||e.video||e.audiovideo)}}]),n}(vi),ca=function(){function s(n){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=n}return s.prototype.reloaded=function(n){if(!n)return this.advanced=!0,void(this.updated=!0);var e=this.lastPartSn-n.lastPartSn,t=this.lastPartIndex-n.lastPartIndex;this.updated=this.endSN!==n.endSN||!!t||!!e,this.advanced=this.endSN>n.endSN||e>0||e===0&&t>0,this.updated||this.advanced?this.misses=Math.floor(.6*n.misses):this.misses=n.misses+1,this.availabilityDelay=n.availabilityDelay},ee(s,[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&F(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var n=this.driftEndTime-this.driftStartTime;return n>0?1e3*(this.driftEnd-this.driftStart)/n:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var n;return(n=this.partList)!=null&&n.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var n;return(n=this.fragments)!=null&&n.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var n;return(n=this.partList)!=null&&n.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var n;return(n=this.partList)!=null&&n.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),s}();function ir(s){return Uint8Array.from(atob(s),function(n){return n.charCodeAt(0)})}function fa(s){var n,e,t=s.split(":"),r=null;if(t[0]==="data"&&t.length===2){var i=t[1].split(";"),a=i[i.length-1].split(",");if(a.length===2){var o=a[0]==="base64",l=a[1];o?(i.splice(-1,1),r=ir(l)):(n=mi(l).subarray(0,16),(e=new Uint8Array(16)).set(n,16-n.length),r=e)}}return r}function mi(s){return Uint8Array.from(unescape(encodeURIComponent(s)),function(n){return n.charCodeAt(0)})}var z={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},nr="org.w3.clearkey",ar="com.apple.streamingkeydelivery",At="com.microsoft.playready",bt="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function pi(s){switch(s){case ar:return z.FAIRPLAY;case At:return z.PLAYREADY;case bt:return z.WIDEVINE;case nr:return z.CLEARKEY}}var yi="edef8ba979d64acea3c827dcd51d21ed";function Ti(s){switch(s){case z.FAIRPLAY:return ar;case z.PLAYREADY:return At;case z.WIDEVINE:return bt;case z.CLEARKEY:return nr}}function sr(s){var n=s.drmSystems,e=s.widevineLicenseUrl,t=n?[z.FAIRPLAY,z.WIDEVINE,z.PLAYREADY,z.CLEARKEY].filter(function(r){return!!n[r]}):[];return!t[z.WIDEVINE]&&e&&t.push(z.WIDEVINE),t}var Ei=typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function Be(s,n,e){return Uint8Array.prototype.slice?s.slice(n,e):new Uint8Array(Array.prototype.slice.call(s,n,e))}var or,lr=function(s,n){return n+10<=s.length&&s[n]===73&&s[n+1]===68&&s[n+2]===51&&s[n+3]<255&&s[n+4]<255&&s[n+6]<128&&s[n+7]<128&&s[n+8]<128&&s[n+9]<128},Si=function(s,n){return n+10<=s.length&&s[n]===51&&s[n+1]===68&&s[n+2]===73&&s[n+3]<255&&s[n+4]<255&&s[n+6]<128&&s[n+7]<128&&s[n+8]<128&&s[n+9]<128},kt=function(s,n){for(var e=n,t=0;lr(s,n);)t+=10,t+=Dt(s,n+6),Si(s,n+10)&&(t+=10),n+=t;if(t>0)return s.subarray(e,e+t)},Dt=function(s,n){var e=0;return e=(127&s[n])<<21,e|=(127&s[n+1])<<14,e|=(127&s[n+2])<<7,e|=127&s[n+3]},ga=function(s,n){return lr(s,n)&&Dt(s,n+6)+10<=s.length-n},Li=function(s){return s&&s.key==="PRIV"&&s.info==="com.apple.streaming.transportStreamTimestamp"},va=function(s){var n=String.fromCharCode(s[0],s[1],s[2],s[3]),e=Dt(s,4);return{type:n,size:e,data:s.subarray(10,10+e)}},Ri=function(s){for(var n=0,e=[];lr(s,n);){for(var t=Dt(s,n+6),r=(n+=10)+t;n+8<r;){var i=va(s.subarray(n)),a=ma(i);a&&e.push(a),n+=i.size+10}Si(s,n)&&(n+=10)}return e},ma=function(s){return s.type==="PRIV"?pa(s):s.type[0]==="W"?Ta(s):ya(s)},pa=function(s){if(!(s.size<2)){var n=Te(s.data,!0),e=new Uint8Array(s.data.subarray(n.length+1));return{key:s.type,info:n,data:e.buffer}}},ya=function(s){if(!(s.size<2)){if(s.type==="TXXX"){var n=1,e=Te(s.data.subarray(n),!0);n+=e.length+1;var t=Te(s.data.subarray(n));return{key:s.type,info:e,data:t}}var r=Te(s.data.subarray(1));return{key:s.type,data:r}}},Ta=function(s){if(s.type==="WXXX"){if(s.size<2)return;var n=1,e=Te(s.data.subarray(n),!0);n+=e.length+1;var t=Te(s.data.subarray(n));return{key:s.type,info:e,data:t}}var r=Te(s.data);return{key:s.type,data:r}},Ea=function(s){if(s.data.byteLength===8){var n=new Uint8Array(s.data),e=1&n[3],t=(n[4]<<23)+(n[5]<<15)+(n[6]<<7)+n[7];return t/=45,e&&(t+=4772185884e-2),Math.round(t)}},Te=function(s,n){n===void 0&&(n=!1);var e=Sa();if(e){var t=e.decode(s);if(n){var r=t.indexOf("\0");return r!==-1?t.substring(0,r):t}return t.replace(/\0/g,"")}for(var i,a,o,l=s.length,h="",u=0;u<l;){if((i=s[u++])===0&&n)return h;if(i!==0&&i!==3)switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:h+=String.fromCharCode(i);break;case 12:case 13:a=s[u++],h+=String.fromCharCode((31&i)<<6|63&a);break;case 14:a=s[u++],o=s[u++],h+=String.fromCharCode((15&i)<<12|(63&a)<<6|(63&o)<<0)}}return h};function Sa(){return or||self.TextDecoder===void 0||(or=new self.TextDecoder("utf-8")),or}var Ee=function(s){for(var n="",e=0;e<s.length;e++){var t=s[e].toString(16);t.length<2&&(t="0"+t),n+=t}return n},It=Math.pow(2,32)-1,La=[].push,Ai={video:1,audio:2,id3:3,text:4};function te(s){return String.fromCharCode.apply(null,s)}function bi(s,n){var e=s[n]<<8|s[n+1];return e<0?65536+e:e}function G(s,n){var e=ki(s,n);return e<0?4294967296+e:e}function ki(s,n){return s[n]<<24|s[n+1]<<16|s[n+2]<<8|s[n+3]}function ur(s,n,e){s[n]=e>>24,s[n+1]=e>>16&255,s[n+2]=e>>8&255,s[n+3]=255&e}function W(s,n){var e=[];if(!n.length)return e;for(var t=s.byteLength,r=0;r<t;){var i=G(s,r),a=i>1?r+i:t;if(te(s.subarray(r+4,r+8))===n[0])if(n.length===1)e.push(s.subarray(r+8,a));else{var o=W(s.subarray(r+8,a),n.slice(1));o.length&&La.apply(e,o)}r=a}return e}function Ra(s){var n=[],e=s[0],t=8,r=G(s,t);t+=4,t+=e===0?8:16,t+=2;var i=s.length+0,a=bi(s,t);t+=2;for(var o=0;o<a;o++){var l=t,h=G(s,l);l+=4;var u=2147483647&h;if((2147483648&h)>>>31==1)return R.warn("SIDX has hierarchical references (not supported)"),null;var d=G(s,l);l+=4,n.push({referenceSize:u,subsegmentDuration:d,info:{duration:d/r,start:i,end:i+u-1}}),i+=u,t=l+=4}return{earliestPresentationTime:0,timescale:r,version:e,referencesCount:a,references:n}}function Di(s){for(var n=[],e=W(s,["moov","trak"]),t=0;t<e.length;t++){var r=e[t],i=W(r,["tkhd"])[0];if(i){var a=i[0],o=a===0?12:20,l=G(i,o),h=W(r,["mdia","mdhd"])[0];if(h){var u=G(h,o=(a=h[0])===0?12:20),d=W(r,["mdia","hdlr"])[0];if(d){var c=te(d.subarray(8,12)),f={soun:se,vide:me}[c];if(f){var g=W(r,["mdia","minf","stbl","stsd"])[0],m=void 0;g&&(m=te(g.subarray(12,16))),n[l]={timescale:u,type:f},n[f]={timescale:u,id:l,codec:m}}}}}}return W(s,["moov","mvex","trex"]).forEach(function(T){var v=G(T,4),p=n[v];p&&(p.default={duration:G(T,12),flags:G(T,20)})}),n}function Ii(s){var n=W(s,["schm"])[0];if(n){var e=te(n.subarray(4,8));if(e==="cbcs"||e==="cenc")return W(s,["schi","tenc"])[0]}return R.error("[eme] missing 'schm' box"),null}function Aa(s){var n=G(s,0),e=8;1&n&&(e+=4),4&n&&(e+=4);for(var t=0,r=G(s,4),i=0;i<r;i++)256&n&&(t+=G(s,e),e+=4),512&n&&(e+=4),1024&n&&(e+=4),2048&n&&(e+=4);return t}function Ge(s,n){var e=new Uint8Array(s.length+n.length);return e.set(s),e.set(n,s.length),e}function wi(s,n){var e=[],t=n.samples,r=n.timescale,i=n.id,a=!1;return W(t,["moof"]).map(function(o){var l=o.byteOffset-8;W(o,["traf"]).map(function(h){var u=W(h,["tfdt"]).map(function(d){var c=d[0],f=G(d,4);return c===1&&(f*=Math.pow(2,32),f+=G(d,8)),f/r})[0];return u!==void 0&&(s=u),W(h,["tfhd"]).map(function(d){var c=G(d,4),f=16777215&G(d,0),g=0,m=(16&f)!=0,T=0,v=(32&f)!=0,p=8;c===i&&(1&f&&(p+=8),2&f&&(p+=4),8&f&&(g=G(d,p),p+=4),m&&(T=G(d,p),p+=4),v&&(p+=4),n.type==="video"&&(a=function(S){if(!S)return!1;var E=S.indexOf("."),L=E<0?S:S.substring(0,E);return L==="hvc1"||L==="hev1"||L==="dvh1"||L==="dvhe"}(n.codec)),W(h,["trun"]).map(function(S){var E=S[0],L=16777215&G(S,0),A=(1&L)!=0,b=0,w=(4&L)!=0,D=(256&L)!=0,I=0,_=(512&L)!=0,C=0,x=(1024&L)!=0,B=(2048&L)!=0,P=0,O=G(S,4),U=8;A&&(b=G(S,U),U+=4),w&&(U+=4);for(var M=b+l,K=0;K<O;K++){if(D?(I=G(S,U),U+=4):I=g,_?(C=G(S,U),U+=4):C=T,x&&(U+=4),B&&(P=E===0?G(S,U):ki(S,U),U+=4),n.type===me)for(var H=0;H<C;){var Y=G(t,M);ba(a,t[M+=4])&&Ci(t.subarray(M,M+Y),a?2:1,s+P/r,e),M+=Y,H+=Y+4}s+=I/r}}))})})}),e}function ba(s,n){if(s){var e=n>>1&63;return e===39||e===40}return(31&n)==6}function Ci(s,n,e,t){var r=_i(s),i=0;i+=n;for(var a=0,o=0,l=!1,h=0;i<r.length;){a=0;do{if(i>=r.length)break;a+=h=r[i++]}while(h===255);o=0;do{if(i>=r.length)break;o+=h=r[i++]}while(h===255);var u=r.length-i;if(!l&&a===4&&i<r.length){if(l=!0,r[i++]===181){var d=bi(r,i);if(i+=2,d===49){var c=G(r,i);if(i+=4,c===1195456820){var f=r[i++];if(f===3){var g=r[i++],m=64&g,T=m?2+3*(31&g):0,v=new Uint8Array(T);if(m){v[0]=g;for(var p=1;p<T;p++)v[p]=r[i++]}t.push({type:f,payloadType:a,pts:e,bytes:v})}}}}}else if(a===5&&o<u){if(l=!0,o>16){for(var S=[],E=0;E<16;E++){var L=r[i++].toString(16);S.push(L.length==1?"0"+L:L),E!==3&&E!==5&&E!==7&&E!==9||S.push("-")}for(var A=o-16,b=new Uint8Array(A),w=0;w<A;w++)b[w]=r[i++];t.push({payloadType:a,pts:e,uuid:S.join(""),userData:Te(b),userDataBytes:b})}}else if(o<u)i+=o;else if(o>u)break}}function _i(s){for(var n=s.byteLength,e=[],t=1;t<n-2;)s[t]===0&&s[t+1]===0&&s[t+2]===3?(e.push(t+2),t+=2):t++;if(e.length===0)return s;var r=n-e.length,i=new Uint8Array(r),a=0;for(t=0;t<r;a++,t++)a===e[0]&&(a++,e.shift()),i[t]=s[a];return i}function ka(s,n,e){if(s.byteLength!==16)throw new RangeError("Invalid system id");var t,r,i;if(n){t=1,r=new Uint8Array(16*n.length);for(var a=0;a<n.length;a++){var o=n[a];if(o.byteLength!==16)throw new RangeError("Invalid key");r.set(o,16*a)}}else t=0,r=new Uint8Array;t>0?(i=new Uint8Array(4),n.length>0&&new DataView(i.buffer).setUint32(0,n.length,!1)):i=new Uint8Array;var l=new Uint8Array(4);return e&&e.byteLength>0&&new DataView(l.buffer).setUint32(0,e.byteLength,!1),function(h){for(var u=arguments.length,d=new Array(u>1?u-1:0),c=1;c<u;c++)d[c-1]=arguments[c];for(var f=d.length,g=8,m=f;m--;)g+=d[m].byteLength;var T=new Uint8Array(g);for(T[0]=g>>24&255,T[1]=g>>16&255,T[2]=g>>8&255,T[3]=255&g,T.set(h,4),m=0,g=8;m<f;m++)T.set(d[m],g),g+=d[m].byteLength;return T}([112,115,115,104],new Uint8Array([t,0,0,0]),s,i,r,l,e||new Uint8Array)}var wt={},hr=function(){function s(e,t,r,i,a){i===void 0&&(i=[1]),a===void 0&&(a=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=i,this.iv=a,this.encrypted=!!e&&e!=="NONE",this.isCommonEncryption=this.encrypted&&e!=="AES-128"}s.clearKeyUriToKeyIdMap=function(){wt={}};var n=s.prototype;return n.isSupported=function(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case ar:case bt:case At:case nr:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1},n.getDecryptData=function(e){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof e!="number"&&(this.method!=="AES-128"||this.iv||R.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),e=0);var t=function(T){for(var v=new Uint8Array(16),p=12;p<16;p++)v[p]=T>>8*(15-p)&255;return v}(e);return new s(this.method,this.uri,"identity",this.keyFormatVersions,t)}var r=fa(this.uri);if(r)switch(this.keyFormat){case bt:this.pssh=r,r.length>=22&&(this.keyId=r.subarray(r.length-22,r.length-6));break;case At:var i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=ka(i,null,r);var a=new Uint16Array(r.buffer,r.byteOffset,r.byteLength/2),o=String.fromCharCode.apply(null,Array.from(a)),l=o.substring(o.indexOf("<"),o.length),h=new DOMParser().parseFromString(l,"text/xml").getElementsByTagName("KID")[0];if(h){var u=h.childNodes[0]?h.childNodes[0].nodeValue:h.getAttribute("VALUE");if(u){var d=ir(u).subarray(0,16);(function(T){var v=function(p,S,E){var L=p[S];p[S]=p[E],p[E]=L};v(T,0,3),v(T,1,2),v(T,4,5),v(T,6,7)})(d),this.keyId=d}}break;default:var c=r.subarray(0,16);if(c.length!==16){var f=new Uint8Array(16);f.set(c,16-c.length),c=f}this.keyId=c}if(!this.keyId||this.keyId.byteLength!==16){var g=wt[this.uri];if(!g){var m=Object.keys(wt).length%Number.MAX_SAFE_INTEGER;g=new Uint8Array(16),new DataView(g.buffer,12,4).setUint32(0,m),wt[this.uri]=g}this.keyId=g}return this},s}(),Pi=/\{\$([a-zA-Z0-9-_]+)\}/g;function xi(s){return Pi.test(s)}function oe(s,n,e){if(s.variableList!==null||s.hasVariableRefs)for(var t=e.length;t--;){var r=e[t],i=n[r];i&&(n[r]=dr(s,i))}}function dr(s,n){if(s.variableList!==null||s.hasVariableRefs){var e=s.variableList;return n.replace(Pi,function(t){var r=t.substring(2,t.length-1),i=e==null?void 0:e[r];return i===void 0?(s.playlistParsingError||(s.playlistParsingError=new Error('Missing preceding EXT-X-DEFINE tag for Variable Reference: "'+r+'"')),t):i})}return n}function Fi(s,n,e){var t,r,i=s.variableList;if(i||(s.variableList=i={}),"QUERYPARAM"in n){t=n.QUERYPARAM;try{var a=new self.URL(e).searchParams;if(!a.has(t))throw new Error('"'+t+'" does not match any query parameter in URI: "'+e+'"');r=a.get(t)}catch(o){s.playlistParsingError||(s.playlistParsingError=new Error("EXT-X-DEFINE QUERYPARAM: "+o.message))}}else t=n.NAME,r=n.VALUE;t in i?s.playlistParsingError||(s.playlistParsingError=new Error('EXT-X-DEFINE duplicate Variable Name declarations: "'+t+'"')):i[t]=r||""}function Da(s,n,e){var t=n.IMPORT;if(e&&t in e){var r=s.variableList;r||(s.variableList=r={}),r[t]=e[t]}else s.playlistParsingError||(s.playlistParsingError=new Error('EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "'+t+'"'))}var Ia={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function cr(s,n){return MediaSource.isTypeSupported((n||"video")+'/mp4;codecs="'+s+'"')}var Oi=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Mi=/#EXT-X-MEDIA:(.*)/g,wa=/^#EXT(?:INF|-X-TARGETDURATION):/m,Ni=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),Ca=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),ht=function(){function s(){}return s.findGroup=function(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(r.id===e)return r}},s.convertAVC1ToAVCOTI=function(n){var e=n.split(".");if(e.length>2){var t=e.shift()+".";return t+=parseInt(e.shift()).toString(16),t+=("000"+parseInt(e.shift()).toString(16)).slice(-4)}return n},s.resolve=function(n,e){return lt.buildAbsoluteURL(e,n,{alwaysNormalize:!0})},s.isMediaPlaylist=function(n){return wa.test(n)},s.parseMasterPlaylist=function(n,e){var t,r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:xi(n)},i=[];for(Oi.lastIndex=0;(t=Oi.exec(n))!=null;)if(t[1]){var a,o=new X(t[1]);oe(r,o,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);var l=dr(r,t[2]),h={attrs:o,bitrate:o.decimalInteger("AVERAGE-BANDWIDTH")||o.decimalInteger("BANDWIDTH"),name:o.NAME,url:s.resolve(l,e)},u=o.decimalResolution("RESOLUTION");u&&(h.width=u.width,h.height=u.height),_a((o.CODECS||"").split(/[ ,]+/).filter(function(S){return S}),h),h.videoCodec&&h.videoCodec.indexOf("avc1")!==-1&&(h.videoCodec=s.convertAVC1ToAVCOTI(h.videoCodec)),(a=h.unknownCodecs)!=null&&a.length||i.push(h),r.levels.push(h)}else if(t[3]){var d=t[3],c=t[4];switch(d){case"SESSION-DATA":var f=new X(c);oe(r,f,["DATA-ID","LANGUAGE","VALUE","URI"]);var g=f["DATA-ID"];g&&(r.sessionData===null&&(r.sessionData={}),r.sessionData[g]=f);break;case"SESSION-KEY":var m=Ui(c,e,r);m.encrypted&&m.isSupported()?(r.sessionKeys===null&&(r.sessionKeys=[]),r.sessionKeys.push(m)):R.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+c+'"');break;case"DEFINE":var T=new X(c);oe(r,T,["NAME","VALUE","QUERYPARAM"]),Fi(r,T,e);break;case"CONTENT-STEERING":var v=new X(c);oe(r,v,["SERVER-URI","PATHWAY-ID"]),r.contentSteering={uri:s.resolve(v["SERVER-URI"],e),pathwayId:v["PATHWAY-ID"]||"."};break;case"START":r.startTimeOffset=Bi(c)}}var p=i.length>0&&i.length<r.levels.length;return r.levels=p?i:r.levels,r.levels.length===0&&(r.playlistParsingError=new Error("no levels found in manifest")),r},s.parseMasterPlaylistMedia=function(n,e,t){var r,i={},a=t.levels,o={AUDIO:a.map(function(m){return{id:m.attrs.AUDIO,audioCodec:m.audioCodec}}),SUBTITLES:a.map(function(m){return{id:m.attrs.SUBTITLES,textCodec:m.textCodec}}),"CLOSED-CAPTIONS":[]},l=0;for(Mi.lastIndex=0;(r=Mi.exec(n))!==null;){var h=new X(r[1]),u=h.TYPE;if(u){var d=o[u],c=i[u]||[];i[u]=c,oe(t,h,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);var f={attrs:h,bitrate:0,id:l++,groupId:h["GROUP-ID"]||"",instreamId:h["INSTREAM-ID"],name:h.NAME||h.LANGUAGE||"",type:u,default:h.bool("DEFAULT"),autoselect:h.bool("AUTOSELECT"),forced:h.bool("FORCED"),lang:h.LANGUAGE,url:h.URI?s.resolve(h.URI,e):""};if(d!=null&&d.length){var g=s.findGroup(d,f.groupId)||d[0];Gi(f,g,"audioCodec"),Gi(f,g,"textCodec")}c.push(f)}}return i},s.parseLevelPlaylist=function(n,e,t,r,i,a){var o,l,h,u=new ca(e),d=u.fragments,c=null,f=0,g=0,m=0,T=0,v=null,p=new rr(r,e),S=-1,E=!1;for(Ni.lastIndex=0,u.m3u8=n,u.hasVariableRefs=xi(n);(o=Ni.exec(n))!==null;){E&&(E=!1,(p=new rr(r,e)).start=m,p.sn=f,p.cc=T,p.level=t,c&&(p.initSegment=c,p.rawProgramDateTime=c.rawProgramDateTime,c.rawProgramDateTime=null));var L=o[1];if(L){p.duration=parseFloat(L);var A=(" "+o[2]).slice(1);p.title=A||null,p.tagList.push(A?["INF",L,A]:["INF",L])}else if(o[3]){if(F(p.duration)){p.start=m,h&&Vi(p,h,u),p.sn=f,p.level=t,p.cc=T,p.urlId=i,d.push(p);var b=(" "+o[3]).slice(1);p.relurl=dr(u,b),Ki(p,v),v=p,m+=p.duration,f++,g=0,E=!0}}else if(o[4]){var w=(" "+o[4]).slice(1);v?p.setByteRange(w,v):p.setByteRange(w)}else if(o[5])p.rawProgramDateTime=(" "+o[5]).slice(1),p.tagList.push(["PROGRAM-DATE-TIME",p.rawProgramDateTime]),S===-1&&(S=d.length);else{if(!(o=o[0].match(Ca))){R.warn("No matches on slow regex match for level playlist!");continue}for(l=1;l<o.length&&o[l]===void 0;l++);var D=(" "+o[l]).slice(1),I=(" "+o[l+1]).slice(1),_=o[l+2]?(" "+o[l+2]).slice(1):"";switch(D){case"PLAYLIST-TYPE":u.type=I.toUpperCase();break;case"MEDIA-SEQUENCE":f=u.startSN=parseInt(I);break;case"SKIP":var C=new X(I);oe(u,C,["RECENTLY-REMOVED-DATERANGES"]);var x=C.decimalInteger("SKIPPED-SEGMENTS");if(F(x)){u.skippedSegments=x;for(var B=x;B--;)d.unshift(null);f+=x}var P=C.enumeratedString("RECENTLY-REMOVED-DATERANGES");P&&(u.recentlyRemovedDateranges=P.split("	"));break;case"TARGETDURATION":u.targetduration=Math.max(parseInt(I),1);break;case"VERSION":u.version=parseInt(I);break;case"EXTM3U":break;case"ENDLIST":u.live=!1;break;case"#":(I||_)&&p.tagList.push(_?[I,_]:[I]);break;case"DISCONTINUITY":T++,p.tagList.push(["DIS"]);break;case"GAP":p.gap=!0,p.tagList.push([D]);break;case"BITRATE":p.tagList.push([D,I]);break;case"DATERANGE":var O=new X(I);oe(u,O,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),oe(u,O,O.clientAttrs);var U=new gi(O,u.dateRanges[O.ID]);U.isValid||u.skippedSegments?u.dateRanges[U.id]=U:R.warn('Ignoring invalid DATERANGE tag: "'+I+'"'),p.tagList.push(["EXT-X-DATERANGE",I]);break;case"DEFINE":var M=new X(I);oe(u,M,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in M?Da(u,M,a):Fi(u,M,e);break;case"DISCONTINUITY-SEQUENCE":T=parseInt(I);break;case"KEY":var K=Ui(I,e,u);if(K.isSupported()){if(K.method==="NONE"){h=void 0;break}h||(h={}),h[K.keyFormat]&&(h=$({},h)),h[K.keyFormat]=K}else R.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+I+'"');break;case"START":u.startTimeOffset=Bi(I);break;case"MAP":var H=new X(I);if(oe(u,H,["BYTERANGE","URI"]),p.duration){var Y=new rr(r,e);Hi(Y,H,t,h),c=Y,p.initSegment=c,c.rawProgramDateTime&&!p.rawProgramDateTime&&(p.rawProgramDateTime=c.rawProgramDateTime)}else Hi(p,H,t,h),c=p,E=!0;break;case"SERVER-CONTROL":var q=new X(I);u.canBlockReload=q.bool("CAN-BLOCK-RELOAD"),u.canSkipUntil=q.optionalFloat("CAN-SKIP-UNTIL",0),u.canSkipDateRanges=u.canSkipUntil>0&&q.bool("CAN-SKIP-DATERANGES"),u.partHoldBack=q.optionalFloat("PART-HOLD-BACK",0),u.holdBack=q.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var le=new X(I);u.partTarget=le.decimalFloatingPoint("PART-TARGET");break;case"PART":var J=u.partList;J||(J=u.partList=[]);var pe=g>0?J[J.length-1]:void 0,ge=g++,ve=new X(I);oe(u,ve,["BYTERANGE","URI"]);var Z=new da(ve,p,e,ge,pe);J.push(Z),p.duration+=Z.duration;break;case"PRELOAD-HINT":var ie=new X(I);oe(u,ie,["URI"]),u.preloadHint=ie;break;case"RENDITION-REPORT":var Ae=new X(I);oe(u,Ae,["URI"]),u.renditionReports=u.renditionReports||[],u.renditionReports.push(Ae);break;default:R.warn("line parsed but not handled: "+o)}}}v&&!v.relurl?(d.pop(),m-=v.duration,u.partList&&(u.fragmentHint=v)):u.partList&&(Ki(p,v),p.cc=T,u.fragmentHint=p,h&&Vi(p,h,u));var Me=d.length,he=d[0],Et=d[Me-1];if((m+=u.skippedSegments*u.targetduration)>0&&Me&&Et){u.averagetargetduration=m/Me;var St=Et.sn;u.endSN=St!=="initSegment"?St:0,u.live||(Et.endList=!0),he&&(u.startCC=he.cc)}else u.endSN=0,u.startCC=0;return u.fragmentHint&&(m+=u.fragmentHint.duration),u.totalduration=m,u.endCC=T,S>0&&function(zt,nt){for(var je=zt[nt],Lt=nt;Lt--;){var Ce=zt[Lt];if(!Ce)return;Ce.programDateTime=je.programDateTime-1e3*Ce.duration,je=Ce}}(d,S),u},s}();function Ui(s,n,e){var t,r,i=new X(s);oe(e,i,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);var a=(t=i.METHOD)!=null?t:"",o=i.URI,l=i.hexadecimalInteger("IV"),h=i.KEYFORMATVERSIONS,u=(r=i.KEYFORMAT)!=null?r:"identity";o&&i.IV&&!l&&R.error("Invalid IV: "+i.IV);var d=o?ht.resolve(o,n):"",c=(h||"1").split("/").map(Number).filter(Number.isFinite);return new hr(a,d,u,c,l)}function Bi(s){var n=new X(s).decimalFloatingPoint("TIME-OFFSET");return F(n)?n:null}function _a(s,n){["video","audio","text"].forEach(function(e){var t=s.filter(function(i){return function(a,o){var l=Ia[o];return!!l&&l[a.slice(0,4)]===!0}(i,e)});if(t.length){var r=t.filter(function(i){return i.lastIndexOf("avc1",0)===0||i.lastIndexOf("mp4a",0)===0});n[e+"Codec"]=r.length>0?r[0]:t[0],s=s.filter(function(i){return t.indexOf(i)===-1})}}),n.unknownCodecs=s}function Gi(s,n,e){var t=n[e];t&&(s[e]=t)}function Ki(s,n){s.rawProgramDateTime?s.programDateTime=Date.parse(s.rawProgramDateTime):n!=null&&n.programDateTime&&(s.programDateTime=n.endProgramDateTime),F(s.programDateTime)||(s.programDateTime=null,s.rawProgramDateTime=null)}function Hi(s,n,e,t){s.relurl=n.URI,n.BYTERANGE&&s.setByteRange(n.BYTERANGE),s.level=e,s.sn="initSegment",t&&(s.levelkeys=t),s.initSegment=null}function Vi(s,n,e){s.levelkeys=n;var t=e.encryptedFragments;t.length&&t[t.length-1].levelkeys===n||!Object.keys(n).some(function(r){return n[r].isCommonEncryption})||t.push(s)}var ze="manifest",Ke="level",Se="audioTrack",be="subtitleTrack",j="main",Le="audio",xe="subtitle";function Yi(s){switch(s.type){case Se:return Le;case be:return xe;default:return j}}function fr(s,n){var e=s.url;return e!==void 0&&e.indexOf("data:")!==0||(e=n.url),e}var Pa=function(){function s(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}var n=s.prototype;return n.startLoad=function(e){},n.stopLoad=function(){this.destroyInternalLoaders()},n.registerListeners=function(){var e=this.hls;e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.LEVEL_LOADING,this.onLevelLoading,this),e.on(y.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(y.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},n.unregisterListeners=function(){var e=this.hls;e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.LEVEL_LOADING,this.onLevelLoading,this),e.off(y.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(y.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},n.createInternalLoader=function(e){var t=this.hls.config,r=t.pLoader,i=t.loader,a=new(r||i)(t);return this.loaders[e.type]=a,a},n.getInternalLoader=function(e){return this.loaders[e.type]},n.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},n.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},n.destroy=function(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()},n.onManifestLoading=function(e,t){var r=t.url;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:ze,url:r,deliveryDirectives:null})},n.onLevelLoading=function(e,t){var r=t.id,i=t.level,a=t.url,o=t.deliveryDirectives;this.load({id:r,level:i,responseType:"text",type:Ke,url:a,deliveryDirectives:o})},n.onAudioTrackLoading=function(e,t){var r=t.id,i=t.groupId,a=t.url,o=t.deliveryDirectives;this.load({id:r,groupId:i,level:null,responseType:"text",type:Se,url:a,deliveryDirectives:o})},n.onSubtitleTrackLoading=function(e,t){var r=t.id,i=t.groupId,a=t.url,o=t.deliveryDirectives;this.load({id:r,groupId:i,level:null,responseType:"text",type:be,url:a,deliveryDirectives:o})},n.load=function(e){var t,r,i,a=this,o=this.hls.config,l=this.getInternalLoader(e);if(l){var h=l.context;if(h&&h.url===e.url)return void R.trace("[playlist-loader]: playlist request ongoing");R.log("[playlist-loader]: aborting previous loader for type: "+e.type),l.abort()}if(r=e.type===ze?o.manifestLoadPolicy.default:$({},o.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),l=this.createInternalLoader(e),(t=e.deliveryDirectives)!=null&&t.part&&(e.type===Ke&&e.level!==null?i=this.hls.levels[e.level].details:e.type===Se&&e.id!==null?i=this.hls.audioTracks[e.id].details:e.type===be&&e.id!==null&&(i=this.hls.subtitleTracks[e.id].details),i)){var u=i.partTarget,d=i.targetduration;if(u&&d){var c=1e3*Math.max(3*u,.8*d);r=$({},r,{maxTimeToFirstByteMs:Math.min(c,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(c,r.maxTimeToFirstByteMs)})}}var f=r.errorRetry||r.timeoutRetry||{},g={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:f.maxNumRetry||0,retryDelay:f.retryDelayMs||0,maxRetryDelay:f.maxRetryDelayMs||0},m={onSuccess:function(T,v,p,S){var E=a.getInternalLoader(p);a.resetInternalLoader(p.type);var L=T.data;L.indexOf("#EXTM3U")===0?(v.parsing.start=performance.now(),ht.isMediaPlaylist(L)?a.handleTrackOrLevelPlaylist(T,v,p,S||null,E):a.handleMasterPlaylist(T,v,p,S)):a.handleManifestParsingError(T,p,new Error("no EXTM3U delimiter"),S||null,v)},onError:function(T,v,p,S){a.handleNetworkError(v,p,!1,T,S)},onTimeout:function(T,v,p){a.handleNetworkError(v,p,!0,void 0,T)}};l.load(e,g,m)},n.handleMasterPlaylist=function(e,t,r,i){var a=this.hls,o=e.data,l=fr(e,r),h=ht.parseMasterPlaylist(o,l);if(h.playlistParsingError)this.handleManifestParsingError(e,r,h.playlistParsingError,i,t);else{var u=h.contentSteering,d=h.levels,c=h.sessionData,f=h.sessionKeys,g=h.startTimeOffset,m=h.variableList;this.variableList=m;var T=ht.parseMasterPlaylistMedia(o,l,h),v=T.AUDIO,p=v===void 0?[]:v,S=T.SUBTITLES,E=T["CLOSED-CAPTIONS"];p.length&&(p.some(function(L){return!L.url})||!d[0].audioCodec||d[0].attrs.AUDIO||(R.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new X({}),bitrate:0,url:""}))),a.trigger(y.MANIFEST_LOADED,{levels:d,audioTracks:p,subtitles:S,captions:E,contentSteering:u,url:l,stats:t,networkDetails:i,sessionData:c,sessionKeys:f,startTimeOffset:g,variableList:m})}},n.handleTrackOrLevelPlaylist=function(e,t,r,i,a){var o=this.hls,l=r.id,h=r.level,u=r.type,d=fr(e,r),c=F(l)?l:0,f=F(h)?h:c,g=Yi(r),m=ht.parseLevelPlaylist(e.data,d,f,g,c,this.variableList);if(u===ze){var T={attrs:new X({}),bitrate:0,details:m,name:"",url:d};o.trigger(y.MANIFEST_LOADED,{levels:[T],audioTracks:[],url:d,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=m,this.handlePlaylistLoaded(m,e,t,r,i,a)},n.handleManifestParsingError=function(e,t,r,i,a){this.hls.trigger(y.ERROR,{type:N.NETWORK_ERROR,details:k.MANIFEST_PARSING_ERROR,fatal:t.type===ze,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:i,stats:a})},n.handleNetworkError=function(e,t,r,i,a){r===void 0&&(r=!1);var o="A network "+(r?"timeout":"error"+(i?" (status "+i.code+")":""))+" occurred while loading "+e.type;e.type===Ke?o+=": "+e.level+" id: "+e.id:e.type!==Se&&e.type!==be||(o+=" id: "+e.id+' group-id: "'+e.groupId+'"');var l=new Error(o);R.warn("[playlist-loader]: "+o);var h=k.UNKNOWN,u=!1,d=this.getInternalLoader(e);switch(e.type){case ze:h=r?k.MANIFEST_LOAD_TIMEOUT:k.MANIFEST_LOAD_ERROR,u=!0;break;case Ke:h=r?k.LEVEL_LOAD_TIMEOUT:k.LEVEL_LOAD_ERROR,u=!1;break;case Se:h=r?k.AUDIO_TRACK_LOAD_TIMEOUT:k.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case be:h=r?k.SUBTITLE_TRACK_LOAD_TIMEOUT:k.SUBTITLE_LOAD_ERROR,u=!1}d&&this.resetInternalLoader(e.type);var c={type:N.NETWORK_ERROR,details:h,fatal:u,url:e.url,loader:d,context:e,error:l,networkDetails:t,stats:a};if(i){var f=(t==null?void 0:t.url)||e.url;c.response=ne({url:f,data:void 0},i)}this.hls.trigger(y.ERROR,c)},n.handlePlaylistLoaded=function(e,t,r,i,a,o){var l=this.hls,h=i.type,u=i.level,d=i.id,c=i.groupId,f=i.deliveryDirectives,g=fr(t,i),m=Yi(i),T=typeof i.level=="number"&&m===j?u:void 0;if(e.fragments.length){e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));var v=e.playlistParsingError;if(v)l.trigger(y.ERROR,{type:N.NETWORK_ERROR,details:k.LEVEL_PARSING_ERROR,fatal:!1,url:g,error:v,reason:v.message,response:t,context:i,level:T,parent:m,networkDetails:a,stats:r});else switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),o.getCacheAge&&!isNaN(e.ageHeader)||(e.ageHeader=0)),h){case ze:case Ke:l.trigger(y.LEVEL_LOADED,{details:e,level:T||0,id:d||0,stats:r,networkDetails:a,deliveryDirectives:f});break;case Se:l.trigger(y.AUDIO_TRACK_LOADED,{details:e,id:d||0,groupId:c||"",stats:r,networkDetails:a,deliveryDirectives:f});break;case be:l.trigger(y.SUBTITLE_TRACK_LOADED,{details:e,id:d||0,groupId:c||"",stats:r,networkDetails:a,deliveryDirectives:f})}}else{var p=new Error("No Segments found in Playlist");l.trigger(y.ERROR,{type:N.NETWORK_ERROR,details:k.LEVEL_EMPTY_ERROR,fatal:!1,url:g,error:p,reason:p.message,response:t,context:i,level:T,parent:m,networkDetails:a,stats:r})}},s}();function Wi(s,n){var e;try{e=new Event("addtrack")}catch{(e=document.createEvent("Event")).initEvent("addtrack",!1,!1)}e.track=s,n.dispatchEvent(e)}function ji(s,n){var e=s.mode;if(e==="disabled"&&(s.mode="hidden"),s.cues&&!s.cues.getCueById(n.id))try{if(s.addCue(n),!s.cues.getCueById(n.id))throw new Error("addCue is failed for: "+n)}catch(r){R.debug("[texttrack-utils]: "+r);var t=new self.TextTrackCue(n.startTime,n.endTime,n.text);t.id=n.id,s.addCue(t)}e==="disabled"&&(s.mode=e)}function Xe(s){var n=s.mode;if(n==="disabled"&&(s.mode="hidden"),s.cues)for(var e=s.cues.length;e--;)s.removeCue(s.cues[e]);n==="disabled"&&(s.mode=n)}function gr(s,n,e,t){var r=s.mode;if(r==="disabled"&&(s.mode="hidden"),s.cues&&s.cues.length>0)for(var i=function(o,l,h){var u=[],d=function(m,T){if(T<m[0].startTime)return 0;var v=m.length-1;if(T>m[v].endTime)return-1;for(var p=0,S=v;p<=S;){var E=Math.floor((S+p)/2);if(T<m[E].startTime)S=E-1;else{if(!(T>m[E].startTime&&p<v))return E;p=E+1}}return m[p].startTime-T<T-m[S].startTime?p:S}(o,l);if(d>-1)for(var c=d,f=o.length;c<f;c++){var g=o[c];if(g.startTime>=l&&g.endTime<=h)u.push(g);else if(g.startTime>h)return u}return u}(s.cues,n,e),a=0;a<i.length;a++)t&&!t(i[a])||s.removeCue(i[a]);r==="disabled"&&(s.mode=r)}var dt="org.id3",xa="com.apple.quicktime.HLS",ct="https://aomedia.org/emsg/ID3";function vr(){if(typeof self<"u")return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var Ct=function(){var s=vr();try{new s(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function mr(s,n){return s.getTime()/1e3-n}var Fa=function(){function s(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}var n=s.prototype;return n.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},n._registerListeners=function(){var e=this.hls;e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(y.LEVEL_UPDATED,this.onLevelUpdated,this)},n._unregisterListeners=function(){var e=this.hls;e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(y.LEVEL_UPDATED,this.onLevelUpdated,this)},n.onMediaAttached=function(e,t){this.media=t.media},n.onMediaDetaching=function(){this.id3Track&&(Xe(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},n.onManifestLoading=function(){this.dateRangeCuesAppended={}},n.createTrack=function(e){var t=this.getID3Track(e.textTracks);return t.mode="hidden",t},n.getID3Track=function(e){if(this.media){for(var t=0;t<e.length;t++){var r=e[t];if(r.kind==="metadata"&&r.label==="id3")return Wi(r,this.media),r}return this.media.addTextTrack("metadata","id3")}},n.onFragParsingMetadata=function(e,t){if(this.media){var r=this.hls.config,i=r.enableEmsgMetadataCues,a=r.enableID3MetadataCues;if(i||a){var o=t.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var l=vr(),h=0;h<o.length;h++){var u=o[h].type;if((u!==ct||i)&&a){var d=Ri(o[h].data);if(d){var c=o[h].pts,f=c+o[h].duration;f>Ct&&(f=Ct),f-c<=0&&(f=c+.25);for(var g=0;g<d.length;g++){var m=d[g];if(!Li(m)){this.updateId3CueEnds(c);var T=new l(c,f,"");T.value=m,u&&(T.type=u),this.id3Track.addCue(T)}}}}}}}},n.updateId3CueEnds=function(e){var t,r=(t=this.id3Track)==null?void 0:t.cues;if(r)for(var i=r.length;i--;){var a=r[i];a.startTime<e&&a.endTime===Ct&&(a.endTime=e)}},n.onBufferFlushing=function(e,t){var r=t.startOffset,i=t.endOffset,a=t.type,o=this.id3Track,l=this.hls;if(l){var h=l.config,u=h.enableEmsgMetadataCues,d=h.enableID3MetadataCues;o&&(u||d)&&gr(o,r,i,a==="audio"?function(c){return c.type===dt&&d}:a==="video"?function(c){return c.type===ct&&u}:function(c){return c.type===dt&&d||c.type===ct&&u})}},n.onLevelUpdated=function(e,t){var r=this,i=t.details;if(this.media&&i.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var a=this.dateRangeCuesAppended,o=this.id3Track,l=i.dateRanges,h=Object.keys(l);if(o)for(var u=Object.keys(a).filter(function(p){return!h.includes(p)}),d=function(){var p=u[c];Object.keys(a[p].cues).forEach(function(S){o.removeCue(a[p].cues[S])}),delete a[p]},c=u.length;c--;)d();var f=i.fragments[i.fragments.length-1];if(h.length!==0&&F(f==null?void 0:f.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var g=f.programDateTime/1e3-f.start,m=vr(),T=function(){var p=h[v],S=l[p],E=a[p],L=(E==null?void 0:E.cues)||{},A=(E==null?void 0:E.durationKnown)||!1,b=mr(S.startDate,g),w=Ct,D=S.endDate;if(D)w=mr(D,g),A=!0;else if(S.endOnNext&&!A){var I=h.reduce(function(M,K){var H=l[K];return H.class===S.class&&H.id!==K&&H.startDate>S.startDate&&M.push(H),M},[]).sort(function(M,K){return M.startDate.getTime()-K.startDate.getTime()})[0];I&&(w=mr(I.startDate,g),A=!0)}for(var _,C,x=Object.keys(S.attr),B=0;B<x.length;B++){var P=x[B];if((C=P)!=="ID"&&C!=="CLASS"&&C!=="START-DATE"&&C!=="DURATION"&&C!=="END-DATE"&&C!=="END-ON-NEXT"){var O=L[P];if(O)A&&!E.durationKnown&&(O.endTime=w);else{var U=S.attr[P];O=new m(b,w,""),ha(P)&&(_=U,U=Uint8Array.from(_.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer),O.value={key:P,data:U},O.type=xa,O.id=p,r.id3Track.addCue(O),L[P]=O}}}a[p]={cues:L,dateRange:S,durationKnown:A}},v=0;v<h.length;v++)T()}}},s}(),Oa=function(){function s(e){var t=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return t.timeupdate()},this.hls=e,this.config=e.config,this.registerListeners()}var n=s.prototype;return n.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},n.registerListeners=function(){this.hls.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(y.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(y.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(y.ERROR,this.onError,this)},n.unregisterListeners=function(){this.hls.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(y.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(y.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(y.ERROR,this.onError,this)},n.onMediaAttached=function(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},n.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},n.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},n.onLevelUpdated=function(e,t){var r=t.details;this.levelDetails=r,r.advanced&&this.timeupdate(),!r.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},n.onError=function(e,t){var r;t.details===k.BUFFER_STALLED_ERROR&&(this.stallCount++,(r=this.levelDetails)!=null&&r.live&&R.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},n.timeupdate=function(){var e=this.media,t=this.levelDetails;if(e&&t){this.currentTime=e.currentTime;var r=this.computeLatency();if(r!==null){this._latency=r;var i=this.config,a=i.lowLatencyMode,o=i.maxLiveSyncPlaybackRate;if(a&&o!==1){var l=this.targetLatency;if(l!==null){var h=r-l,u=h<Math.min(this.maxLatency,l+t.targetduration);if(t.live&&u&&h>.05&&this.forwardBufferLength>1){var d=Math.min(2,Math.max(1,o)),c=Math.round(2/(1+Math.exp(-.75*h-this.edgeStalled))*20)/20;e.playbackRate=Math.min(d,Math.max(1,c))}else e.playbackRate!==1&&e.playbackRate!==0&&(e.playbackRate=1)}}}}},n.estimateLiveEdge=function(){var e=this.levelDetails;return e===null?null:e.edge+e.age},n.computeLatency=function(){var e=this.estimateLiveEdge();return e===null?null:e-this.currentTime},ee(s,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var e=this.config,t=this.levelDetails;return e.liveMaxLatencyDuration!==void 0?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}},{key:"targetLatency",get:function(){var e=this.levelDetails;if(e===null)return null;var t=e.holdBack,r=e.partHoldBack,i=e.targetduration,a=this.config,o=a.liveSyncDuration,l=a.liveSyncDurationCount,h=a.lowLatencyMode,u=this.hls.userConfig,d=h&&r||t;(u.liveSyncDuration||u.liveSyncDurationCount||d===0)&&(d=o!==void 0?o:l*i);var c=i;return d+Math.min(1*this.stallCount,c)}},{key:"liveSyncPosition",get:function(){var e=this.estimateLiveEdge(),t=this.targetLatency,r=this.levelDetails;if(e===null||t===null||r===null)return null;var i=r.edge,a=e-t-this.edgeStalled,o=i-r.totalduration,l=i-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(o,a),l)}},{key:"drift",get:function(){var e=this.levelDetails;return e===null?1:e.drift}},{key:"edgeStalled",get:function(){var e=this.levelDetails;if(e===null)return 0;var t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}},{key:"forwardBufferLength",get:function(){var e=this.media,t=this.levelDetails;if(!e||!t)return 0;var r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}}]),s}(),pr=["NONE","TYPE-0","TYPE-1",null],yr="",Ma="YES",Na="v2",qi=function(){function s(n,e,t){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=n,this.part=e,this.skip=t}return s.prototype.addDirectives=function(n){var e=new self.URL(n);return this.msn!==void 0&&e.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.href},s}(),ft=function(){function s(n){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[n.url],this._attrs=[n.attrs],this.bitrate=n.bitrate,n.details&&(this.details=n.details),this.id=n.id||0,this.name=n.name,this.width=n.width||0,this.height=n.height||0,this.audioCodec=n.audioCodec,this.videoCodec=n.videoCodec,this.unknownCodecs=n.unknownCodecs,this.codecSet=[n.videoCodec,n.audioCodec].filter(function(e){return e}).join(",").replace(/\.[^.,]+/g,"")}return s.prototype.addFallback=function(n){this.url.push(n.url),this._attrs.push(n.attrs)},ee(s,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"attrs",get:function(){return this._attrs[this._urlId]}},{key:"pathwayId",get:function(){return this.attrs["PATHWAY-ID"]||"."}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(n){var e=n%this.url.length;this._urlId!==e&&(this.fragmentError=0,this.loadError=0,this.details=void 0,this._urlId=e)}},{key:"audioGroupId",get:function(){var n;return(n=this.audioGroupIds)==null?void 0:n[this.urlId]}},{key:"textGroupId",get:function(){var n;return(n=this.textGroupIds)==null?void 0:n[this.urlId]}}]),s}();function Tr(s,n){var e=n.startPTS;if(F(e)){var t,r=0;n.sn>s.sn?(r=e-s.start,t=s):(r=s.start-e,t=n),t.duration!==r&&(t.duration=r)}else n.sn>s.sn?s.cc===n.cc&&s.minEndPTS?n.start=s.start+(s.minEndPTS-s.start):n.start=s.start+s.duration:n.start=Math.max(s.start-n.duration,0)}function zi(s,n,e,t,r,i){t-e<=0&&(R.warn("Fragment should have a positive duration",n),t=e+n.duration,i=r+n.duration);var a=e,o=t,l=n.startPTS,h=n.endPTS;if(F(l)){var u=Math.abs(l-e);F(n.deltaPTS)?n.deltaPTS=Math.max(u,n.deltaPTS):n.deltaPTS=u,a=Math.max(e,l),e=Math.min(e,l),r=Math.min(r,n.startDTS),o=Math.min(t,h),t=Math.max(t,h),i=Math.max(i,n.endDTS)}var d=e-n.start;n.start!==0&&(n.start=e),n.duration=t-n.start,n.startPTS=e,n.maxStartPTS=a,n.startDTS=r,n.endPTS=t,n.minEndPTS=o,n.endDTS=i;var c,f=n.sn;if(!s||f<s.startSN||f>s.endSN)return 0;var g=f-s.startSN,m=s.fragments;for(m[g]=n,c=g;c>0;c--)Tr(m[c],m[c-1]);for(c=g;c<m.length-1;c++)Tr(m[c],m[c+1]);return s.fragmentHint&&Tr(m[m.length-1],s.fragmentHint),s.PTSKnown=s.alignedSliding=!0,d}function Ua(s,n){for(var e=null,t=s.fragments,r=t.length-1;r>=0;r--){var i=t[r].initSegment;if(i){e=i;break}}s.fragmentHint&&delete s.fragmentHint.endPTS;var a,o,l,h,u,d=0;if(function(v,p,S){for(var E=p.skippedSegments,L=Math.max(v.startSN,p.startSN)-p.startSN,A=(v.fragmentHint?1:0)+(E?p.endSN:Math.min(v.endSN,p.endSN))-p.startSN,b=p.startSN-v.startSN,w=p.fragmentHint?p.fragments.concat(p.fragmentHint):p.fragments,D=v.fragmentHint?v.fragments.concat(v.fragmentHint):v.fragments,I=L;I<=A;I++){var _=D[b+I],C=w[I];E&&!C&&I<E&&(C=p.fragments[I]=_),_&&C&&S(_,C)}}(s,n,function(v,p){v.relurl&&(d=v.cc-p.cc),F(v.startPTS)&&F(v.endPTS)&&(p.start=p.startPTS=v.startPTS,p.startDTS=v.startDTS,p.maxStartPTS=v.maxStartPTS,p.endPTS=v.endPTS,p.endDTS=v.endDTS,p.minEndPTS=v.minEndPTS,p.duration=v.endPTS-v.startPTS,p.duration&&(a=p),n.PTSKnown=n.alignedSliding=!0),p.elementaryStreams=v.elementaryStreams,p.loader=v.loader,p.stats=v.stats,p.urlId=v.urlId,v.initSegment&&(p.initSegment=v.initSegment,e=v.initSegment)}),e&&(n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments).forEach(function(v){var p;v.initSegment&&v.initSegment.relurl!==((p=e)==null?void 0:p.relurl)||(v.initSegment=e)}),n.skippedSegments)if(n.deltaUpdateFailed=n.fragments.some(function(v){return!v}),n.deltaUpdateFailed){R.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var c=n.skippedSegments;c--;)n.fragments.shift();n.startSN=n.fragments[0].sn,n.startCC=n.fragments[0].cc}else n.canSkipDateRanges&&(n.dateRanges=(o=s.dateRanges,l=n.dateRanges,h=n.recentlyRemovedDateranges,u=$({},o),h&&h.forEach(function(v){delete u[v]}),Object.keys(l).forEach(function(v){var p=new gi(l[v].attr,u[v]);p.isValid?u[v]=p:R.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(l[v].attr)+'"')}),u));var f=n.fragments;if(d){R.warn("discontinuity sliding from playlist, take drift into account");for(var g=0;g<f.length;g++)f[g].cc+=d}n.skippedSegments&&(n.startCC=n.fragments[0].cc),function(v,p,S){if(v&&p)for(var E=0,L=0,A=v.length;L<=A;L++){var b=v[L],w=p[L+E];b&&w&&b.index===w.index&&b.fragment.sn===w.fragment.sn?S(b,w):E--}}(s.partList,n.partList,function(v,p){p.elementaryStreams=v.elementaryStreams,p.stats=v.stats}),a?zi(n,a,a.startPTS,a.endPTS,a.startDTS,a.endDTS):Xi(s,n),f.length&&(n.totalduration=n.edge-f[0].start),n.driftStartTime=s.driftStartTime,n.driftStart=s.driftStart;var m=n.advancedDateTime;if(n.advanced&&m){var T=n.edge;n.driftStart||(n.driftStartTime=m,n.driftStart=T),n.driftEndTime=m,n.driftEnd=T}else n.driftEndTime=s.driftEndTime,n.driftEnd=s.driftEnd,n.advancedDateTime=s.advancedDateTime}function Xi(s,n){var e=n.startSN+n.skippedSegments-s.startSN,t=s.fragments;e<0||e>=t.length||Er(n,t[e].start)}function Er(s,n){if(n){for(var e=s.fragments,t=s.skippedSegments;t<e.length;t++)e[t].start+=n;s.fragmentHint&&(s.fragmentHint.start+=n)}}function Qi(s,n,e){var t;return s!=null&&s.details?$i((t=s.details)==null?void 0:t.partList,n,e):null}function $i(s,n,e){if(s)for(var t=s.length;t--;){var r=s[t];if(r.index===e&&r.fragment.sn===n)return r}return null}function _t(s){switch(s.details){case k.FRAG_LOAD_TIMEOUT:case k.KEY_LOAD_TIMEOUT:case k.LEVEL_LOAD_TIMEOUT:case k.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Ji(s,n){var e=_t(n);return s.default[(e?"timeout":"error")+"Retry"]}function Sr(s,n){var e=s.backoff==="linear"?1:Math.pow(2,n);return Math.min(e*s.retryDelayMs,s.maxRetryDelayMs)}function Zi(s){return ne(ne({},s),{errorRetry:null,timeoutRetry:null})}function Pt(s,n,e,t){return!!s&&n<s.maxNumRetry&&(function(r){return r===0&&navigator.onLine===!1||!!r&&(r<400||r>499)}(t)||!!e)}var en=function(s,n){for(var e=0,t=s.length-1,r=null,i=null;e<=t;){var a=n(i=s[r=(e+t)/2|0]);if(a>0)e=r+1;else{if(!(a<0))return i;t=r-1}}return null};function gt(s,n,e,t){e===void 0&&(e=0),t===void 0&&(t=0);var r=null;if(s?r=n[s.sn-n[0].sn+1]||null:e===0&&n[0].start===0&&(r=n[0]),r&&Lr(e,t,r)===0)return r;var i=en(n,Lr.bind(null,e,t));return!i||i===s&&r?r:i}function Lr(s,n,e){if(s===void 0&&(s=0),n===void 0&&(n=0),e.start<=s&&e.start+e.duration>s)return 0;var t=Math.min(n,e.duration+(e.deltaPTS?e.deltaPTS:0));return e.start+e.duration-t<=s?1:e.start-t>s&&e.start?-1:0}function Ba(s,n,e){var t=1e3*Math.min(n,e.duration+(e.deltaPTS?e.deltaPTS:0));return(e.endProgramDateTime||0)-t>s}var Rr,Ga=3e5,Ar=0,He=2,xt=5,Qe=0,Ft=1,tn=2,Ka=function(){function s(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=R.log.bind(R,"[info]:"),this.warn=R.warn.bind(R,"[warning]:"),this.error=R.error.bind(R,"[error]:"),this.registerListeners()}var n=s.prototype;return n.registerListeners=function(){var e=this.hls;e.on(y.ERROR,this.onError,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this)},n.unregisterListeners=function(){var e=this.hls;e&&(e.off(y.ERROR,this.onError,this),e.off(y.ERROR,this.onErrorOut,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this))},n.destroy=function(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}},n.startLoad=function(e){this.playlistError=0},n.stopLoad=function(){},n.getVariantLevelIndex=function(e){return(e==null?void 0:e.type)===j?e.level:this.hls.loadLevel},n.onManifestLoading=function(){this.playlistError=0,this.penalizedRenditions={}},n.onError=function(e,t){var r;if(!t.fatal){var i=this.hls,a=t.context;switch(t.details){case k.FRAG_LOAD_ERROR:case k.FRAG_LOAD_TIMEOUT:case k.KEY_LOAD_ERROR:case k.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case k.FRAG_GAP:case k.FRAG_PARSING_ERROR:case k.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=He);case k.LEVEL_EMPTY_ERROR:case k.LEVEL_PARSING_ERROR:var o,l,h=t.parent===j?t.level:i.loadLevel;return void(t.details===k.LEVEL_EMPTY_ERROR&&(o=t.context)!=null&&(l=o.levelDetails)!=null&&l.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,h):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,h)));case k.LEVEL_LOAD_ERROR:case k.LEVEL_LOAD_TIMEOUT:return void(typeof(a==null?void 0:a.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,a.level)));case k.AUDIO_TRACK_LOAD_ERROR:case k.AUDIO_TRACK_LOAD_TIMEOUT:case k.SUBTITLE_LOAD_ERROR:case k.SUBTITLE_TRACK_LOAD_TIMEOUT:if(a){var u=i.levels[i.loadLevel];if(u&&(a.type===Se&&a.groupId===u.audioGroupId||a.type===be&&a.groupId===u.textGroupId))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.loadLevel),t.errorAction.action=He,void(t.errorAction.flags=Ft)}return;case k.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:var d=i.levels[i.loadLevel],c=d==null?void 0:d.attrs["HDCP-LEVEL"];return void(c&&(t.errorAction={action:He,flags:tn,hdcpLevel:c}));case k.BUFFER_ADD_CODEC_ERROR:case k.REMUX_ALLOC_ERROR:return void(t.errorAction=this.getLevelSwitchAction(t,(r=t.level)!=null?r:i.loadLevel));case k.INTERNAL_EXCEPTION:case k.BUFFER_APPENDING_ERROR:case k.BUFFER_APPEND_ERROR:case k.BUFFER_FULL_ERROR:case k.LEVEL_SWITCH_ERROR:case k.BUFFER_STALLED_ERROR:case k.BUFFER_SEEK_OVER_HOLE:case k.BUFFER_NUDGE_ON_STALL:return void(t.errorAction={action:Ar,flags:Qe})}if(t.type===N.KEY_SYSTEM_ERROR){var f=this.getVariantLevelIndex(t.frag);return t.levelRetry=!1,void(t.errorAction=this.getLevelSwitchAction(t,f))}}},n.getPlaylistRetryOrSwitchAction=function(e,t){var r,i,a=Ji(this.hls.config.playlistLoadPolicy,e),o=this.playlistError++,l=(r=e.response)==null?void 0:r.code;return Pt(a,o,_t(e),l)?{action:xt,flags:Qe,retryConfig:a,retryCount:o}:(i=e.context)!=null&&i.deliveryDirectives?{action:Ar,flags:Qe,retryConfig:a||{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},retryCount:o}:this.getLevelSwitchAction(e,t)},n.getFragRetryOrSwitchAction=function(e){var t=this.hls,r=this.getVariantLevelIndex(e.frag),i=t.levels[r],a=t.config,o=a.fragLoadPolicy,l=a.keyLoadPolicy,h=Ji(e.details.startsWith("key")?l:o,e),u=t.levels.reduce(function(g,m){return g+m.fragmentError},0);if(i){var d;e.details!==k.FRAG_GAP&&i.fragmentError++;var c=(d=e.response)==null?void 0:d.code;if(Pt(h,u,_t(e),c))return{action:xt,flags:Qe,retryConfig:h,retryCount:u}}var f=this.getLevelSwitchAction(e,r);return h&&(f.retryConfig=h,f.retryCount=u),f},n.getLevelSwitchAction=function(e,t){var r=this.hls;t==null&&(t=r.loadLevel);var i=this.hls.levels[t];if(i&&(i.loadError++,r.autoLevelEnabled)){for(var a,o,l=-1,h=r.levels,u=(a=e.frag)==null?void 0:a.type,d=(o=e.context)!=null?o:{},c=d.type,f=d.groupId,g=h.length;g--;){var m=(g+r.loadLevel)%h.length;if(m!==r.loadLevel&&h[m].loadError===0){var T=h[m];if(e.details===k.FRAG_GAP&&e.frag){var v=h[m].details;if(v){var p=gt(e.frag,v.fragments,e.frag.start);if(p!=null&&p.gap)continue}}else if(c===Se&&f===T.audioGroupId||c===be&&f===T.textGroupId||u===Le&&i.audioGroupId===T.audioGroupId||u===xe&&i.textGroupId===T.textGroupId)continue;l=m;break}}if(l>-1&&r.loadLevel!==l)return e.levelRetry=!0,{action:He,flags:Qe,nextAutoLevel:l}}return{action:He,flags:Ft}},n.onErrorOut=function(e,t){var r;switch((r=t.errorAction)==null?void 0:r.action){case Ar:break;case He:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===k.FRAG_GAP||(t.fatal=!0)}t.fatal&&this.hls.stopLoad()},n.sendAlternateToPenaltyBox=function(e){var t=this.hls,r=e.errorAction;if(r){var i=r.flags,a=r.hdcpLevel,o=r.nextAutoLevel;switch(i){case Qe:this.switchLevel(e,o);break;case Ft:r.resolved||(r.resolved=this.redundantFailover(e));break;case tn:a&&(t.maxHdcpLevel=pr[pr.indexOf(a)-1],r.resolved=!0),this.warn('Restricting playback to HDCP-LEVEL of "'+t.maxHdcpLevel+'" or lower')}r.resolved||this.switchLevel(e,o)}},n.switchLevel=function(e,t){t!==void 0&&e.errorAction&&(this.warn("switching to level "+t+" after "+e.details),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)},n.redundantFailover=function(e){var t=this,r=this.hls,i=this.penalizedRenditions,a=e.parent===j?e.level:r.loadLevel,o=r.levels[a],l=o.url.length,h=e.frag?e.frag.urlId:o.urlId;o.urlId!==h||e.frag&&!o.details||this.penalizeRendition(o,e);for(var u=function(){var f=(h+d)%l,g=i[f];if(!g||function(m,T,v){if(performance.now()-m.lastErrorPerfMs>Ga)return!0;var p=m.details;if(T.details===k.FRAG_GAP&&p&&T.frag){var S=T.frag.start,E=gt(null,p.fragments,S);if(E&&!E.gap)return!0}if(v&&m.errors.length<v.errors.length){var L=m.errors[m.errors.length-1];if(p&&L.frag&&T.frag&&Math.abs(L.frag.start-T.frag.start)>3*p.targetduration)return!0}return!1}(g,e,i[h]))return t.warn("Switching to Redundant Stream "+(f+1)+"/"+l+': "'+o.url[f]+'" after '+e.details),t.playlistError=0,r.levels.forEach(function(m){m.urlId=f}),r.nextLoadLevel=a,{v:!0}},d=1;d<l;d++){var c=u();if(typeof c=="object")return c.v}return!1},n.penalizeRendition=function(e,t){var r=this.penalizedRenditions,i=r[e.urlId]||{lastErrorPerfMs:0,errors:[],details:void 0};i.lastErrorPerfMs=performance.now(),i.errors.push(t),i.details=e.details,r[e.urlId]=i},s}(),br=function(){function s(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=R.log.bind(R,t+":"),this.warn=R.warn.bind(R,t+":"),this.hls=e}var n=s.prototype;return n.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},n.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},n.startLoad=function(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()},n.stopLoad=function(){this.canLoad=!1,this.clearTimer()},n.switchParams=function(e,t){var r=t==null?void 0:t.renditionReports;if(r){for(var i=-1,a=0;a<r.length;a++){var o=r[a],l=void 0;try{l=new self.URL(o.URI,t.url).href}catch(f){R.warn("Could not construct new URL for Rendition Report: "+f),l=o.URI||""}if(l===e){i=a;break}l===e.substring(0,l.length)&&(i=a)}if(i!==-1){var h=r[i],u=parseInt(h["LAST-MSN"])||(t==null?void 0:t.lastPartSn),d=parseInt(h["LAST-PART"])||(t==null?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){var c=Math.min(t.age-t.partTarget,t.targetduration);d>=0&&c>t.partTarget&&(d+=1)}return new qi(u,d>=0?d:void 0,yr)}}},n.loadPlaylist=function(e){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())},n.shouldLoadPlaylist=function(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)},n.shouldReloadPlaylist=function(e){return this.timer===-1&&this.requestScheduled===-1&&this.shouldLoadPlaylist(e)},n.playlistLoaded=function(e,t,r){var i=this,a=t.details,o=t.stats,l=self.performance.now(),h=o.loading.first?Math.max(0,l-o.loading.first):0;if(a.advancedDateTime=Date.now()-h,a.live||r!=null&&r.live){if(a.reloaded(r),r&&this.log("live playlist "+e+" "+(a.advanced?"REFRESHED "+a.lastPartSn+"-"+a.lastPartIndex:"MISSED")),r&&a.fragments.length>0&&Ua(r,a),!this.canLoad||!a.live)return;var u,d=void 0,c=void 0;if(a.canBlockReload&&a.endSN&&a.advanced){var f=this.hls.config.lowLatencyMode,g=a.lastPartSn,m=a.endSN,T=a.lastPartIndex,v=g===m;T!==-1?(d=v?m+1:g,c=v?f?0:T:T+1):d=m+1;var p=a.age,S=p+a.ageHeader,E=Math.min(S-a.partTarget,1.5*a.targetduration);if(E>0){if(r&&E>r.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+r.tuneInGoal+" to: "+E+" with playlist age: "+a.age),E=0;else{var L=Math.floor(E/a.targetduration);d+=L,c!==void 0&&(c+=Math.round(E%a.targetduration/a.partTarget)),this.log("CDN Tune-in age: "+a.ageHeader+"s last advanced "+p.toFixed(2)+"s goal: "+E+" skip sn "+L+" to part "+c)}a.tuneInGoal=E}if(u=this.getDeliveryDirectives(a,t.deliveryDirectives,d,c),f||!v)return void this.loadPlaylist(u)}else a.canBlockReload&&(u=this.getDeliveryDirectives(a,t.deliveryDirectives,d,c));var A=this.hls.mainForwardBufferInfo,b=A?A.end-A.len:0,w=function(I,_){_===void 0&&(_=1/0);var C=1e3*I.targetduration;if(I.updated){var x=I.fragments;if(x.length&&4*C>_){var B=1e3*x[x.length-1].duration;B<C&&(C=B)}}else C/=2;return Math.round(C)}(a,1e3*(a.edge-b));a.updated&&l>this.requestScheduled+w&&(this.requestScheduled=o.loading.start),d!==void 0&&a.canBlockReload?this.requestScheduled=o.loading.first+w-(1e3*a.partTarget||1e3):this.requestScheduled===-1||this.requestScheduled+w<l?this.requestScheduled=l:this.requestScheduled-l<=0&&(this.requestScheduled+=w);var D=this.requestScheduled-l;D=Math.max(0,D),this.log("reload live playlist "+e+" in "+Math.round(D)+" ms"),this.timer=self.setTimeout(function(){return i.loadPlaylist(u)},D)}else this.clearTimer()},n.getDeliveryDirectives=function(e,t,r,i){var a=function(o,l){var h=o.canSkipUntil,u=o.canSkipDateRanges,d=o.endSN;return h&&(l!==void 0?l-d:0)<h?u?Na:Ma:yr}(e,r);return t!=null&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,i=t.part,a=yr),new qi(r,i,a)},n.checkRetry=function(e){var t=this,r=e.details,i=_t(e),a=e.errorAction,o=a||{},l=o.action,h=o.retryCount,u=h===void 0?0:h,d=o.retryConfig,c=l===xt&&!!a&&!!d;if(c){var f;if(this.requestScheduled=-1,i&&(f=e.context)!=null&&f.deliveryDirectives)this.warn("Retrying playlist loading "+(u+1)+"/"+d.maxNumRetry+' after "'+r+'" without delivery-directives'),this.loadPlaylist();else{var g=Sr(d,u);this.timer=self.setTimeout(function(){return t.loadPlaylist()},g),this.warn("Retrying playlist loading "+(u+1)+"/"+d.maxNumRetry+' after "'+r+'" in '+g+"ms")}e.levelRetry=!0,a.resolved=!0}return c},s}(),Ha=function(s){function n(t,r){var i;return(i=s.call(this,t,"[level-controller]")||this)._levels=[],i._firstLevel=-1,i._startLevel=void 0,i.currentLevel=null,i.currentLevelIndex=-1,i.manualLevelIndex=-1,i.steering=void 0,i.onParsedComplete=void 0,i.steering=r,i._registerListeners(),i}ae(n,s);var e=n.prototype;return e._registerListeners=function(){var t=this.hls;t.on(y.MANIFEST_LOADING,this.onManifestLoading,this),t.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(y.LEVEL_LOADED,this.onLevelLoaded,this),t.on(y.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(y.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(y.FRAG_LOADED,this.onFragLoaded,this),t.on(y.ERROR,this.onError,this)},e._unregisterListeners=function(){var t=this.hls;t.off(y.MANIFEST_LOADING,this.onManifestLoading,this),t.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(y.LEVEL_LOADED,this.onLevelLoaded,this),t.off(y.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(y.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(y.FRAG_LOADED,this.onFragLoaded,this),t.off(y.ERROR,this.onError,this)},e.destroy=function(){this._unregisterListeners(),this.steering=null,this.resetLevels(),s.prototype.destroy.call(this)},e.startLoad=function(){this._levels.forEach(function(t){t.loadError=0,t.fragmentError=0}),s.prototype.startLoad.call(this)},e.resetLevels=function(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[]},e.onManifestLoading=function(t,r){this.resetLevels()},e.onManifestLoaded=function(t,r){var i,a=[],o={};r.levels.forEach(function(l){var h,u=l.attrs;((h=l.audioCodec)==null?void 0:h.indexOf("mp4a.40.34"))!==-1&&(Rr||(Rr=/chrome|firefox/i.test(navigator.userAgent)),Rr&&(l.audioCodec=void 0));var d=u.AUDIO,c=u.CODECS,f=u["FRAME-RATE"],g=u["PATHWAY-ID"],m=u.RESOLUTION,T=u.SUBTITLES,v=(g||".")+"-"+l.bitrate+"-"+m+"-"+f+"-"+c;(i=o[v])?i.addFallback(l):(i=new ft(l),o[v]=i,a.push(i)),Ot(i,"audio",d),Ot(i,"text",T)}),this.filterAndSortMediaOptions(a,r)},e.filterAndSortMediaOptions=function(t,r){var i=this,a=[],o=[],l=!1,h=!1,u=!1,d=t.filter(function(p){var S=p.audioCodec,E=p.videoCodec,L=p.width,A=p.height,b=p.unknownCodecs;return l||(l=!(!L||!A)),h||(h=!!E),u||(u=!!S),!(b!=null&&b.length)&&(!S||cr(S,"audio"))&&(!E||cr(E,"video"))});if((l||h)&&u&&(d=d.filter(function(p){var S=p.videoCodec,E=p.width,L=p.height;return!!S||!(!E||!L)})),d.length!==0){r.audioTracks&&rn(a=r.audioTracks.filter(function(p){return!p.audioCodec||cr(p.audioCodec,"audio")})),r.subtitles&&rn(o=r.subtitles);var c=d.slice(0);d.sort(function(p,S){return p.attrs["HDCP-LEVEL"]!==S.attrs["HDCP-LEVEL"]?(p.attrs["HDCP-LEVEL"]||"")>(S.attrs["HDCP-LEVEL"]||"")?1:-1:p.bitrate!==S.bitrate?p.bitrate-S.bitrate:p.attrs["FRAME-RATE"]!==S.attrs["FRAME-RATE"]?p.attrs.decimalFloatingPoint("FRAME-RATE")-S.attrs.decimalFloatingPoint("FRAME-RATE"):p.attrs.SCORE!==S.attrs.SCORE?p.attrs.decimalFloatingPoint("SCORE")-S.attrs.decimalFloatingPoint("SCORE"):l&&p.height!==S.height?p.height-S.height:0});var f=c[0];if(this.steering&&(d=this.steering.filterParsedLevels(d)).length!==c.length){for(var g=0;g<c.length;g++)if(c[g].pathwayId===d[0].pathwayId){f=c[g];break}}this._levels=d;for(var m=0;m<d.length;m++)if(d[m]===f){this._firstLevel=m,this.log("manifest loaded, "+d.length+" level(s) found, first bitrate: "+f.bitrate);break}var T=u&&!h,v={levels:d,audioTracks:a,subtitleTracks:o,sessionData:r.sessionData,sessionKeys:r.sessionKeys,firstLevel:this._firstLevel,stats:r.stats,audio:u,video:h,altAudio:!T&&a.some(function(p){return!!p.url})};this.hls.trigger(y.MANIFEST_PARSED,v),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else Promise.resolve().then(function(){if(i.hls){var p=new Error("no level with compatible codecs found in manifest");i.hls.trigger(y.ERROR,{type:N.MEDIA_ERROR,details:k.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:r.url,error:p,reason:p.message})}})},e.onError=function(t,r){!r.fatal&&r.context&&r.context.type===Ke&&r.context.level===this.level&&this.checkRetry(r)},e.onFragLoaded=function(t,r){var i=r.frag;if(i!==void 0&&i.type===j){var a=this._levels[i.level];a!==void 0&&(a.loadError=0)}},e.onLevelLoaded=function(t,r){var i,a,o=r.level,l=r.details,h=this._levels[o];if(!h)return this.warn("Invalid level index "+o),void((a=r.deliveryDirectives)!=null&&a.skip&&(l.deltaUpdateFailed=!0));o===this.currentLevelIndex?(h.fragmentError===0&&(h.loadError=0),this.playlistLoaded(o,r,h.details)):(i=r.deliveryDirectives)!=null&&i.skip&&(l.deltaUpdateFailed=!0)},e.onAudioTrackSwitched=function(t,r){var i=this.currentLevel;if(i){var a=this.hls.audioTracks[r.id].groupId;if(i.audioGroupIds&&i.audioGroupId!==a){for(var o=-1,l=0;l<i.audioGroupIds.length;l++)if(i.audioGroupIds[l]===a){o=l;break}o!==-1&&o!==i.urlId&&(i.urlId=o,this.canLoad&&this.startLoad())}}},e.loadPlaylist=function(t){s.prototype.loadPlaylist.call(this);var r=this.currentLevelIndex,i=this.currentLevel;if(i&&this.shouldLoadPlaylist(i)){var a=i.urlId,o=i.uri;if(t)try{o=t.addDirectives(o)}catch(h){this.warn("Could not construct new URL with HLS Delivery Directives: "+h)}var l=i.attrs["PATHWAY-ID"];this.log("Loading level index "+r+((t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:"")+" with"+(l?" Pathway "+l:"")+" URI "+(a+1)+"/"+i.url.length+" "+o),this.clearTimer(),this.hls.trigger(y.LEVEL_LOADING,{url:o,level:r,id:a,deliveryDirectives:t||null})}},e.removeLevel=function(t,r){var i=this,a=function(l,h){return h!==r},o=this._levels.filter(function(l,h){return h!==t||(l.url.length>1&&r!==void 0?(l.url=l.url.filter(a),l.audioGroupIds&&(l.audioGroupIds=l.audioGroupIds.filter(a)),l.textGroupIds&&(l.textGroupIds=l.textGroupIds.filter(a)),l.urlId=0,!0):(i.steering&&i.steering.removeLevel(l),!1))});this.hls.trigger(y.LEVELS_UPDATED,{levels:o})},e.onLevelsUpdated=function(t,r){var i=r.levels;i.forEach(function(a,o){var l=a.details;l!=null&&l.fragments&&l.fragments.forEach(function(h){h.level=o})}),this._levels=i},ee(n,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(t){var r=this._levels;if(r.length!==0){if(t<0||t>=r.length){var i=new Error("invalid level idx"),a=t<0;if(this.hls.trigger(y.ERROR,{type:N.OTHER_ERROR,details:k.LEVEL_SWITCH_ERROR,level:t,fatal:a,error:i,reason:i.message}),a)return;t=Math.min(t,r.length-1)}var o=this.currentLevelIndex,l=this.currentLevel,h=l?l.attrs["PATHWAY-ID"]:void 0,u=r[t],d=u.attrs["PATHWAY-ID"];if(this.currentLevelIndex=t,this.currentLevel=u,o!==t||!u.details||!l||h!==d){this.log("Switching to level "+t+(d?" with Pathway "+d:"")+" from level "+o+(h?" with Pathway "+h:""));var c=$({},u,{level:t,maxBitrate:u.maxBitrate,attrs:u.attrs,uri:u.uri,urlId:u.urlId});delete c._attrs,delete c._urlId,this.hls.trigger(y.LEVEL_SWITCHING,c);var f=u.details;if(!f||f.live){var g=this.switchParams(u.uri,l==null?void 0:l.details);this.loadPlaylist(g)}}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(t){this.manualLevelIndex=t,this._startLevel===void 0&&(this._startLevel=t),t!==-1&&(this.level=t)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(t){this._firstLevel=t}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var t=this.hls.config.startLevel;return t!==void 0?t:this._firstLevel}return this._startLevel},set:function(t){this._startLevel=t}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(t){this.level=t,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=t)}}]),n}(br);function Ot(s,n,e){e&&(n==="audio"?(s.audioGroupIds||(s.audioGroupIds=[]),s.audioGroupIds[s.url.length-1]=e):n==="text"&&(s.textGroupIds||(s.textGroupIds=[]),s.textGroupIds[s.url.length-1]=e))}function rn(s){var n={};s.forEach(function(e){var t=e.groupId||"";e.id=n[t]=n[t]||0,n[t]++})}var Mt="NOT_LOADED",nn="APPENDING",Nt="PARTIAL",vt="OK",Va=function(){function s(e){this.mainFragEntity=null,this.activeParts=null,this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}var n=s.prototype;return n._registerListeners=function(){var e=this.hls;e.on(y.BUFFER_APPENDED,this.onBufferAppended,this),e.on(y.FRAG_BUFFERED,this.onFragBuffered,this),e.on(y.FRAG_LOADED,this.onFragLoaded,this)},n._unregisterListeners=function(){var e=this.hls;e.off(y.BUFFER_APPENDED,this.onBufferAppended,this),e.off(y.FRAG_BUFFERED,this.onFragBuffered,this),e.off(y.FRAG_LOADED,this.onFragLoaded,this)},n.destroy=function(){this._unregisterListeners(),this.fragments=this.endListFragments=this.timeRanges=this.mainFragEntity=this.activeParts=null},n.getAppendedFrag=function(e,t){if(t===j){var r=this.mainFragEntity,i=this.activeParts;if(r){if(r&&i)for(var a=i.length;a--;){var o=i[a],l=o?o.end:r.appendedPTS;if(o.start<=e&&l!==null&&e<=l)return a>9&&(this.activeParts=i.slice(a-9)),o}else if(r.body.start<=e&&r.appendedPTS!==null&&e<=r.appendedPTS)return r.body}}return this.getBufferedFrag(e,t)},n.getBufferedFrag=function(e,t){for(var r=this.fragments,i=Object.keys(r),a=i.length;a--;){var o=r[i[a]];if((o==null?void 0:o.body.type)===t&&o.buffered){var l=o.body;if(l.start<=e&&e<=l.end)return l}}return null},n.detectEvictedFragments=function(e,t,r){var i=this;this.timeRanges&&(this.timeRanges[e]=t),Object.keys(this.fragments).forEach(function(a){var o=i.fragments[a];if(o)if(o.buffered||o.loaded){var l=o.range[e];l&&l.time.some(function(h){var u=!i.isTimeBuffered(h.startPTS,h.endPTS,t);return u&&i.removeFragment(o.body),u})}else o.body.type===r&&i.removeFragment(o.body)})},n.detectPartialFragments=function(e){var t=this,r=this.timeRanges,i=e.frag,a=e.part;if(r&&i.sn!=="initSegment"){var o=Fe(i),l=this.fragments[o];l&&(Object.keys(r).forEach(function(h){var u=i.elementaryStreams[h];if(u){var d=r[h],c=a!==null||u.partial===!0;l.range[h]=t.getBufferedTimes(i,a,c,d)}}),l.loaded=null,Object.keys(l.range).length?(l.buffered=!0,l.body.endList&&(this.endListFragments[l.body.type]=l)):this.removeFragment(l.body))}},n.fragBuffered=function(e,t){var r=Fe(e),i=this.fragments[r];!i&&t&&(i=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)},n.getBufferedTimes=function(e,t,r,i){for(var a={time:[],partial:r},o=t?t.start:e.start,l=t?t.end:e.end,h=e.minEndPTS||l,u=e.maxStartPTS||o,d=0;d<i.length;d++){var c=i.start(d)-this.bufferPadding,f=i.end(d)+this.bufferPadding;if(u>=c&&h<=f){a.time.push({startPTS:Math.max(o,i.start(d)),endPTS:Math.min(l,i.end(d))});break}if(o<f&&l>c)a.partial=!0,a.time.push({startPTS:Math.max(o,i.start(d)),endPTS:Math.min(l,i.end(d))});else if(l<=c)break}return a},n.getPartialFragment=function(e){var t,r,i,a=null,o=0,l=this.bufferPadding,h=this.fragments;return Object.keys(h).forEach(function(u){var d=h[u];d&&kr(d)&&(r=d.body.start-l,i=d.body.end+l,e>=r&&e<=i&&(t=Math.min(e-r,i-e),o<=t&&(a=d.body,o=t)))}),a},n.isEndListAppended=function(e){var t=this.endListFragments[e];return t!==void 0&&(t.buffered||kr(t))},n.getState=function(e){var t=Fe(e),r=this.fragments[t];return r?r.buffered?kr(r)?Nt:vt:nn:Mt},n.isTimeBuffered=function(e,t,r){for(var i,a,o=0;o<r.length;o++){if(i=r.start(o)-this.bufferPadding,a=r.end(o)+this.bufferPadding,e>=i&&t<=a)return!0;if(t<=i)return!1}return!1},n.onFragLoaded=function(e,t){var r=t.frag,i=t.part;if(r.sn!=="initSegment"&&!r.bitrateTest&&!i){var a=Fe(r);this.fragments[a]={body:r,appendedPTS:null,loaded:t,buffered:!1,range:Object.create(null)}}},n.onBufferAppended=function(e,t){var r=this,i=t.frag,a=t.part,o=t.timeRanges,l=this.mainFragEntity;if(i.type===j){var h=l?l.body:null;if(h!==i){l&&h&&h.sn!==i.sn&&(l.buffered=!0,this.fragments[Fe(h)]=l);var u=Fe(i);l=this.mainFragEntity=this.fragments[u]||{body:i,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)}}if(a){var d=this.activeParts;d||(this.activeParts=d=[]),d.push(a)}else this.activeParts=null}this.timeRanges=o,Object.keys(o).forEach(function(c){var f=o[c];if(r.detectEvictedFragments(c,f),!a&&l){var g=i.elementaryStreams[c];if(!g)return;for(var m=0;m<f.length;m++){var T=f.end(m);T<=g.endPTS&&T>g.startPTS?l.appendedPTS=Math.max(T,l.appendedPTS||0):l.appendedPTS=g.endPTS}}})},n.onFragBuffered=function(e,t){this.detectPartialFragments(t)},n.hasFragment=function(e){var t=Fe(e);return!!this.fragments[t]},n.removeFragmentsInRange=function(e,t,r,i,a){var o=this;i&&!this.hasGaps||Object.keys(this.fragments).forEach(function(l){var h=o.fragments[l];if(h){var u=h.body;u.type!==r||i&&!u.gap||u.start<t&&u.end>e&&(h.buffered||a)&&o.removeFragment(u)}})},n.removeFragment=function(e){var t=Fe(e);e.stats.loaded=0,e.clearElementaryStreamInfo(),this.mainFragEntity===this.fragments[t]&&(this.mainFragEntity=null),delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]},n.removeAllFragments=function(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.mainFragEntity=null,this.activeParts=null,this.hasGaps=!1},s}();function kr(s){var n,e;return s.buffered&&(s.body.gap||((n=s.range.video)==null?void 0:n.partial)||((e=s.range.audio)==null?void 0:e.partial))}function Fe(s){return s.type+"_"+s.level+"_"+s.urlId+"_"+s.sn}var an=Math.pow(2,17),Ya=function(){function s(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}var n=s.prototype;return n.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},n.abort=function(){this.loader&&this.loader.abort()},n.load=function(e,t){var r=this,i=e.url;if(!i)return Promise.reject(new ke({type:N.NETWORK_ERROR,details:k.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error("Fragment does not have a "+(i?"part list":"url")),networkDetails:null}));this.abort();var a=this.config,o=a.fLoader,l=a.loader;return new Promise(function(h,u){if(r.loader&&r.loader.destroy(),e.gap)u(on(e));else{var d=r.loader=e.loader=o?new o(a):new l(a),c=sn(e),f=Zi(a.fragLoadPolicy.default),g={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:an};e.stats=d.stats,d.load(c,g,{onSuccess:function(m,T,v,p){r.resetLoader(e,d);var S=m.data;v.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(S.slice(0,16)),S=S.slice(16)),h({frag:e,part:null,payload:S,networkDetails:p})},onError:function(m,T,v,p){r.resetLoader(e,d),u(new ke({type:N.NETWORK_ERROR,details:k.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:ne({url:i,data:void 0},m),error:new Error("HTTP Error "+m.code+" "+m.text),networkDetails:v,stats:p}))},onAbort:function(m,T,v){r.resetLoader(e,d),u(new ke({type:N.NETWORK_ERROR,details:k.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:v,stats:m}))},onTimeout:function(m,T,v){r.resetLoader(e,d),u(new ke({type:N.NETWORK_ERROR,details:k.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error("Timeout after "+g.timeout+"ms"),networkDetails:v,stats:m}))},onProgress:function(m,T,v,p){t&&t({frag:e,part:null,payload:v,networkDetails:p})}})}})},n.loadPart=function(e,t,r){var i=this;this.abort();var a=this.config,o=a.fLoader,l=a.loader;return new Promise(function(h,u){if(i.loader&&i.loader.destroy(),e.gap||t.gap)u(on(e,t));else{var d=i.loader=e.loader=o?new o(a):new l(a),c=sn(e,t),f=Zi(a.fragLoadPolicy.default),g={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:an};t.stats=d.stats,d.load(c,g,{onSuccess:function(m,T,v,p){i.resetLoader(e,d),i.updateStatsFromPart(e,t);var S={frag:e,part:t,payload:m.data,networkDetails:p};r(S),h(S)},onError:function(m,T,v,p){i.resetLoader(e,d),u(new ke({type:N.NETWORK_ERROR,details:k.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:ne({url:c.url,data:void 0},m),error:new Error("HTTP Error "+m.code+" "+m.text),networkDetails:v,stats:p}))},onAbort:function(m,T,v){e.stats.aborted=t.stats.aborted,i.resetLoader(e,d),u(new ke({type:N.NETWORK_ERROR,details:k.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:v,stats:m}))},onTimeout:function(m,T,v){i.resetLoader(e,d),u(new ke({type:N.NETWORK_ERROR,details:k.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error("Timeout after "+g.timeout+"ms"),networkDetails:v,stats:m}))}})}})},n.updateStatsFromPart=function(e,t){var r=e.stats,i=t.stats,a=i.total;if(r.loaded+=i.loaded,a){var o=Math.round(e.duration/t.duration),l=Math.min(Math.round(r.loaded/a),o),h=(o-l)*Math.round(r.loaded/l);r.total=r.loaded+h}else r.total=Math.max(r.loaded,r.total);var u=r.loading,d=i.loading;u.start?u.first+=d.first-d.start:(u.start=d.start,u.first=d.first),u.end=d.end},n.resetLoader=function(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()},s}();function sn(s,n){n===void 0&&(n=null);var e=n||s,t={frag:s,part:n,responseType:"arraybuffer",url:e.url,headers:{},rangeStart:0,rangeEnd:0},r=e.byteRangeStartOffset,i=e.byteRangeEndOffset;if(F(r)&&F(i)){var a,o=r,l=i;if(s.sn==="initSegment"&&((a=s.decryptdata)==null?void 0:a.method)==="AES-128"){var h=i-r;h%16&&(l=i+(16-h%16)),r!==0&&(t.resetIV=!0,o=r-16)}t.rangeStart=o,t.rangeEnd=l}return t}function on(s,n){var e=new Error("GAP "+(s.gap?"tag":"attribute")+" found"),t={type:N.MEDIA_ERROR,details:k.FRAG_GAP,fatal:!1,frag:s,error:e,networkDetails:null};return n&&(t.part=n),(n||s).stats.aborted=!0,new ke(t)}var ke=function(s){function n(e){var t;return(t=s.call(this,e.error.message)||this).data=void 0,t.data=e,t}return ae(n,s),n}(ot(Error)),Wa=function(){function s(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}var n=s.prototype;return n.abort=function(){for(var e in this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e].loader;t&&t.abort()}},n.detach=function(){for(var e in this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}},n.destroy=function(){for(var e in this.detach(),this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}},n.createKeyLoadError=function(e,t,r,i,a){return t===void 0&&(t=k.KEY_LOAD_ERROR),new ke({type:N.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:a,error:r,networkDetails:i})},n.loadClear=function(e,t){var r=this;if(this.emeController&&this.config.emeEnabled)for(var i=e.sn,a=e.cc,o=function(){var h=t[l];if(a<=h.cc&&(i==="initSegment"||h.sn==="initSegment"||i<h.sn))return r.emeController.selectKeySystemFormat(h).then(function(u){h.setKeyFormat(u)}),"break"},l=0;l<t.length&&o()!=="break";l++);},n.load=function(e){var t=this;return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then(function(r){return t.loadInternal(e,r)}):this.loadInternal(e)},n.loadInternal=function(e,t){var r,i;t&&e.setKeyFormat(t);var a=e.decryptdata;if(!a){var o=new Error(t?"Expected frag.decryptdata to be defined after setting format "+t:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,k.KEY_LOAD_ERROR,o))}var l=a.uri;if(!l)return Promise.reject(this.createKeyLoadError(e,k.KEY_LOAD_ERROR,new Error('Invalid key URI: "'+l+'"')));var h,u=this.keyUriToKeyInfo[l];if((r=u)!=null&&r.decryptdata.key)return a.key=u.decryptdata.key,Promise.resolve({frag:e,keyInfo:u});if((i=u)!=null&&i.keyLoadPromise)switch((h=u.mediaKeySessionContext)==null?void 0:h.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return u.keyLoadPromise.then(function(d){return a.key=d.keyInfo.decryptdata.key,{frag:e,keyInfo:u}})}switch(u=this.keyUriToKeyInfo[l]={decryptdata:a,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},a.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return a.keyFormat==="identity"?this.loadKeyHTTP(u,e):this.loadKeyEME(u,e);case"AES-128":return this.loadKeyHTTP(u,e);default:return Promise.reject(this.createKeyLoadError(e,k.KEY_LOAD_ERROR,new Error('Key supplied with unsupported METHOD: "'+a.method+'"')))}},n.loadKeyEME=function(e,t){var r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var i=this.emeController.loadKey(r);if(i)return(e.keyLoadPromise=i.then(function(a){return e.mediaKeySessionContext=a,r})).catch(function(a){throw e.keyLoadPromise=null,a})}return Promise.resolve(r)},n.loadKeyHTTP=function(e,t){var r=this,i=this.config,a=new i.loader(i);return t.keyLoader=e.loader=a,e.keyLoadPromise=new Promise(function(o,l){var h={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},u=i.keyLoadPolicy.default,d={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:function(f,g,m,T){var v=m.frag,p=m.keyInfo,S=m.url;if(!v.decryptdata||p!==r.keyUriToKeyInfo[S])return l(r.createKeyLoadError(v,k.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),T));p.decryptdata.key=v.decryptdata.key=new Uint8Array(f.data),v.keyLoader=null,p.loader=null,o({frag:v,keyInfo:p})},onError:function(f,g,m,T){r.resetLoader(g),l(r.createKeyLoadError(t,k.KEY_LOAD_ERROR,new Error("HTTP Error "+f.code+" loading key "+f.text),m,ne({url:h.url,data:void 0},f)))},onTimeout:function(f,g,m){r.resetLoader(g),l(r.createKeyLoadError(t,k.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),m))},onAbort:function(f,g,m){r.resetLoader(g),l(r.createKeyLoadError(t,k.INTERNAL_ABORTED,new Error("key loading aborted"),m))}};a.load(h,d,c)})},n.resetLoader=function(e){var t=e.frag,r=e.keyInfo,i=e.url,a=r.loader;t.keyLoader===a&&(t.keyLoader=null,r.loader=null),delete this.keyUriToKeyInfo[i],a&&a.destroy()},s}(),ja=function(){function s(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var n=s.prototype;return n.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},n.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},n.onHandlerDestroyed=function(){},n.hasInterval=function(){return!!this._tickInterval},n.hasNextTick=function(){return!!this._tickTimer},n.setInterval=function(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)},n.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},n.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},n.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},n.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},n.doTick=function(){},s}(),qa={length:0,start:function(){return 0},end:function(){return 0}},Q=function(){function s(){}return s.isBuffered=function(n,e){try{if(n){for(var t=s.getBuffered(n),r=0;r<t.length;r++)if(e>=t.start(r)&&e<=t.end(r))return!0}}catch{}return!1},s.bufferInfo=function(n,e,t){try{if(n){var r,i=s.getBuffered(n),a=[];for(r=0;r<i.length;r++)a.push({start:i.start(r),end:i.end(r)});return this.bufferedInfo(a,e,t)}}catch{}return{len:0,start:e,end:e,nextStart:void 0}},s.bufferedInfo=function(n,e,t){e=Math.max(0,e),n.sort(function(m,T){var v=m.start-T.start;return v||T.end-m.end});var r=[];if(t)for(var i=0;i<n.length;i++){var a=r.length;if(a){var o=r[a-1].end;n[i].start-o<t?n[i].end>o&&(r[a-1].end=n[i].end):r.push(n[i])}else r.push(n[i])}else r=n;for(var l,h=0,u=e,d=e,c=0;c<r.length;c++){var f=r[c].start,g=r[c].end;if(e+t>=f&&e<g)u=f,h=(d=g)-e;else if(e+t<f){l=f;break}}return{len:h,start:u||0,end:d||0,nextStart:l}},s.getBuffered=function(n){try{return n.buffered}catch(e){return R.log("failed to get media.buffered",e),qa}},s}(),Dr=function(s,n,e,t,r,i){t===void 0&&(t=0),r===void 0&&(r=-1),i===void 0&&(i=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=s,this.sn=n,this.id=e,this.size=t,this.part=r,this.partial=i};function ln(s,n){for(var e=null,t=0,r=s.length;t<r;t++){var i=s[t];if(i&&i.cc===n){e=i;break}}return e}function un(s,n){if(s){var e=s.start+n;s.start=s.startPTS=e,s.endPTS=e+s.duration}}function Ir(s,n){for(var e=n.fragments,t=0,r=e.length;t<r;t++)un(e[t],s);n.fragmentHint&&un(n.fragmentHint,s),n.alignedSliding=!0}function za(s,n,e){n&&(function(t,r,i){if(function(o,l,h){return!(!l.details||!(h.endCC>h.startCC||o&&o.cc<h.startCC))}(t,i,r)){var a=function(o,l,h){var u=o.fragments,d=l.fragments;if(d.length&&u.length){var c=ln(u,d[0].cc);if(c&&(!c||c.startPTS))return c;R.log("No frag in previous level to align on")}else R.log("No fragments to align")}(i.details,r);a&&F(a.start)&&(R.log("Adjusting PTS using last level due to CC increase within current level "+r.url),Ir(a.start,r))}}(s,e,n),!e.alignedSliding&&n.details&&function(t,r){if(r.fragments.length&&t.hasProgramDateTime&&r.hasProgramDateTime){var i=r.fragments[0].programDateTime,a=t.fragments[0].programDateTime,o=(a-i)/1e3+r.fragments[0].start;o&&F(o)&&(R.log("Adjusting PTS using programDateTime delta "+(a-i)+"ms, sliding:"+o.toFixed(3)+" "+t.url+" "),Ir(o,t))}}(e,n.details),e.alignedSliding||!n.details||e.skippedSegments||Xi(n.details,e))}function hn(s,n){if(s.hasProgramDateTime&&n.hasProgramDateTime){var e=s.fragments,t=n.fragments;if(e.length&&t.length){var r=t[Math.round(t.length/2)-1],i=ln(e,r.cc)||e[Math.round(e.length/2)-1],a=r.programDateTime,o=i.programDateTime;a!==null&&o!==null&&Ir((o-a)/1e3-(i.start-r.start),s)}}}var Xa=function(){function s(n,e){this.subtle=void 0,this.aesIV=void 0,this.subtle=n,this.aesIV=e}return s.prototype.decrypt=function(n,e){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,n)},s}(),Qa=function(){function s(n,e){this.subtle=void 0,this.key=void 0,this.subtle=n,this.key=e}return s.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},s}(),$a=function(){function s(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var n=s.prototype;return n.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),r=new Uint32Array(4),i=0;i<4;i++)r[i]=t.getUint32(4*i);return r},n.initTable=function(){var e=this.sBox,t=this.invSBox,r=this.subMix,i=r[0],a=r[1],o=r[2],l=r[3],h=this.invSubMix,u=h[0],d=h[1],c=h[2],f=h[3],g=new Uint32Array(256),m=0,T=0,v=0;for(v=0;v<256;v++)g[v]=v<128?v<<1:v<<1^283;for(v=0;v<256;v++){var p=T^T<<1^T<<2^T<<3^T<<4;p=p>>>8^255&p^99,e[m]=p,t[p]=m;var S=g[m],E=g[S],L=g[E],A=257*g[p]^16843008*p;i[m]=A<<24|A>>>8,a[m]=A<<16|A>>>16,o[m]=A<<8|A>>>24,l[m]=A,A=16843009*L^65537*E^257*S^16843008*m,u[p]=A<<24|A>>>8,d[p]=A<<16|A>>>16,c[p]=A<<8|A>>>24,f[p]=A,m?(m=S^g[g[g[L^S]]],T^=g[g[T]]):m=T=1}},n.expandKey=function(e){for(var t=this.uint8ArrayToUint32Array_(e),r=!0,i=0;i<t.length&&r;)r=t[i]===this.key[i],i++;if(!r){this.key=t;var a=this.keySize=t.length;if(a!==4&&a!==6&&a!==8)throw new Error("Invalid aes key size="+a);var o,l,h,u,d=this.ksRows=4*(a+6+1),c=this.keySchedule=new Uint32Array(d),f=this.invKeySchedule=new Uint32Array(d),g=this.sBox,m=this.rcon,T=this.invSubMix,v=T[0],p=T[1],S=T[2],E=T[3];for(o=0;o<d;o++)o<a?h=c[o]=t[o]:(u=h,o%a==0?(u=g[(u=u<<8|u>>>24)>>>24]<<24|g[u>>>16&255]<<16|g[u>>>8&255]<<8|g[255&u],u^=m[o/a|0]<<24):a>6&&o%a==4&&(u=g[u>>>24]<<24|g[u>>>16&255]<<16|g[u>>>8&255]<<8|g[255&u]),c[o]=h=(c[o-a]^u)>>>0);for(l=0;l<d;l++)o=d-l,u=3&l?c[o]:c[o-4],f[l]=l<4||o<=4?u:v[g[u>>>24]]^p[g[u>>>16&255]]^S[g[u>>>8&255]]^E[g[255&u]],f[l]=f[l]>>>0}},n.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},n.decrypt=function(e,t,r){for(var i,a,o,l,h,u,d,c,f,g,m,T,v,p,S=this.keySize+6,E=this.invKeySchedule,L=this.invSBox,A=this.invSubMix,b=A[0],w=A[1],D=A[2],I=A[3],_=this.uint8ArrayToUint32Array_(r),C=_[0],x=_[1],B=_[2],P=_[3],O=new Int32Array(e),U=new Int32Array(O.length),M=this.networkToHostOrderSwap;t<O.length;){for(f=M(O[t]),g=M(O[t+1]),m=M(O[t+2]),T=M(O[t+3]),h=f^E[0],u=T^E[1],d=m^E[2],c=g^E[3],v=4,p=1;p<S;p++)i=b[h>>>24]^w[u>>16&255]^D[d>>8&255]^I[255&c]^E[v],a=b[u>>>24]^w[d>>16&255]^D[c>>8&255]^I[255&h]^E[v+1],o=b[d>>>24]^w[c>>16&255]^D[h>>8&255]^I[255&u]^E[v+2],l=b[c>>>24]^w[h>>16&255]^D[u>>8&255]^I[255&d]^E[v+3],h=i,u=a,d=o,c=l,v+=4;i=L[h>>>24]<<24^L[u>>16&255]<<16^L[d>>8&255]<<8^L[255&c]^E[v],a=L[u>>>24]<<24^L[d>>16&255]<<16^L[c>>8&255]<<8^L[255&h]^E[v+1],o=L[d>>>24]<<24^L[c>>16&255]<<16^L[h>>8&255]<<8^L[255&u]^E[v+2],l=L[c>>>24]<<24^L[h>>16&255]<<16^L[u>>8&255]<<8^L[255&d]^E[v+3],U[t]=M(i^C),U[t+1]=M(l^x),U[t+2]=M(o^B),U[t+3]=M(a^P),C=f,x=g,B=m,P=T,t+=4}return U.buffer},s}(),wr=function(){function s(e,t){var r=(t===void 0?{}:t).removePKCS7Padding,i=r===void 0||r;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=i,i)try{var a=self.crypto;a&&(this.subtle=a.subtle||a.webkitSubtle)}catch{}this.subtle===null&&(this.useSoftware=!0)}var n=s.prototype;return n.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},n.isSync=function(){return this.useSoftware},n.flush=function(){var e=this.currentResult,t=this.remainderData;if(!e||t)return this.reset(),null;var r,i,a,o=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?(i=(r=o).byteLength,(a=i&&new DataView(r.buffer).getUint8(i-1))?Be(r,0,i-a):r):o},n.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},n.decrypt=function(e,t,r){var i=this;return this.useSoftware?new Promise(function(a,o){i.softwareDecrypt(new Uint8Array(e),t,r);var l=i.flush();l?a(l.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,r)},n.softwareDecrypt=function(e,t,r){var i=this.currentIV,a=this.currentResult,o=this.remainderData;this.logOnce("JS AES decrypt"),o&&(e=Ge(o,e),this.remainderData=null);var l=this.getValidChunk(e);if(!l.length)return null;i&&(r=i);var h=this.softwareDecrypter;h||(h=this.softwareDecrypter=new $a),h.expandKey(t);var u=a;return this.currentResult=h.decrypt(l.buffer,0,r),this.currentIV=Be(l,-16).buffer,u||null},n.webCryptoDecrypt=function(e,t,r){var i=this,a=this.subtle;return this.key===t&&this.fastAesKey||(this.key=t,this.fastAesKey=new Qa(a,t)),this.fastAesKey.expandKey().then(function(o){return a?(i.logOnce("WebCrypto AES decrypt"),new Xa(a,new Uint8Array(r)).decrypt(e.buffer,o)):Promise.reject(new Error("web crypto not initialized"))}).catch(function(o){return R.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+o.name+": "+o.message),i.onWebCryptoError(e,t,r)})},n.onWebCryptoError=function(e,t,r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r);var i=this.flush();if(i)return i.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")},n.getValidChunk=function(e){var t=e,r=e.length-e.length%16;return r!==e.length&&(t=Be(e,0,r),this.remainderData=Be(e,r)),t},n.logOnce=function(e){this.logEnabled&&(R.log("[decrypter]: "+e),this.logEnabled=!1)},s}(),Ja=function(s){for(var n="",e=s.length,t=0;t<e;t++)n+="["+s.start(t).toFixed(3)+"-"+s.end(t).toFixed(3)+"]";return n},de="STOPPED",V="IDLE",Cr="KEY_LOADING",$e="FRAG_LOADING",Je="FRAG_LOADING_WAITING_RETRY",mt="WAITING_TRACK",De="PARSING",Ut="PARSED",pt="ENDED",Ze="ERROR",yt="WAITING_INIT_PTS",et="WAITING_LEVEL",_r=function(s){function n(t,r,i,a,o){var l;return(l=s.call(this)||this).hls=void 0,l.fragPrevious=null,l.fragCurrent=null,l.fragmentTracker=void 0,l.transmuxer=null,l._state=de,l.playlistType=void 0,l.media=null,l.mediaBuffer=null,l.config=void 0,l.bitrateTest=!1,l.lastCurrentTime=0,l.nextLoadPosition=0,l.startPosition=0,l.startTimeOffset=null,l.loadedmetadata=!1,l.retryDate=0,l.levels=null,l.fragmentLoader=void 0,l.keyLoader=void 0,l.levelLastLoaded=null,l.startFragRequested=!1,l.decrypter=void 0,l.initPTS=[],l.onvseeking=null,l.onvended=null,l.logPrefix="",l.log=void 0,l.warn=void 0,l.playlistType=o,l.logPrefix=a,l.log=R.log.bind(R,a+":"),l.warn=R.warn.bind(R,a+":"),l.hls=t,l.fragmentLoader=new Ya(t.config),l.keyLoader=i,l.fragmentTracker=r,l.config=t.config,l.decrypter=new wr(t.config),t.on(y.MANIFEST_LOADED,l.onManifestLoaded,function(h){if(h===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return h}(l)),l}ae(n,s);var e=n.prototype;return e.doTick=function(){this.onTickEnd()},e.onTickEnd=function(){},e.startLoad=function(t){},e.stopLoad=function(){this.fragmentLoader.abort(),this.keyLoader.abort();var t=this.fragCurrent;t!=null&&t.loader&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=de},e._streamEnded=function(t,r){if(r.live||t.nextStart||!t.end||!this.media)return!1;var i=r.partList;if(i!=null&&i.length){var a=i[i.length-1];return Q.isBuffered(this.media,a.start+a.duration/2)}var o=r.fragments[r.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(o)},e.getLevelDetails=function(){var t;if(this.levels&&this.levelLastLoaded!==null)return(t=this.levels[this.levelLastLoaded])==null?void 0:t.details},e.onMediaAttached=function(t,r){var i=this.media=this.mediaBuffer=r.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),i.addEventListener("seeking",this.onvseeking),i.addEventListener("ended",this.onvended);var a=this.config;this.levels&&a.autoStartLoad&&this.state===de&&this.startLoad(a.startPosition)},e.onMediaDetaching=function(){var t=this.media;t!=null&&t.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),t&&this.onvseeking&&this.onvended&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},e.onMediaSeeking=function(){var t=this.config,r=this.fragCurrent,i=this.media,a=this.mediaBuffer,o=this.state,l=i?i.currentTime:0,h=Q.bufferInfo(a||i,l,t.maxBufferHole);if(this.log("media seeking to "+(F(l)?l.toFixed(3):l)+", state: "+o),this.state===pt)this.resetLoadingState();else if(r){var u=t.maxFragLookUpTolerance,d=r.start-u,c=r.start+r.duration+u;if(!h.len||c<h.start||d>h.end){var f=l>c;(l<d||f)&&(f&&r.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),r.abortRequests()),this.resetLoadingState())}}i&&(this.fragmentTracker.removeFragmentsInRange(l,1/0,this.playlistType,!0),this.lastCurrentTime=l),this.loadedmetadata||h.len||(this.nextLoadPosition=this.startPosition=l),this.tickImmediate()},e.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},e.onManifestLoaded=function(t,r){this.startTimeOffset=r.startTimeOffset,this.initPTS=[]},e.onHandlerDestroying=function(){this.stopLoad(),s.prototype.onHandlerDestroying.call(this)},e.onHandlerDestroyed=function(){this.state=de,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,s.prototype.onHandlerDestroyed.call(this)},e.loadFragment=function(t,r,i){this._loadFragForPlayback(t,r,i)},e._loadFragForPlayback=function(t,r,i){var a=this;this._doFragLoad(t,r,i,function(o){if(a.fragContextChanged(t))return a.warn("Fragment "+t.sn+(o.part?" p: "+o.part.index:"")+" of level "+t.level+" was dropped during download."),void a.fragmentTracker.removeFragment(t);t.stats.chunkCount++,a._handleFragmentLoadProgress(o)}).then(function(o){if(o){var l=a.state;a.fragContextChanged(t)?(l===$e||!a.fragCurrent&&l===De)&&(a.fragmentTracker.removeFragment(t),a.state=V):("payload"in o&&(a.log("Loaded fragment "+t.sn+" of level "+t.level),a.hls.trigger(y.FRAG_LOADED,o)),a._handleFragmentLoadComplete(o))}}).catch(function(o){a.state!==de&&a.state!==Ze&&(a.warn(o),a.resetFragmentLoading(t))})},e.clearTrackerIfNeeded=function(t){var r;if(this.fragmentTracker.getState(t)===nn){var i=t.type,a=this.getFwdBufferInfo(this.mediaBuffer,i),o=Math.max(t.duration,a?a.len:this.config.maxBufferLength);this.reduceMaxBufferLength(o)&&this.fragmentTracker.removeFragment(t)}else((r=this.mediaBuffer)==null?void 0:r.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},e.flushMainBuffer=function(t,r,i){if(i===void 0&&(i=null),t-r){var a={startOffset:t,endOffset:r,type:i};this.hls.trigger(y.BUFFER_FLUSHING,a)}},e._loadInitSegment=function(t,r){var i=this;this._doFragLoad(t,r).then(function(a){if(!a||i.fragContextChanged(t)||!i.levels)throw new Error("init load aborted");return a}).then(function(a){var o=i.hls,l=a.payload,h=t.decryptdata;if(l&&l.byteLength>0&&h&&h.key&&h.iv&&h.method==="AES-128"){var u=self.performance.now();return i.decrypter.decrypt(new Uint8Array(l),h.key.buffer,h.iv.buffer).catch(function(d){throw o.trigger(y.ERROR,{type:N.MEDIA_ERROR,details:k.FRAG_DECRYPT_ERROR,fatal:!1,error:d,reason:d.message,frag:t}),d}).then(function(d){var c=self.performance.now();return o.trigger(y.FRAG_DECRYPTED,{frag:t,payload:d,stats:{tstart:u,tdecrypt:c}}),a.payload=d,a})}return a}).then(function(a){var o=i.fragCurrent,l=i.hls;if(!i.levels)throw new Error("init load aborted, missing levels");var h=t.stats;i.state=V,r.fragmentError=0,t.data=new Uint8Array(a.payload),h.parsing.start=h.buffering.start=self.performance.now(),h.parsing.end=h.buffering.end=self.performance.now(),a.frag===o&&l.trigger(y.FRAG_BUFFERED,{stats:h,frag:o,part:null,id:t.type}),i.tick()}).catch(function(a){i.state!==de&&i.state!==Ze&&(i.warn(a),i.resetFragmentLoading(t))})},e.fragContextChanged=function(t){var r=this.fragCurrent;return!t||!r||t.level!==r.level||t.sn!==r.sn||t.urlId!==r.urlId},e.fragBufferedComplete=function(t,r){var i,a,o,l,h=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+t.type+" sn: "+t.sn+(r?" part: "+r.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+t.level+" (frag:["+((i=t.startPTS)!=null?i:NaN).toFixed(3)+"-"+((a=t.endPTS)!=null?a:NaN).toFixed(3)+"] > buffer:"+(h?Ja(Q.getBuffered(h)):"(detached)")+")"),this.state=V,h&&(!this.loadedmetadata&&t.type==j&&h.buffered.length&&((o=this.fragCurrent)==null?void 0:o.sn)===((l=this.fragPrevious)==null?void 0:l.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},e.seekToStartPos=function(){},e._handleFragmentLoadComplete=function(t){var r=this.transmuxer;if(r){var i=t.frag,a=t.part,o=t.partsLoaded,l=!o||o.length===0||o.some(function(u){return!u}),h=new Dr(i.level,i.sn,i.stats.chunkCount+1,0,a?a.index:-1,!l);r.flush(h)}},e._handleFragmentLoadProgress=function(t){},e._doFragLoad=function(t,r,i,a){var o,l=this;i===void 0&&(i=null);var h=r==null?void 0:r.details;if(!this.levels||!h)throw new Error("frag load aborted, missing level"+(h?"":" detail")+"s");var u=null;if(!t.encrypted||(o=t.decryptdata)!=null&&o.key?!t.encrypted&&h.encryptedFragments.length&&this.keyLoader.loadClear(t,h.encryptedFragments):(this.log("Loading key for "+t.sn+" of ["+h.startSN+"-"+h.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+t.level),this.state=Cr,this.fragCurrent=t,u=this.keyLoader.load(t).then(function(v){if(!l.fragContextChanged(v.frag))return l.hls.trigger(y.KEY_LOADED,v),l.state===Cr&&(l.state=V),v}),this.hls.trigger(y.KEY_LOADING,{frag:t}),this.fragCurrent===null&&(u=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))),i=Math.max(t.start,i||0),this.config.lowLatencyMode){var d=h.partList;if(d&&a){i>t.end&&h.fragmentHint&&(t=h.fragmentHint);var c=this.getNextPart(d,t,i);if(c>-1){var f,g=d[c];return this.log("Loading part sn: "+t.sn+" p: "+g.index+" cc: "+t.cc+" of playlist ["+h.startSN+"-"+h.endSN+"] parts [0-"+c+"-"+(d.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+t.level+", target: "+parseFloat(i.toFixed(3))),this.nextLoadPosition=g.start+g.duration,this.state=$e,f=u?u.then(function(v){return!v||l.fragContextChanged(v.frag)?null:l.doFragPartsLoad(t,g,r,a)}).catch(function(v){return l.handleFragLoadError(v)}):this.doFragPartsLoad(t,g,r,a).catch(function(v){return l.handleFragLoadError(v)}),this.hls.trigger(y.FRAG_LOADING,{frag:t,part:g,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):f}if(!t.url||this.loadedEndOfParts(d,i))return Promise.resolve(null)}}this.log("Loading fragment "+t.sn+" cc: "+t.cc+" "+(h?"of ["+h.startSN+"-"+h.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+t.level+", target: "+parseFloat(i.toFixed(3))),F(t.sn)&&!this.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),this.state=$e;var m,T=this.config.progressive;return m=T&&u?u.then(function(v){return!v||l.fragContextChanged(v==null?void 0:v.frag)?null:l.fragmentLoader.load(t,a)}).catch(function(v){return l.handleFragLoadError(v)}):Promise.all([this.fragmentLoader.load(t,T?a:void 0),u]).then(function(v){var p=v[0];return!T&&p&&a&&a(p),p}).catch(function(v){return l.handleFragLoadError(v)}),this.hls.trigger(y.FRAG_LOADING,{frag:t,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):m},e.doFragPartsLoad=function(t,r,i,a){var o=this;return new Promise(function(l,h){var u,d=[],c=(u=i.details)==null?void 0:u.partList;(function f(g){o.fragmentLoader.loadPart(t,g,a).then(function(m){d[g.index]=m;var T=m.part;o.hls.trigger(y.FRAG_LOADED,m);var v=Qi(i,t.sn,g.index+1)||$i(c,t.sn,g.index+1);if(!v)return l({frag:t,part:T,partsLoaded:d});f(v)}).catch(h)})(r)})},e.handleFragLoadError=function(t){if("data"in t){var r=t.data;t.data&&r.details===k.INTERNAL_ABORTED?this.handleFragLoadAborted(r.frag,r.part):this.hls.trigger(y.ERROR,r)}else this.hls.trigger(y.ERROR,{type:N.OTHER_ERROR,details:k.INTERNAL_EXCEPTION,err:t,error:t,fatal:!0});return null},e._handleTransmuxerFlush=function(t){var r=this.getCurrentContext(t);if(r&&this.state===De){var i=r.frag,a=r.part,o=r.level,l=self.performance.now();i.stats.parsing.end=l,a&&(a.stats.parsing.end=l),this.updateLevelTiming(i,a,o,t.partial)}else this.fragCurrent||this.state===de||this.state===Ze||(this.state=V)},e.getCurrentContext=function(t){var r=this.levels,i=this.fragCurrent,a=t.level,o=t.sn,l=t.part;if(r==null||!r[a])return this.warn("Levels object was unset while buffering fragment "+o+" of level "+a+". The current chunk will not be buffered."),null;var h=r[a],u=l>-1?Qi(h,o,l):null,d=u?u.fragment:function(c,f,g){if(c==null||!c.details)return null;var m=c.details,T=m.fragments[f-m.startSN];return T||((T=m.fragmentHint)&&T.sn===f?T:f<m.startSN&&g&&g.sn===f?g:null)}(h,o,i);return d?(i&&i!==d&&(d.stats=i.stats),{frag:d,part:u,level:h}):null},e.bufferFragmentData=function(t,r,i,a){var o;if(t&&this.state===De){var l=t.data1,h=t.data2,u=l;if(l&&h&&(u=Ge(l,h)),(o=u)!=null&&o.length){var d={type:t.type,frag:r,part:i,chunkMeta:a,parent:r.type,data:u};this.hls.trigger(y.BUFFER_APPENDING,d),t.dropped&&t.independent&&!i&&this.flushBufferGap(r)}}},e.flushBufferGap=function(t){var r=this.media;if(r)if(Q.isBuffered(r,r.currentTime)){var i=r.currentTime,a=Q.bufferInfo(r,i,0),o=t.duration,l=Math.min(2*this.config.maxFragLookUpTolerance,.25*o),h=Math.max(Math.min(t.start-l,a.end-l),i+l);t.start-h>l&&this.flushMainBuffer(h,t.start)}else this.flushMainBuffer(0,t.start)},e.getFwdBufferInfo=function(t,r){var i=this.getLoadPosition();return F(i)?this.getFwdBufferInfoAtPos(t,i,r):null},e.getFwdBufferInfoAtPos=function(t,r,i){var a=this.config.maxBufferHole,o=Q.bufferInfo(t,r,a);if(o.len===0&&o.nextStart!==void 0){var l=this.fragmentTracker.getBufferedFrag(r,i);if(l&&o.nextStart<l.end)return Q.bufferInfo(t,r,Math.max(o.nextStart,a))}return o},e.getMaxBufferLength=function(t){var r,i=this.config;return r=t?Math.max(8*i.maxBufferSize/t,i.maxBufferLength):i.maxBufferLength,Math.min(r,i.maxMaxBufferLength)},e.reduceMaxBufferLength=function(t){var r=this.config,i=t||r.maxBufferLength;return r.maxMaxBufferLength>=i&&(r.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+r.maxMaxBufferLength+"s"),!0)},e.getNextFragment=function(t,r){var i=r.fragments,a=i.length;if(!a)return null;var o,l=this.config,h=i[0].start;if(r.live){var u=l.initialLiveManifestSize;if(a<u)return this.warn("Not enough fragments to start playback (have: "+a+", need: "+u+")"),null;r.PTSKnown||this.startFragRequested||this.startPosition!==-1||(o=this.getInitialLiveFragment(r,i),this.startPosition=o?this.hls.liveSyncPosition||o.start:t)}else t<=h&&(o=i[0]);if(!o){var d=l.lowLatencyMode?r.partEnd:r.fragmentEnd;o=this.getFragmentAtPosition(t,d,r)}return this.mapToInitFragWhenRequired(o)},e.isLoopLoading=function(t,r){var i=this.fragmentTracker.getState(t);return(i===vt||i===Nt&&!!t.gap)&&this.nextLoadPosition>r},e.getNextFragmentLoopLoading=function(t,r,i,a,o){var l=t.gap,h=this.getNextFragment(this.nextLoadPosition,r);if(h===null)return h;if(t=h,l&&t&&!t.gap&&i.nextStart){var u=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,a);if(u!==null&&i.len+u.len>=o)return this.log('buffer full after gaps in "'+a+'" playlist starting at sn: '+t.sn),null}return t},e.mapToInitFragWhenRequired=function(t){return t==null||!t.initSegment||t!=null&&t.initSegment.data||this.bitrateTest?t:t.initSegment},e.getNextPart=function(t,r,i){for(var a=-1,o=!1,l=!0,h=0,u=t.length;h<u;h++){var d=t[h];if(l=l&&!d.independent,a>-1&&i<d.start)break;var c=d.loaded;c?a=-1:(o||d.independent||l)&&d.fragment===r&&(a=h),o=c}return a},e.loadedEndOfParts=function(t,r){var i=t[t.length-1];return i&&r>i.start&&i.loaded},e.getInitialLiveFragment=function(t,r){var i=this.fragPrevious,a=null;if(i){if(t.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+i.programDateTime),a=function(u,d,c){if(d===null||!Array.isArray(u)||!u.length||!F(d)||d<(u[0].programDateTime||0)||d>=(u[u.length-1].endProgramDateTime||0))return null;c=c||0;for(var f=0;f<u.length;++f){var g=u[f];if(Ba(d,c,g))return g}return null}(r,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!a){var o=i.sn+1;if(o>=t.startSN&&o<=t.endSN){var l=r[o-t.startSN];i.cc===l.cc&&(a=l,this.log("Live playlist, switching playlist, load frag with next SN: "+a.sn))}a||(a=function(u,d){return en(u,function(c){return c.cc<d?1:c.cc>d?-1:0})}(r,i.cc),a&&this.log("Live playlist, switching playlist, load frag with same CC: "+a.sn))}}else{var h=this.hls.liveSyncPosition;h!==null&&(a=this.getFragmentAtPosition(h,this.bitrateTest?t.fragmentEnd:t.edge,t))}return a},e.getFragmentAtPosition=function(t,r,i){var a,o=this.config,l=this.fragPrevious,h=i.fragments,u=i.endSN,d=i.fragmentHint,c=o.maxFragLookUpTolerance,f=!!(o.lowLatencyMode&&i.partList&&d);if(f&&d&&!this.bitrateTest&&(h=h.concat(d),u=d.sn),a=t<r?gt(l,h,t,t>r-c?0:c):h[h.length-1]){var g=a.sn-i.startSN,m=this.fragmentTracker.getState(a);if((m===vt||m===Nt&&a.gap)&&(l=a),l&&a.sn===l.sn&&!f&&l&&a.level===l.level){var T=h[g+1];a=a.sn<u&&this.fragmentTracker.getState(T)!==vt?T:null}}return a},e.synchronizeToLiveEdge=function(t){var r=this.config,i=this.media;if(i){var a=this.hls.liveSyncPosition,o=i.currentTime,l=t.fragments[0].start,h=t.edge,u=o>=l-r.maxFragLookUpTolerance&&o<=h;if(a!==null&&i.duration>a&&(o<a||!u)){var d=r.liveMaxLatencyDuration!==void 0?r.liveMaxLatencyDuration:r.liveMaxLatencyDurationCount*t.targetduration;(!u&&i.readyState<4||o<h-d)&&(this.loadedmetadata||(this.nextLoadPosition=a),i.readyState&&(this.warn("Playback: "+o.toFixed(3)+" is located too far from the end of live sliding playlist: "+h+", reset currentTime to : "+a.toFixed(3)),i.currentTime=a))}}},e.alignPlaylists=function(t,r){var i=this.levels,a=this.levelLastLoaded,o=this.fragPrevious,l=a!==null?i[a]:null,h=t.fragments.length;if(!h)return this.warn("No fragments in live playlist"),0;var u=t.fragments[0].start,d=!r,c=t.alignedSliding&&F(u);if(d||!c&&!u){za(o,l,t);var f=t.fragments[0].start;return this.log("Live playlist sliding: "+f.toFixed(2)+" start-sn: "+(r?r.startSN:"na")+"->"+t.startSN+" prev-sn: "+(o?o.sn:"na")+" fragments: "+h),f}return u},e.waitForCdnTuneIn=function(t){return t.live&&t.canBlockReload&&t.partTarget&&t.tuneInGoal>Math.max(t.partHoldBack,3*t.partTarget)},e.setStartPosition=function(t,r){var i=this.startPosition;if(i<r&&(i=-1),i===-1||this.lastCurrentTime===-1){var a=this.startTimeOffset!==null,o=a?this.startTimeOffset:t.startTimeOffset;o!==null&&F(o)?(i=r+o,o<0&&(i+=t.totalduration),i=Math.min(Math.max(r,i),r+t.totalduration),this.log("Start time offset "+o+" found in "+(a?"multivariant":"media")+" playlist, adjust startPosition to "+i),this.startPosition=i):t.live?i=this.hls.liveSyncPosition||r:this.startPosition=i=0,this.lastCurrentTime=i}this.nextLoadPosition=i},e.getLoadPosition=function(){var t=this.media,r=0;return this.loadedmetadata&&t?r=t.currentTime:this.nextLoadPosition&&(r=this.nextLoadPosition),r},e.handleFragLoadAborted=function(t,r){this.transmuxer&&t.sn!=="initSegment"&&t.stats.aborted&&(this.warn("Fragment "+t.sn+(r?" part"+r.index:"")+" of level "+t.level+" was aborted"),this.resetFragmentLoading(t))},e.resetFragmentLoading=function(t){this.fragCurrent&&(this.fragContextChanged(t)||this.state===Je)||(this.state=V)},e.onFragmentOrKeyLoadError=function(t,r){if(r.chunkMeta&&!r.frag){var i=this.getCurrentContext(r.chunkMeta);i&&(r.frag=i.frag)}var a=r.frag;if(a&&a.type===t&&this.levels)if(this.fragContextChanged(a)){var o;this.warn("Frag load error must match current frag to retry "+a.url+" > "+((o=this.fragCurrent)==null?void 0:o.url))}else{var l=r.details===k.FRAG_GAP;l&&this.fragmentTracker.fragBuffered(a,!0);var h=r.errorAction,u=h||{},d=u.action,c=u.retryCount,f=c===void 0?0:c,g=u.retryConfig;if(h&&d===xt&&g){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var m=Sr(g,f);this.warn("Fragment "+a.sn+" of "+t+" "+a.level+" errored with "+r.details+", retrying loading "+(f+1)+"/"+g.maxNumRetry+" in "+m+"ms"),h.resolved=!0,this.retryDate=self.performance.now()+m,this.state=Je}else g&&h?(this.resetFragmentErrors(t),f<g.maxNumRetry?l||(h.resolved=!0):R.warn(r.details+" reached or exceeded max retry ("+f+")")):this.state=Ze;this.tickImmediate()}},e.reduceLengthAndFlushBuffer=function(t){if(this.state===De||this.state===Ut){var r=t.parent,i=this.getFwdBufferInfo(this.mediaBuffer,r),a=i&&i.len>.5;a&&this.reduceMaxBufferLength(i.len);var o=!a;return o&&this.warn("Buffer full error while media.currentTime is not buffered, flush "+r+" buffer"),t.frag&&(this.fragmentTracker.removeFragment(t.frag),this.nextLoadPosition=t.frag.start),this.resetLoadingState(),o}return!1},e.resetFragmentErrors=function(t){t===Le&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==de&&(this.state=V)},e.afterBufferFlushed=function(t,r,i){if(t){var a=Q.getBuffered(t);this.fragmentTracker.detectEvictedFragments(r,a,i),this.state===pt&&this.resetLoadingState()}},e.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=V},e.resetStartWhenNotLoaded=function(t){if(!this.loadedmetadata){this.startFragRequested=!1;var r=this.levels?this.levels[t].details:null;r!=null&&r.live?(this.startPosition=-1,this.setStartPosition(r,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},e.resetWhenMissingContext=function(t){this.warn("The loading context changed while buffering fragment "+t.sn+" of level "+t.level+". This chunk will not be buffered."),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(t.level),this.resetLoadingState()},e.removeUnbufferedFrags=function(t){t===void 0&&(t=0),this.fragmentTracker.removeFragmentsInRange(t,1/0,this.playlistType,!1,!0)},e.updateLevelTiming=function(t,r,i,a){var o,l=this,h=i.details;if(h){if(Object.keys(t.elementaryStreams).reduce(function(d,c){var f=t.elementaryStreams[c];if(f){var g=f.endPTS-f.startPTS;if(g<=0)return l.warn("Could not parse fragment "+t.sn+" "+c+" duration reliably ("+g+")"),d||!1;var m=a?0:zi(h,t,f.startPTS,f.endPTS,f.startDTS,f.endDTS);return l.hls.trigger(y.LEVEL_PTS_UPDATED,{details:h,level:i,drift:m,type:c,frag:t,start:f.startPTS,end:f.endPTS}),!0}return d},!1))i.fragmentError=0;else if(((o=this.transmuxer)==null?void 0:o.error)===null){var u=new Error("Found no media in fragment "+t.sn+" of level "+i.id+" resetting transmuxer to fallback to playlist timing");if(this.warn(u.message),this.hls.trigger(y.ERROR,{type:N.MEDIA_ERROR,details:k.FRAG_PARSING_ERROR,fatal:!1,error:u,frag:t,reason:"Found no media in msn "+t.sn+' of level "'+i.url+'"'}),!this.hls)return;this.resetTransmuxer()}this.state=Ut,this.hls.trigger(y.FRAG_PARSED,{frag:t,part:r})}else this.warn("level.details undefined")},e.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},e.recoverWorkerError=function(t){t.event==="demuxerWorker"&&(this.resetTransmuxer(),this.resetLoadingState())},ee(n,[{key:"state",get:function(){return this._state},set:function(t){var r=this._state;r!==t&&(this._state=t,this.log(r+"->"+t))}}]),n}(ja);function Pr(){if(typeof self<"u")return self.MediaSource||self.WebKitMediaSource}function dn(){return self.SourceBuffer||self.WebKitSourceBuffer}function Re(s,n){return s===void 0&&(s=""),n===void 0&&(n=9e4),{type:s,id:-1,pid:-1,inputTimeScale:n,sequenceNumber:-1,samples:[],dropped:0}}var cn=function(){function s(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var n=s.prototype;return n.resetInitSegment=function(e,t,r,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},n.resetTimeStamp=function(e){this.initPTS=e,this.resetContiguity()},n.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},n.canParse=function(e,t){return!1},n.appendFrame=function(e,t,r){},n.demux=function(e,t){this.cachedData&&(e=Ge(this.cachedData,e),this.cachedData=null);var r,i=kt(e,0),a=i?i.length:0,o=this._audioTrack,l=this._id3Track,h=i?function(f){for(var g=Ri(f),m=0;m<g.length;m++){var T=g[m];if(Li(T))return Ea(T)}}(i):void 0,u=e.length;for((this.basePTS===null||this.frameIndex===0&&F(h))&&(this.basePTS=Za(h,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&l.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:dt,duration:Number.POSITIVE_INFINITY});a<u;){if(this.canParse(e,a)){var d=this.appendFrame(o,e,a);d?(this.frameIndex++,this.lastPTS=d.sample.pts,r=a+=d.length):a=u}else ga(e,a)?(i=kt(e,a),l.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:dt,duration:Number.POSITIVE_INFINITY}),r=a+=i.length):a++;if(a===u&&r!==u){var c=Be(e,r);this.cachedData?this.cachedData=Ge(this.cachedData,c):this.cachedData=c}}return{audioTrack:o,videoTrack:Re(),id3Track:l,textTrack:Re()}},n.demuxSampleAes=function(e,t,r){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},n.flush=function(e){var t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Re(),id3Track:this._id3Track,textTrack:Re()}},n.destroy=function(){},s}(),Za=function(s,n,e){return F(s)?90*s:9e4*n+(e?9e4*e.baseTime/e.timescale:0)};function fn(s,n){return s[n]===255&&(246&s[n+1])==240}function gn(s,n){return 1&s[n+1]?7:9}function xr(s,n){return(3&s[n+3])<<11|s[n+4]<<3|(224&s[n+5])>>>5}function Bt(s,n){return n+1<s.length&&fn(s,n)}function es(s,n){if(Bt(s,n)){var e=gn(s,n);if(n+e>=s.length)return!1;var t=xr(s,n);if(t<=e)return!1;var r=n+t;return r===s.length||Bt(s,r)}return!1}function vn(s,n,e,t,r){if(!s.samplerate){var i=function(a,o,l,h){var u,d,c,f,g=navigator.userAgent.toLowerCase(),m=h,T=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];u=1+((192&o[l+2])>>>6);var v=(60&o[l+2])>>>2;if(!(v>T.length-1))return c=(1&o[l+2])<<2,c|=(192&o[l+3])>>>6,R.log("manifest codec:"+h+", ADTS type:"+u+", samplingIndex:"+v),/firefox/i.test(g)?v>=6?(u=5,f=new Array(4),d=v-3):(u=2,f=new Array(2),d=v):g.indexOf("android")!==-1?(u=2,f=new Array(2),d=v):(u=5,f=new Array(4),h&&(h.indexOf("mp4a.40.29")!==-1||h.indexOf("mp4a.40.5")!==-1)||!h&&v>=6?d=v-3:((h&&h.indexOf("mp4a.40.2")!==-1&&(v>=6&&c===1||/vivaldi/i.test(g))||!h&&c===1)&&(u=2,f=new Array(2)),d=v)),f[0]=u<<3,f[0]|=(14&v)>>1,f[1]|=(1&v)<<7,f[1]|=c<<3,u===5&&(f[1]|=(14&d)>>1,f[2]=(1&d)<<7,f[2]|=8,f[3]=0),{config:f,samplerate:T[v],channelCount:c,codec:"mp4a.40."+u,manifestCodec:m};a.trigger(y.ERROR,{type:N.MEDIA_ERROR,details:k.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+v})}(n,e,t,r);if(!i)return;s.config=i.config,s.samplerate=i.samplerate,s.channelCount=i.channelCount,s.codec=i.codec,s.manifestCodec=i.manifestCodec,R.log("parsed codec:"+s.codec+", rate:"+i.samplerate+", channels:"+i.channelCount)}}function mn(s){return 9216e4/s}function pn(s,n,e,t,r){var i,a=t+r*mn(s.samplerate),o=function(g,m){var T=gn(g,m);if(m+T<=g.length){var v=xr(g,m)-T;if(v>0)return{headerLength:T,frameLength:v}}}(n,e);if(o){var l=o.frameLength,h=o.headerLength,u=h+l,d=Math.max(0,e+u-n.length);d?(i=new Uint8Array(u-h)).set(n.subarray(e+h,n.length),0):i=n.subarray(e+h,e+u);var c={unit:i,pts:a};return d||s.samples.push(c),{sample:c,length:u,missing:d}}var f=n.length-e;return(i=new Uint8Array(f)).set(n.subarray(e,n.length),0),{sample:{unit:i,pts:a},length:f,missing:-1}}var ts=function(s){function n(t,r){var i;return(i=s.call(this)||this).observer=void 0,i.config=void 0,i.observer=t,i.config=r,i}ae(n,s);var e=n.prototype;return e.resetInitSegment=function(t,r,i,a){s.prototype.resetInitSegment.call(this,t,r,i,a),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:r,duration:a,inputTimeScale:9e4,dropped:0}},n.probe=function(t){if(!t)return!1;for(var r=(kt(t,0)||[]).length,i=t.length;r<i;r++)if(es(t,r))return R.log("ADTS sync word found !"),!0;return!1},e.canParse=function(t,r){return function(i,a){return function(o,l){return l+5<o.length}(i,a)&&fn(i,a)&&xr(i,a)<=i.length-a}(t,r)},e.appendFrame=function(t,r,i){vn(t,this.observer,r,i,t.manifestCodec);var a=pn(t,r,i,this.basePTS,this.frameIndex);if(a&&a.missing===0)return a},n}(cn),rs=/\/emsg[-/]ID3/i,is=function(){function s(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}var n=s.prototype;return n.resetTimeStamp=function(){},n.resetInitSegment=function(e,t,r,i){var a=this.videoTrack=Re("video",1),o=this.audioTrack=Re("audio",1),l=this.txtTrack=Re("text",1);if(this.id3Track=Re("id3",1),this.timeOffset=0,e!=null&&e.byteLength){var h=Di(e);if(h.video){var u=h.video,d=u.id,c=u.timescale,f=u.codec;a.id=d,a.timescale=l.timescale=c,a.codec=f}if(h.audio){var g=h.audio,m=g.id,T=g.timescale,v=g.codec;o.id=m,o.timescale=T,o.codec=v}l.id=Ai.text,a.sampleDuration=0,a.duration=o.duration=i}},n.resetContiguity=function(){},s.probe=function(e){return W(e=e.length>16384?e.subarray(0,16384):e,["moof"]).length>0},n.demux=function(e,t){this.timeOffset=t;var r=e,i=this.videoTrack,a=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=Ge(this.remainderData,e));var o=function(h){var u={valid:null,remainder:null},d=W(h,["moof"]);if(!d)return u;if(d.length<2)return u.remainder=h,u;var c=d[d.length-1];return u.valid=Be(h,0,c.byteOffset-8),u.remainder=Be(h,c.byteOffset-8),u}(r);this.remainderData=o.remainder,i.samples=o.valid||new Uint8Array}else i.samples=r;var l=this.extractID3Track(i,t);return a.samples=wi(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:l,textTrack:this.txtTrack}},n.flush=function(){var e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;var i=this.extractID3Track(t,this.timeOffset);return r.samples=wi(e,t),{videoTrack:t,audioTrack:Re(),id3Track:i,textTrack:Re()}},n.extractID3Track=function(e,t){var r=this.id3Track;if(e.samples.length){var i=W(e.samples,["emsg"]);i&&i.forEach(function(a){var o=function(d){var c=d[0],f="",g="",m=0,T=0,v=0,p=0,S=0,E=0;if(c===0){for(;te(d.subarray(E,E+1))!=="\0";)f+=te(d.subarray(E,E+1)),E+=1;for(f+=te(d.subarray(E,E+1)),E+=1;te(d.subarray(E,E+1))!=="\0";)g+=te(d.subarray(E,E+1)),E+=1;g+=te(d.subarray(E,E+1)),E+=1,m=G(d,12),T=G(d,16),p=G(d,20),S=G(d,24),E=28}else if(c===1){m=G(d,E+=4);var L=G(d,E+=4),A=G(d,E+=4);for(E+=4,v=Math.pow(2,32)*L+A,Number.isSafeInteger(v)||(v=Number.MAX_SAFE_INTEGER,R.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),p=G(d,E),S=G(d,E+=4),E+=4;te(d.subarray(E,E+1))!=="\0";)f+=te(d.subarray(E,E+1)),E+=1;for(f+=te(d.subarray(E,E+1)),E+=1;te(d.subarray(E,E+1))!=="\0";)g+=te(d.subarray(E,E+1)),E+=1;g+=te(d.subarray(E,E+1)),E+=1}return{schemeIdUri:f,value:g,timeScale:m,presentationTime:v,presentationTimeDelta:T,eventDuration:p,id:S,payload:d.subarray(E,d.byteLength)}}(a);if(rs.test(o.schemeIdUri)){var l=F(o.presentationTime)?o.presentationTime/o.timeScale:t+o.presentationTimeDelta/o.timeScale,h=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;h<=.001&&(h=Number.POSITIVE_INFINITY);var u=o.payload;r.samples.push({data:u,len:u.byteLength,dts:l,pts:l,type:ct,duration:h})}})}return r},n.demuxSampleAes=function(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},n.destroy=function(){},s}(),Gt=null,ns=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],as=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],ss=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],os=[0,1,1,4];function yn(s,n,e,t,r){if(!(e+24>n.length)){var i=Tn(n,e);if(i&&e+i.frameLength<=n.length){var a=t+r*(9e4*i.samplesPerFrame/i.sampleRate),o={unit:n.subarray(e,e+i.frameLength),pts:a,dts:a};return s.config=[],s.channelCount=i.channelCount,s.samplerate=i.sampleRate,s.samples.push(o),{sample:o,length:i.frameLength,missing:0}}}}function Tn(s,n){var e=s[n+1]>>3&3,t=s[n+1]>>1&3,r=s[n+2]>>4&15,i=s[n+2]>>2&3;if(e!==1&&r!==0&&r!==15&&i!==3){var a=s[n+2]>>1&1,o=s[n+3]>>6,l=1e3*ns[14*(e===3?3-t:t===3?3:4)+r-1],h=as[3*(e===3?0:e===2?1:2)+i],u=o===3?1:2,d=ss[e][t],c=os[t],f=8*d*c,g=Math.floor(d*l/h+a)*c;if(Gt===null){var m=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Gt=m?parseInt(m[1]):0}return Gt&&Gt<=87&&t===2&&l>=224e3&&o===0&&(s[n+3]=128|s[n+3]),{sampleRate:h,channelCount:u,frameLength:g,samplesPerFrame:f}}}function Fr(s,n){return s[n]===255&&(224&s[n+1])==224&&(6&s[n+1])!=0}function En(s,n){return n+1<s.length&&Fr(s,n)}function ls(s,n){if(n+1<s.length&&Fr(s,n)){var e=Tn(s,n),t=4;e!=null&&e.frameLength&&(t=e.frameLength);var r=n+t;return r===s.length||En(s,r)}return!1}var Sn=function(){function s(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}var n=s.prototype;return n.loadWord=function(){var e=this.data,t=this.bytesAvailable,r=e.byteLength-t,i=new Uint8Array(4),a=Math.min(4,t);if(a===0)throw new Error("no bytes available");i.set(e.subarray(r,r+a)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*a,this.bytesAvailable-=a},n.skipBits=function(e){var t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,e-=(t=e>>3)<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)},n.readBits=function(e){var t=Math.min(this.bitsAvailable,e),r=this.word>>>32-t;if(e>32&&R.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return(t=e-t)>0&&this.bitsAvailable?r<<t|this.readBits(t):r},n.skipLZ=function(){var e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},n.skipUEG=function(){this.skipBits(1+this.skipLZ())},n.skipEG=function(){this.skipBits(1+this.skipLZ())},n.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},n.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},n.readBoolean=function(){return this.readBits(1)===1},n.readUByte=function(){return this.readBits(8)},n.readUShort=function(){return this.readBits(16)},n.readUInt=function(){return this.readBits(32)},n.skipScalingList=function(e){for(var t=8,r=8,i=0;i<e;i++)r!==0&&(r=(t+this.readEG()+256)%256),t=r===0?t:r},n.readSPS=function(){var e,t,r,i=0,a=0,o=0,l=0,h=this.readUByte.bind(this),u=this.readBits.bind(this),d=this.readUEG.bind(this),c=this.readBoolean.bind(this),f=this.skipBits.bind(this),g=this.skipEG.bind(this),m=this.skipUEG.bind(this),T=this.skipScalingList.bind(this);h();var v=h();if(u(5),f(3),h(),m(),v===100||v===110||v===122||v===244||v===44||v===83||v===86||v===118||v===128){var p=d();if(p===3&&f(1),m(),m(),f(1),c())for(t=p!==3?8:12,r=0;r<t;r++)c()&&T(r<6?16:64)}m();var S=d();if(S===0)d();else if(S===1)for(f(1),g(),g(),e=d(),r=0;r<e;r++)g();m(),f(1);var E=d(),L=d(),A=u(1);A===0&&f(1),f(1),c()&&(i=d(),a=d(),o=d(),l=d());var b=[1,1];if(c()&&c())switch(h()){case 1:b=[1,1];break;case 2:b=[12,11];break;case 3:b=[10,11];break;case 4:b=[16,11];break;case 5:b=[40,33];break;case 6:b=[24,11];break;case 7:b=[20,11];break;case 8:b=[32,11];break;case 9:b=[80,33];break;case 10:b=[18,11];break;case 11:b=[15,11];break;case 12:b=[64,33];break;case 13:b=[160,99];break;case 14:b=[4,3];break;case 15:b=[3,2];break;case 16:b=[2,1];break;case 255:b=[h()<<8|h(),h()<<8|h()]}return{width:Math.ceil(16*(E+1)-2*i-2*a),height:(2-A)*(L+1)*16-(A?2:4)*(o+l),pixelRatio:b}},n.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},s}(),us=function(){function s(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new wr(t,{removePKCS7Padding:!1})}var n=s.prototype;return n.decryptBuffer=function(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)},n.decryptAacSample=function(e,t,r){var i=this,a=e[t].unit;if(!(a.length<=16)){var o=a.subarray(16,a.length-a.length%16),l=o.buffer.slice(o.byteOffset,o.byteOffset+o.length);this.decryptBuffer(l).then(function(h){var u=new Uint8Array(h);a.set(u,16),i.decrypter.isSync()||i.decryptAacSamples(e,t+1,r)})}},n.decryptAacSamples=function(e,t,r){for(;;t++){if(t>=e.length)return void r();if(!(e[t].unit.length<32||(this.decryptAacSample(e,t,r),this.decrypter.isSync())))return}},n.getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,r=new Int8Array(t),i=0,a=32;a<e.length-16;a+=160,i+=16)r.set(e.subarray(a,a+16),i);return r},n.getAvcDecryptedUnit=function(e,t){for(var r=new Uint8Array(t),i=0,a=32;a<e.length-16;a+=160,i+=16)e.set(r.subarray(i,i+16),a);return e},n.decryptAvcSample=function(e,t,r,i,a){var o=this,l=_i(a.data),h=this.getAvcEncryptedData(l);this.decryptBuffer(h.buffer).then(function(u){a.data=o.getAvcDecryptedUnit(l,u),o.decrypter.isSync()||o.decryptAvcSamples(e,t,r+1,i)})},n.decryptAvcSamples=function(e,t,r,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length)return void i();for(var a=e[t].units;!(r>=a.length);r++){var o=a[r];if(!(o.data.length<=48||o.type!==1&&o.type!==5||(this.decryptAvcSample(e,t,r,i,o),this.decrypter.isSync())))return}}},s}(),ue=188,hs=function(){function s(e,t,r){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=e,this.config=t,this.typeSupported=r}s.probe=function(e){var t=s.syncOffset(e);return t>0&&R.warn("MPEG2-TS detected but first sync word found @ offset "+t),t!==-1},s.syncOffset=function(e){for(var t=e.length,r=Math.min(940,e.length-ue)+1,i=0;i<r;){for(var a=!1,o=i;o<t&&e[o]===71;o+=ue)if(a||Or(e,o)!==0||(a=!0),a&&o+ue>r)return i;i++}return-1},s.createTrack=function(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:Ai[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}};var n=s.prototype;return n.resetInitSegment=function(e,t,r,i){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=s.createTrack("video"),this._audioTrack=s.createTrack("audio",i),this._id3Track=s.createTrack("id3"),this._txtTrack=s.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r,this._duration=i},n.resetTimeStamp=function(){},n.resetContiguity=function(){var e=this._audioTrack,t=this._avcTrack,r=this._id3Track;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},n.demux=function(e,t,r,i){var a;r===void 0&&(r=!1),i===void 0&&(i=!1),r||(this.sampleAes=null);var o=this._avcTrack,l=this._audioTrack,h=this._id3Track,u=this._txtTrack,d=o.pid,c=o.pesData,f=l.pid,g=h.pid,m=l.pesData,T=h.pesData,v=null,p=this.pmtParsed,S=this._pmtId,E=e.length;if(this.remainderData&&(E=(e=Ge(this.remainderData,e)).length,this.remainderData=null),E<ue&&!i)return this.remainderData=e,{audioTrack:l,videoTrack:o,id3Track:h,textTrack:u};var L=Math.max(0,s.syncOffset(e));(E-=(E-L)%ue)<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,E,e.buffer.byteLength-E));for(var A=0,b=L;b<E;b+=ue)if(e[b]===71){var w=!!(64&e[b+1]),D=Or(e,b),I=void 0;if((48&e[b+3])>>4>1){if((I=b+5+e[b+4])===b+ue)continue}else I=b+4;switch(D){case d:w&&(c&&(a=tt(c))&&this.parseAVCPES(o,u,a,!1),c={data:[],size:0}),c&&(c.data.push(e.subarray(I,b+ue)),c.size+=b+ue-I);break;case f:if(w){if(m&&(a=tt(m)))switch(l.segmentCodec){case"aac":this.parseAACPES(l,a);break;case"mp3":this.parseMPEGPES(l,a)}m={data:[],size:0}}m&&(m.data.push(e.subarray(I,b+ue)),m.size+=b+ue-I);break;case g:w&&(T&&(a=tt(T))&&this.parseID3PES(h,a),T={data:[],size:0}),T&&(T.data.push(e.subarray(I,b+ue)),T.size+=b+ue-I);break;case 0:w&&(I+=e[I]+1),S=this._pmtId=ds(e,I);break;case S:w&&(I+=e[I]+1);var _=cs(e,I,this.typeSupported,r);(d=_.avc)>0&&(o.pid=d),(f=_.audio)>0&&(l.pid=f,l.segmentCodec=_.segmentCodec),(g=_.id3)>0&&(h.pid=g),v===null||p||(R.warn("MPEG-TS PMT found at "+b+" after unknown PID '"+v+"'. Backtracking to sync byte @"+L+" to parse all TS packets."),v=null,b=L-188),p=this.pmtParsed=!0;break;case 17:case 8191:break;default:v=D}}else A++;if(A>0){var C=new Error("Found "+A+" TS packet/s that do not start with 0x47");this.observer.emit(y.ERROR,y.ERROR,{type:N.MEDIA_ERROR,details:k.FRAG_PARSING_ERROR,fatal:!1,error:C,reason:C.message})}o.pesData=c,l.pesData=m,h.pesData=T;var x={audioTrack:l,videoTrack:o,id3Track:h,textTrack:u};return i&&this.extractRemainingSamples(x),x},n.flush=function(){var e,t=this.remainderData;return this.remainderData=null,e=t?this.demux(t,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e},n.extractRemainingSamples=function(e){var t,r=e.audioTrack,i=e.videoTrack,a=e.id3Track,o=e.textTrack,l=i.pesData,h=r.pesData,u=a.pesData;if(l&&(t=tt(l))?(this.parseAVCPES(i,o,t,!0),i.pesData=null):i.pesData=l,h&&(t=tt(h))){switch(r.segmentCodec){case"aac":this.parseAACPES(r,t);break;case"mp3":this.parseMPEGPES(r,t)}r.pesData=null}else h!=null&&h.size&&R.log("last AAC PES packet truncated,might overlap between fragments"),r.pesData=h;u&&(t=tt(u))?(this.parseID3PES(a,t),a.pesData=null):a.pesData=u},n.demuxSampleAes=function(e,t,r){var i=this.demux(e,r,!0,!this.config.progressive),a=this.sampleAes=new us(this.observer,this.config,t);return this.decrypt(i,a)},n.decrypt=function(e,t){return new Promise(function(r){var i=e.audioTrack,a=e.videoTrack;i.samples&&i.segmentCodec==="aac"?t.decryptAacSamples(i.samples,0,function(){a.samples?t.decryptAvcSamples(a.samples,0,0,function(){r(e)}):r(e)}):a.samples&&t.decryptAvcSamples(a.samples,0,0,function(){r(e)})})},n.destroy=function(){this._duration=0},n.parseAVCPES=function(e,t,r,i){var a,o=this,l=this.parseAVCNALu(e,r.data),h=this.avcSample,u=!1;r.data=null,h&&l.length&&!e.audFound&&(Mr(h,e),h=this.avcSample=Kt(!1,r.pts,r.dts,"")),l.forEach(function(d){switch(d.type){case 1:a=!0,h||(h=o.avcSample=Kt(!0,r.pts,r.dts,"")),h.frame=!0;var c=d.data;if(u&&c.length>4){var f=new Sn(c).readSliceType();f!==2&&f!==4&&f!==7&&f!==9||(h.key=!0)}break;case 5:a=!0,h||(h=o.avcSample=Kt(!0,r.pts,r.dts,"")),h.key=!0,h.frame=!0;break;case 6:a=!0,Ci(d.data,1,r.pts,t.samples);break;case 7:if(a=!0,u=!0,!e.sps){var g=d.data,m=new Sn(g).readSPS();e.width=m.width,e.height=m.height,e.pixelRatio=m.pixelRatio,e.sps=[g],e.duration=o._duration;for(var T=g.subarray(1,4),v="avc1.",p=0;p<3;p++){var S=T[p].toString(16);S.length<2&&(S="0"+S),v+=S}e.codec=v}break;case 8:a=!0,e.pps||(e.pps=[d.data]);break;case 9:a=!1,e.audFound=!0,h&&Mr(h,e),h=o.avcSample=Kt(!1,r.pts,r.dts,"");break;case 12:a=!0;break;default:a=!1,h&&(h.debug+="unknown NAL "+d.type+" ")}h&&a&&h.units.push(d)}),i&&h&&(Mr(h,e),this.avcSample=null)},n.getLastNalUnit=function(e){var t,r,i=this.avcSample;if(i&&i.units.length!==0||(i=e[e.length-1]),(t=i)!=null&&t.units){var a=i.units;r=a[a.length-1]}return r},n.parseAVCNALu=function(e,t){var r,i,a=t.byteLength,o=e.naluState||0,l=o,h=[],u=0,d=-1,c=0;for(o===-1&&(d=0,c=31&t[0],o=0,u=1);u<a;)if(r=t[u++],o)if(o!==1)if(r)if(r===1){if(d>=0){var f={data:t.subarray(d,u-o-1),type:c};h.push(f)}else{var g=this.getLastNalUnit(e.samples);if(g&&(l&&u<=4-l&&g.state&&(g.data=g.data.subarray(0,g.data.byteLength-l)),(i=u-o-1)>0)){var m=new Uint8Array(g.data.byteLength+i);m.set(g.data,0),m.set(t.subarray(0,i),g.data.byteLength),g.data=m,g.state=0}}u<a?(d=u,c=31&t[u],o=0):o=-1}else o=0;else o=3;else o=r?0:2;else o=r?0:1;if(d>=0&&o>=0){var T={data:t.subarray(d,a),type:c,state:o};h.push(T)}if(h.length===0){var v=this.getLastNalUnit(e.samples);if(v){var p=new Uint8Array(v.data.byteLength+t.byteLength);p.set(v.data,0),p.set(t,v.data.byteLength),v.data=p}}return e.naluState=o,h},n.parseAACPES=function(e,t){var r,i,a,o=0,l=this.aacOverFlow,h=t.data;if(l){this.aacOverFlow=null;var u=l.missing,d=l.sample.unit.byteLength;if(u===-1){var c=new Uint8Array(d+h.byteLength);c.set(l.sample.unit,0),c.set(h,d),h=c}else{var f=d-u;l.sample.unit.set(h.subarray(0,u),f),e.samples.push(l.sample),o=l.missing}}for(r=o,i=h.length;r<i-1&&!Bt(h,r);r++);if(r!==o){var g,m=r<i-1;g=m?"AAC PES did not start with ADTS header,offset:"+r:"No ADTS header found in AAC PES";var T=new Error(g);if(R.warn("parsing error: "+g),this.observer.emit(y.ERROR,y.ERROR,{type:N.MEDIA_ERROR,details:k.FRAG_PARSING_ERROR,fatal:!1,levelRetry:m,error:T,reason:g}),!m)return}if(vn(e,this.observer,h,r,this.audioCodec),t.pts!==void 0)a=t.pts;else{if(!l)return void R.warn("[tsdemuxer]: AAC PES unknown PTS");var v=mn(e.samplerate);a=l.sample.pts+v}for(var p,S=0;r<i;){if(r+=(p=pn(e,h,r,a,S)).length,p.missing){this.aacOverFlow=p;break}for(S++;r<i-1&&!Bt(h,r);r++);}},n.parseMPEGPES=function(e,t){var r=t.data,i=r.length,a=0,o=0,l=t.pts;if(l!==void 0)for(;o<i;)if(En(r,o)){var h=yn(e,r,o,l,a);if(!h)break;o+=h.length,a++}else o++;else R.warn("[tsdemuxer]: MPEG PES unknown PTS")},n.parseID3PES=function(e,t){if(t.pts!==void 0){var r=$({},t,{type:this._avcTrack?ct:dt,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}else R.warn("[tsdemuxer]: ID3 PES unknown PTS")},s}();function Kt(s,n,e,t){return{key:s,frame:!1,pts:n,dts:e,units:[],debug:t,length:0}}function Or(s,n){return((31&s[n+1])<<8)+s[n+2]}function ds(s,n){return(31&s[n+10])<<8|s[n+11]}function cs(s,n,e,t){var r={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},i=n+3+((15&s[n+1])<<8|s[n+2])-4;for(n+=12+((15&s[n+10])<<8|s[n+11]);n<i;){var a=Or(s,n);switch(s[n]){case 207:if(!t){R.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:r.audio===-1&&(r.audio=a);break;case 21:r.id3===-1&&(r.id3=a);break;case 219:if(!t){R.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:r.avc===-1&&(r.avc=a);break;case 3:case 4:e.mpeg!==!0&&e.mp3!==!0?R.log("MPEG audio found, not supported in this browser"):r.audio===-1&&(r.audio=a,r.segmentCodec="mp3");break;case 36:R.warn("Unsupported HEVC stream type found")}n+=5+((15&s[n+3])<<8|s[n+4])}return r}function tt(s){var n,e,t,r,i,a=0,o=s.data;if(!s||s.size===0)return null;for(;o[0].length<19&&o.length>1;){var l=new Uint8Array(o[0].length+o[1].length);l.set(o[0]),l.set(o[1],o[0].length),o[0]=l,o.splice(1,1)}if(((n=o[0])[0]<<16)+(n[1]<<8)+n[2]===1){if((e=(n[4]<<8)+n[5])&&e>s.size-6)return null;var h=n[7];192&h&&(r=536870912*(14&n[9])+4194304*(255&n[10])+16384*(254&n[11])+128*(255&n[12])+(254&n[13])/2,64&h?r-(i=536870912*(14&n[14])+4194304*(255&n[15])+16384*(254&n[16])+128*(255&n[17])+(254&n[18])/2)>54e5&&(R.warn(Math.round((r-i)/9e4)+"s delta between PTS and DTS, align them"),r=i):i=r);var u=(t=n[8])+9;if(s.size<=u)return null;s.size-=u;for(var d=new Uint8Array(s.size),c=0,f=o.length;c<f;c++){var g=(n=o[c]).byteLength;if(u){if(u>g){u-=g;continue}n=n.subarray(u),g-=u,u=0}d.set(n,a),a+=g}return e&&(e-=t+3),{data:d,pts:r,dts:i,len:e}}return null}function Mr(s,n){if(s.units.length&&s.frame){if(s.pts===void 0){var e=n.samples,t=e.length;if(!t)return void n.dropped++;var r=e[t-1];s.pts=r.pts,s.dts=r.dts}n.samples.push(s)}s.debug.length&&R.log(s.pts+"/"+s.dts+":"+s.debug)}var fs=function(s){function n(){return s.apply(this,arguments)||this}ae(n,s);var e=n.prototype;return e.resetInitSegment=function(t,r,i,a){s.prototype.resetInitSegment.call(this,t,r,i,a),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:r,duration:a,inputTimeScale:9e4,dropped:0}},n.probe=function(t){if(!t)return!1;for(var r=(kt(t,0)||[]).length,i=t.length;r<i;r++)if(ls(t,r))return R.log("MPEG Audio sync word found !"),!0;return!1},e.canParse=function(t,r){return function(i,a){return Fr(i,a)&&4<=i.length-a}(t,r)},e.appendFrame=function(t,r,i){if(this.basePTS!==null)return yn(t,r,i,this.basePTS,this.frameIndex)},n}(cn),Ln=function(){function s(){}return s.getSilentFrame=function(n,e){if(n==="mp4a.40.2"){if(e===1)return new Uint8Array([0,200,0,128,35,128]);if(e===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(e===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(e===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(e===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(e===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(e===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(e===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(e===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},s}(),Oe=Math.pow(2,32)-1,re=function(){function s(){}return s.init=function(){var n;for(n in s.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},s.types)s.types.hasOwnProperty(n)&&(s.types[n]=[n.charCodeAt(0),n.charCodeAt(1),n.charCodeAt(2),n.charCodeAt(3)]);var e=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),t=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);s.HDLR_TYPES={video:e,audio:t};var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);s.STTS=s.STSC=s.STCO=i,s.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),s.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),s.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),s.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);s.FTYP=s.box(s.types.ftyp,a,l,a,o),s.DINF=s.box(s.types.dinf,s.box(s.types.dref,r))},s.box=function(n){for(var e=8,t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];for(var a=r.length,o=a;a--;)e+=r[a].byteLength;var l=new Uint8Array(e);for(l[0]=e>>24&255,l[1]=e>>16&255,l[2]=e>>8&255,l[3]=255&e,l.set(n,4),a=0,e=8;a<o;a++)l.set(r[a],e),e+=r[a].byteLength;return l},s.hdlr=function(n){return s.box(s.types.hdlr,s.HDLR_TYPES[n])},s.mdat=function(n){return s.box(s.types.mdat,n)},s.mdhd=function(n,e){e*=n;var t=Math.floor(e/(Oe+1)),r=Math.floor(e%(Oe+1));return s.box(s.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,255&n,t>>24,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))},s.mdia=function(n){return s.box(s.types.mdia,s.mdhd(n.timescale,n.duration),s.hdlr(n.type),s.minf(n))},s.mfhd=function(n){return s.box(s.types.mfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n]))},s.minf=function(n){return n.type==="audio"?s.box(s.types.minf,s.box(s.types.smhd,s.SMHD),s.DINF,s.stbl(n)):s.box(s.types.minf,s.box(s.types.vmhd,s.VMHD),s.DINF,s.stbl(n))},s.moof=function(n,e,t){return s.box(s.types.moof,s.mfhd(n),s.traf(t,e))},s.moov=function(n){for(var e=n.length,t=[];e--;)t[e]=s.trak(n[e]);return s.box.apply(null,[s.types.moov,s.mvhd(n[0].timescale,n[0].duration)].concat(t).concat(s.mvex(n)))},s.mvex=function(n){for(var e=n.length,t=[];e--;)t[e]=s.trex(n[e]);return s.box.apply(null,[s.types.mvex].concat(t))},s.mvhd=function(n,e){e*=n;var t=Math.floor(e/(Oe+1)),r=Math.floor(e%(Oe+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,255&n,t>>24,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return s.box(s.types.mvhd,i)},s.sdtp=function(n){var e,t,r=n.samples||[],i=new Uint8Array(4+r.length);for(e=0;e<r.length;e++)t=r[e].flags,i[e+4]=t.dependsOn<<4|t.isDependedOn<<2|t.hasRedundancy;return s.box(s.types.sdtp,i)},s.stbl=function(n){return s.box(s.types.stbl,s.stsd(n),s.box(s.types.stts,s.STTS),s.box(s.types.stsc,s.STSC),s.box(s.types.stsz,s.STSZ),s.box(s.types.stco,s.STCO))},s.avc1=function(n){var e,t,r,i=[],a=[];for(e=0;e<n.sps.length;e++)r=(t=n.sps[e]).byteLength,i.push(r>>>8&255),i.push(255&r),i=i.concat(Array.prototype.slice.call(t));for(e=0;e<n.pps.length;e++)r=(t=n.pps[e]).byteLength,a.push(r>>>8&255),a.push(255&r),a=a.concat(Array.prototype.slice.call(t));var o=s.box(s.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|n.sps.length].concat(i).concat([n.pps.length]).concat(a))),l=n.width,h=n.height,u=n.pixelRatio[0],d=n.pixelRatio[1];return s.box(s.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,h>>8&255,255&h,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,s.box(s.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),s.box(s.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,d>>24,d>>16&255,d>>8&255,255&d])))},s.esds=function(n){var e=n.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(n.config).concat([6,1,2]))},s.mp4a=function(n){var e=n.samplerate;return s.box(s.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,n.channelCount,0,16,0,0,0,0,e>>8&255,255&e,0,0]),s.box(s.types.esds,s.esds(n)))},s.mp3=function(n){var e=n.samplerate;return s.box(s.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,n.channelCount,0,16,0,0,0,0,e>>8&255,255&e,0,0]))},s.stsd=function(n){return n.type==="audio"?n.segmentCodec==="mp3"&&n.codec==="mp3"?s.box(s.types.stsd,s.STSD,s.mp3(n)):s.box(s.types.stsd,s.STSD,s.mp4a(n)):s.box(s.types.stsd,s.STSD,s.avc1(n))},s.tkhd=function(n){var e=n.id,t=n.duration*n.timescale,r=n.width,i=n.height,a=Math.floor(t/(Oe+1)),o=Math.floor(t%(Oe+1));return s.box(s.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,o>>24,o>>16&255,o>>8&255,255&o,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,i>>8&255,255&i,0,0]))},s.traf=function(n,e){var t=s.sdtp(n),r=n.id,i=Math.floor(e/(Oe+1)),a=Math.floor(e%(Oe+1));return s.box(s.types.traf,s.box(s.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),s.box(s.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a])),s.trun(n,t.length+16+20+8+16+8+8),t)},s.trak=function(n){return n.duration=n.duration||4294967295,s.box(s.types.trak,s.tkhd(n),s.mdia(n))},s.trex=function(n){var e=n.id;return s.box(s.types.trex,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},s.trun=function(n,e){var t,r,i,a,o,l,h=n.samples||[],u=h.length,d=12+16*u,c=new Uint8Array(d);for(e+=8+d,c.set([n.type==="video"?1:0,0,15,1,u>>>24&255,u>>>16&255,u>>>8&255,255&u,e>>>24&255,e>>>16&255,e>>>8&255,255&e],0),t=0;t<u;t++)i=(r=h[t]).duration,a=r.size,o=r.flags,l=r.cts,c.set([i>>>24&255,i>>>16&255,i>>>8&255,255&i,a>>>24&255,a>>>16&255,a>>>8&255,255&a,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*t);return s.box(s.types.trun,c)},s.initSegment=function(n){s.types||s.init();var e=s.moov(n),t=new Uint8Array(s.FTYP.byteLength+e.byteLength);return t.set(s.FTYP),t.set(e,s.FTYP.byteLength),t},s}();function Nr(s,n,e,t){e===void 0&&(e=1),t===void 0&&(t=!1);var r=s*n*e;return t?Math.round(r):r}function Tt(s,n){return n===void 0&&(n=!1),Nr(s,1e3,1/9e4,n)}re.types=void 0,re.HDLR_TYPES=void 0,re.STTS=void 0,re.STSC=void 0,re.STCO=void 0,re.STSZ=void 0,re.VMHD=void 0,re.SMHD=void 0,re.STSD=void 0,re.FTYP=void 0,re.DINF=void 0;var Ht=null,Ur=null,Br=function(){function s(e,t,r,i){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,Ht===null){var a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Ht=a?parseInt(a[1]):0}if(Ur===null){var o=navigator.userAgent.match(/Safari\/(\d+)/i);Ur=o?parseInt(o[1]):0}}var n=s.prototype;return n.destroy=function(){},n.resetTimeStamp=function(e){R.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e},n.resetNextTimestamp=function(){R.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},n.resetInitSegment=function(){R.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},n.getVideoStartPts=function(e){var t=!1,r=e.reduce(function(i,a){var o=a.pts-i;return o<-4294967296?(t=!0,ce(i,a.pts)):o>0?i:a.pts},e[0].pts);return t&&R.debug("PTS rollover detected"),r},n.remux=function(e,t,r,i,a,o,l,h){var u,d,c,f,g,m,T=a,v=a,p=e.pid>-1,S=t.pid>-1,E=t.samples.length,L=e.samples.length>0,A=l&&E>0||E>1;if((!p||L)&&(!S||A)||this.ISGenerated||l){this.ISGenerated||(c=this.generateIS(e,t,a,o));var b,w=this.isVideoContiguous,D=-1;if(A&&(D=function(B){for(var P=0;P<B.length;P++)if(B[P].key)return P;return-1}(t.samples),!w&&this.config.forceKeyFrameOnDiscontinuity))if(m=!0,D>0){R.warn("[mp4-remuxer]: Dropped "+D+" out of "+E+" video samples due to a missing keyframe");var I=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(D),t.dropped+=D,b=v+=(t.samples[0].pts-I)/t.inputTimeScale}else D===-1&&(R.warn("[mp4-remuxer]: No keyframe found out of "+E+" video samples"),m=!1);if(this.ISGenerated){if(L&&A){var _=this.getVideoStartPts(t.samples),C=(ce(e.samples[0].pts,_)-_)/t.inputTimeScale;T+=Math.max(0,C),v+=Math.max(0,-C)}if(L){if(e.samplerate||(R.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),c=this.generateIS(e,t,a,o)),d=this.remuxAudio(e,T,this.isAudioContiguous,o,S||A||h===Le?v:void 0),A){var x=d?d.endPTS-d.startPTS:0;t.inputTimeScale||(R.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),c=this.generateIS(e,t,a,o)),u=this.remuxVideo(t,v,w,x)}}else A&&(u=this.remuxVideo(t,v,w,0));u&&(u.firstKeyFrame=D,u.independent=D!==-1,u.firstKeyFramePTS=b)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(g=Rn(r,a,this._initPTS,this._initDTS)),i.samples.length&&(f=An(i,a,this._initPTS))),{audio:d,video:u,initSegment:c,independent:m,text:f,id3:g}},n.generateIS=function(e,t,r,i){var a,o,l,h=e.samples,u=t.samples,d=this.typeSupported,c={},f=this._initPTS,g=!f||i,m="audio/mp4";if(g&&(a=o=1/0),e.config&&h.length&&(e.timescale=e.samplerate,e.segmentCodec==="mp3"&&(d.mpeg?(m="audio/mpeg",e.codec=""):d.mp3&&(e.codec="mp3")),c.audio={id:"audio",container:m,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&d.mpeg?new Uint8Array(0):re.initSegment([e]),metadata:{channelCount:e.channelCount}},g&&(l=e.inputTimeScale,f&&l===f.timescale?g=!1:a=o=h[0].pts-Math.round(l*r))),t.sps&&t.pps&&u.length&&(t.timescale=t.inputTimeScale,c.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:re.initSegment([t]),metadata:{width:t.width,height:t.height}},g))if(l=t.inputTimeScale,f&&l===f.timescale)g=!1;else{var T=this.getVideoStartPts(u),v=Math.round(l*r);o=Math.min(o,ce(u[0].dts,T)-v),a=Math.min(a,T-v)}if(Object.keys(c).length)return this.ISGenerated=!0,g?(this._initPTS={baseTime:a,timescale:l},this._initDTS={baseTime:o,timescale:l}):a=l=void 0,{tracks:c,initPTS:a,timescale:l}},n.remuxVideo=function(e,t,r,i){var a,o,l=e.inputTimeScale,h=e.samples,u=[],d=h.length,c=this._initPTS,f=this.nextAvcDts,g=8,m=this.videoSampleDuration,T=Number.POSITIVE_INFINITY,v=Number.NEGATIVE_INFINITY,p=!1;r&&f!==null||(f=t*l-(h[0].pts-ce(h[0].dts,h[0].pts)));for(var S=c.baseTime*l/c.timescale,E=0;E<d;E++){var L=h[E];L.pts=ce(L.pts-S,f),L.dts=ce(L.dts-S,f),L.dts<h[E>0?E-1:E].dts&&(p=!0)}p&&h.sort(function(Xt,aa){var co=Xt.dts-aa.dts,fo=Xt.pts-aa.pts;return co||fo}),a=h[0].dts;var A=(o=h[h.length-1].dts)-a,b=A?Math.round(A/(d-1)):m||e.inputTimeScale/30;if(r){var w=a-f,D=w>b,I=w<-1;if((D||I)&&(D?R.warn("AVC: "+Tt(w,!0)+" ms ("+w+"dts) hole between fragments detected, filling it"):R.warn("AVC: "+Tt(-w,!0)+" ms ("+w+"dts) overlapping between fragments detected"),!I||f>h[0].pts)){a=f;var _=h[0].pts-w;h[0].dts=a,h[0].pts=_,R.log("Video: First PTS/DTS adjusted: "+Tt(_,!0)+"/"+Tt(a,!0)+", delta: "+Tt(w,!0)+" ms")}}a=Math.max(0,a);for(var C=0,x=0,B=0;B<d;B++){for(var P=h[B],O=P.units,U=O.length,M=0,K=0;K<U;K++)M+=O[K].data.length;x+=M,C+=U,P.length=M,P.dts=Math.max(P.dts,a),T=Math.min(P.pts,T),v=Math.max(P.pts,v)}o=h[d-1].dts;var H,Y=x+4*C+8;try{H=new Uint8Array(Y)}catch(Xt){return void this.observer.emit(y.ERROR,y.ERROR,{type:N.MUX_ERROR,details:k.REMUX_ALLOC_ERROR,fatal:!1,error:Xt,bytes:Y,reason:"fail allocating video mdat "+Y})}var q=new DataView(H.buffer);q.setUint32(0,Y),H.set(re.types.mdat,4);for(var le=!1,J=Number.POSITIVE_INFINITY,pe=Number.POSITIVE_INFINITY,ge=Number.NEGATIVE_INFINITY,ve=Number.NEGATIVE_INFINITY,Z=0;Z<d;Z++){for(var ie=h[Z],Ae=ie.units,Me=0,he=0,Et=Ae.length;he<Et;he++){var St=Ae[he],zt=St.data,nt=St.data.byteLength;q.setUint32(g,nt),g+=4,H.set(zt,g),g+=nt,Me+=4+nt}var je=void 0;if(Z<d-1)m=h[Z+1].dts-ie.dts,je=h[Z+1].pts-ie.pts;else{var Lt=this.config,Ce=Z>0?ie.dts-h[Z-1].dts:b;if(je=Z>0?ie.pts-h[Z-1].pts:b,Lt.stretchShortVideoTrack&&this.nextAudioPts!==null){var so=Math.floor(Lt.maxBufferHole*l),si=(i?T+i*l:this.nextAudioPts)-ie.pts;si>so?((m=si-Ce)<0?m=Ce:le=!0,R.log("[mp4-remuxer]: It is approximately "+si/90+" ms to the next segment; using duration "+m/90+" ms for the last video frame.")):m=Ce}else m=Ce}var oo=Math.round(ie.pts-ie.dts);J=Math.min(J,m),ge=Math.max(ge,m),pe=Math.min(pe,je),ve=Math.max(ve,je),u.push(new bn(ie.key,m,Me,oo))}if(u.length){if(Ht){if(Ht<70){var ra=u[0].flags;ra.dependsOn=2,ra.isNonSync=0}}else if(Ur&&ve-pe<ge-J&&b/ge<.025&&u[0].cts===0){R.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var oi=a,ye=0,ia=u.length;ye<ia;ye++){var na=oi+u[ye].duration,lo=oi+u[ye].cts;if(ye<ia-1){var uo=na+u[ye+1].cts;u[ye].duration=uo-lo}else u[ye].duration=ye?u[ye-1].duration:b;u[ye].cts=0,oi=na}}}m=le||!m?b:m,this.nextAvcDts=f=o+m,this.videoSampleDuration=m,this.isVideoContiguous=!0;var ho={data1:re.moof(e.sequenceNumber++,a,$({},e,{samples:u})),data2:H,startPTS:T/l,endPTS:(v+m)/l,startDTS:a/l,endDTS:f/l,type:"video",hasAudio:!1,hasVideo:!0,nb:u.length,dropped:e.dropped};return e.samples=[],e.dropped=0,ho},n.remuxAudio=function(e,t,r,i,a){var o=e.inputTimeScale,l=o/(e.samplerate?e.samplerate:o),h=e.segmentCodec==="aac"?1024:1152,u=h*l,d=this._initPTS,c=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,f=[],g=a!==void 0,m=e.samples,T=c?0:8,v=this.nextAudioPts||-1,p=t*o,S=d.baseTime*o/d.timescale;if(this.isAudioContiguous=r=r||m.length&&v>0&&(i&&Math.abs(p-v)<9e3||Math.abs(ce(m[0].pts-S,p)-v)<20*u),m.forEach(function(he){he.pts=ce(he.pts-S,p)}),!r||v<0){if(m=m.filter(function(he){return he.pts>=0}),!m.length)return;v=a===0?0:i&&!g?Math.max(0,p):m[0].pts}if(e.segmentCodec==="aac")for(var E=this.config.maxAudioFramesDrift,L=0,A=v;L<m.length;L++){var b=m[L],w=b.pts,D=w-A,I=Math.abs(1e3*D/o);if(D<=-E*u&&g)L===0&&(R.warn("Audio frame @ "+(w/o).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*D/o)+" ms."),this.nextAudioPts=v=A=w);else if(D>=E*u&&I<1e4&&g){var _=Math.round(D/u);(A=w-_*u)<0&&(_--,A+=u),L===0&&(this.nextAudioPts=v=A),R.warn("[mp4-remuxer]: Injecting "+_+" audio frame @ "+(A/o).toFixed(3)+"s due to "+Math.round(1e3*D/o)+" ms gap.");for(var C=0;C<_;C++){var x=Math.max(A,0),B=Ln.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);B||(R.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),B=b.unit.subarray()),m.splice(L,0,{unit:B,pts:x}),A+=u,L++}}b.pts=A,A+=u}for(var P,O=null,U=null,M=0,K=m.length;K--;)M+=m[K].unit.byteLength;for(var H=0,Y=m.length;H<Y;H++){var q=m[H],le=q.unit,J=q.pts;if(U!==null)f[H-1].duration=Math.round((J-U)/l);else{if(r&&e.segmentCodec==="aac"&&(J=v),O=J,!(M>0))return;M+=T;try{P=new Uint8Array(M)}catch(he){return void this.observer.emit(y.ERROR,y.ERROR,{type:N.MUX_ERROR,details:k.REMUX_ALLOC_ERROR,fatal:!1,error:he,bytes:M,reason:"fail allocating audio mdat "+M})}c||(new DataView(P.buffer).setUint32(0,M),P.set(re.types.mdat,4))}P.set(le,T);var pe=le.byteLength;T+=pe,f.push(new bn(!0,h,pe,0)),U=J}var ge=f.length;if(ge){var ve=f[f.length-1];this.nextAudioPts=v=U+l*ve.duration;var Z=c?new Uint8Array(0):re.moof(e.sequenceNumber++,O/l,$({},e,{samples:f}));e.samples=[];var ie=O/o,Ae=v/o,Me={data1:Z,data2:P,startPTS:ie,endPTS:Ae,startDTS:ie,endDTS:Ae,type:"audio",hasAudio:!0,hasVideo:!1,nb:ge};return this.isAudioContiguous=!0,Me}},n.remuxEmptyAudio=function(e,t,r,i){var a=e.inputTimeScale,o=a/(e.samplerate?e.samplerate:a),l=this.nextAudioPts,h=this._initDTS,u=9e4*h.baseTime/h.timescale,d=(l!==null?l:i.startDTS*a)+u,c=i.endDTS*a+u,f=1024*o,g=Math.ceil((c-d)/f),m=Ln.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(R.warn("[mp4-remuxer]: remux empty Audio"),m){for(var T=[],v=0;v<g;v++){var p=d+v*f;T.push({unit:m,pts:p,dts:p})}return e.samples=T,this.remuxAudio(e,t,r,!1)}R.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},s}();function ce(s,n){var e;if(n===null)return s;for(e=n<s?-8589934592:8589934592;Math.abs(s-n)>4294967296;)s+=e;return s}function Rn(s,n,e,t){var r=s.samples.length;if(r){for(var i=s.inputTimeScale,a=0;a<r;a++){var o=s.samples[a];o.pts=ce(o.pts-9e4*e.baseTime/e.timescale,n*i)/i,o.dts=ce(o.dts-9e4*t.baseTime/t.timescale,n*i)/i}var l=s.samples;return s.samples=[],{samples:l}}}function An(s,n,e){var t=s.samples.length;if(t){for(var r=s.inputTimeScale,i=0;i<t;i++){var a=s.samples[i];a.pts=ce(a.pts-9e4*e.baseTime/e.timescale,n*r)/r}s.samples.sort(function(l,h){return l.pts-h.pts});var o=s.samples;return s.samples=[],{samples:o}}}var Ie,bn=function(s,n,e,t){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=n,this.size=e,this.cts=t,this.flags=new gs(s)},gs=function(s){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=s?2:1,this.isNonSync=s?0:1},vs=function(){function s(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}var n=s.prototype;return n.destroy=function(){},n.resetTimeStamp=function(e){this.initPTS=e,this.lastEndTime=null},n.resetNextTimestamp=function(){this.lastEndTime=null},n.resetInitSegment=function(e,t,r,i){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(function(a,o){if(!a||!o)return a;var l=o.keyId;return l&&o.isCommonEncryption&&W(a,["moov","trak"]).forEach(function(h){var u=W(h,["mdia","minf","stbl","stsd"])[0].subarray(8),d=W(u,["enca"]),c=d.length>0;c||(d=W(u,["encv"])),d.forEach(function(f){W(c?f.subarray(28):f.subarray(78),["sinf"]).forEach(function(g){var m=Ii(g);if(m){var T=m.subarray(8,24);T.some(function(v){return v!==0})||(R.log("[eme] Patching keyId in 'enc"+(c?"a":"v")+">sinf>>tenc' box: "+Ee(T)+" -> "+Ee(l)),m.set(l,8))}})})}),a}(e,i)),this.emitInitSegment=!0},n.generateInitSegment=function(e){var t=this.audioCodec,r=this.videoCodec;if(e==null||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var i=this.initData=Di(e);t||(t=kn(i.audio,se)),r||(r=kn(i.video,me));var a={};i.audio&&i.video?a.audiovideo={container:"video/mp4",codec:t+","+r,initSegment:e,id:"main"}:i.audio?a.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:i.video?a.video={container:"video/mp4",codec:r,initSegment:e,id:"main"}:R.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=a},n.remux=function(e,t,r,i,a,o){var l,h,u=this.initPTS,d=this.lastEndTime,c={audio:void 0,video:void 0,text:i,id3:r,initSegment:void 0};F(d)||(d=this.lastEndTime=a||0);var f=t.samples;if(f==null||!f.length)return c;var g={initPTS:void 0,timescale:1},m=this.initData;if((l=m)!=null&&l.length||(this.generateInitSegment(f),m=this.initData),(h=m)==null||!h.length)return R.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),c;this.emitInitSegment&&(g.tracks=this.initTracks,this.emitInitSegment=!1);var T=function(D,I){return W(I,["moof","traf"]).reduce(function(_,C){var x=W(C,["tfdt"])[0],B=x[0],P=W(C,["tfhd"]).reduce(function(O,U){var M=G(U,4),K=D[M];if(K){var H=G(x,4);if(B===1){if(H===It)return R.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),O;H*=It+1,H+=G(x,8)}var Y=H/(K.timescale||9e4);if(isFinite(Y)&&(O===null||Y<O))return Y}return O},null);return P!==null&&isFinite(P)&&(_===null||P<_)?P:_},null)}(m,f),v=T===null?a:T;(function(D,I,_){if(D===null)return!0;var C=I-D.baseTime/D.timescale;return C<0&&Math.abs(C-_)>1}(u,v,a)||g.timescale!==u.timescale&&o)&&(g.initPTS=v-a,this.initPTS=u={baseTime:g.initPTS,timescale:1});var p=function(D,I){for(var _=0,C=0,x=0,B=W(D,["moof","traf"]),P=0;P<B.length;P++){var O=B[P],U=W(O,["tfhd"])[0],M=I[G(U,4)];if(M){var K=M.default,H=G(U,0)|(K==null?void 0:K.flags),Y=K==null?void 0:K.duration;8&H&&(Y=G(U,2&H?12:8));for(var q=M.timescale||9e4,le=W(O,["trun"]),J=0;J<le.length;J++)!(_=Aa(le[J]))&&Y&&(_=Y*G(le[J],4)),M.type===me?C+=_/q:M.type===se&&(x+=_/q)}}if(C===0&&x===0){for(var pe=0,ge=W(D,["sidx"]),ve=0;ve<ge.length;ve++){var Z=Ra(ge[ve]);Z!=null&&Z.references&&(pe+=Z.references.reduce(function(ie,Ae){return ie+Ae.info.duration||0},0))}return pe}return C||x}(f,m),S=e?v-u.baseTime/u.timescale:d,E=S+p;(function(D,I,_){W(I,["moof","traf"]).forEach(function(C){W(C,["tfhd"]).forEach(function(x){var B=G(x,4),P=D[B];if(P){var O=P.timescale||9e4;W(C,["tfdt"]).forEach(function(U){var M=U[0],K=G(U,4);if(M===0)K-=_*O,ur(U,4,K=Math.max(K,0));else{K*=Math.pow(2,32),K+=G(U,8),K-=_*O,K=Math.max(K,0);var H=Math.floor(K/(It+1)),Y=Math.floor(K%(It+1));ur(U,4,H),ur(U,8,Y)}})}})})})(m,f,u.baseTime/u.timescale),p>0?this.lastEndTime=E:(R.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var L=!!m.audio,A=!!m.video,b="";L&&(b+="audio"),A&&(b+="video");var w={data1:f,startPTS:S,startDTS:S,endPTS:E,endDTS:E,type:b,hasAudio:L,hasVideo:A,nb:1,dropped:0};return c.audio=w.type==="audio"?w:void 0,c.video=w.type!=="audio"?w:void 0,c.initSegment=g,c.id3=Rn(r,a,u,u),i.samples.length&&(c.text=An(i,a,u)),c},s}();function kn(s,n){var e=s==null?void 0:s.codec;return e&&e.length>4?e:e==="hvc1"||e==="hev1"?"hvc1.1.c.L120.90":e==="av01"?"av01.0.04M.08":e==="avc1"||n===me?"avc1.42e01e":"mp4a.40.5"}try{Ie=self.performance.now.bind(self.performance)}catch{R.debug("Unable to use Performance API on this environment"),Ie=typeof self<"u"&&self.Date.now}var Gr=[{demux:is,remux:vs},{demux:hs,remux:Br},{demux:ts,remux:Br},{demux:fs,remux:Br}],Kr=function(){function s(e,t,r,i,a){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.vendor=i,this.id=a}var n=s.prototype;return n.configure=function(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()},n.push=function(e,t,r,i){var a=this,o=r.transmuxing;o.executeStart=Ie();var l=new Uint8Array(e),h=this.currentTransmuxState,u=this.transmuxConfig;i&&(this.currentTransmuxState=i);var d=i||h,c=d.contiguous,f=d.discontinuity,g=d.trackSwitch,m=d.accurateTimeOffset,T=d.timeOffset,v=d.initSegmentChange,p=u.audioCodec,S=u.videoCodec,E=u.defaultInitPts,L=u.duration,A=u.initSegmentData,b=function(B,P){var O=null;return B.byteLength>0&&P!=null&&P.key!=null&&P.iv!==null&&P.method!=null&&(O=P),O}(l,t);if(b&&b.method==="AES-128"){var w=this.getDecrypter();if(!w.isSync())return this.decryptionPromise=w.webCryptoDecrypt(l,b.key.buffer,b.iv.buffer).then(function(B){var P=a.push(B,null,r);return a.decryptionPromise=null,P}),this.decryptionPromise;var D=w.softwareDecrypt(l,b.key.buffer,b.iv.buffer);if(r.part>-1&&(D=w.flush()),!D)return o.executeEnd=Ie(),Hr(r);l=new Uint8Array(D)}var I=this.needsProbing(f,g);if(I){var _=this.configureTransmuxer(l);if(_)return R.warn("[transmuxer] "+_.message),this.observer.emit(y.ERROR,y.ERROR,{type:N.MEDIA_ERROR,details:k.FRAG_PARSING_ERROR,fatal:!1,error:_,reason:_.message}),o.executeEnd=Ie(),Hr(r)}(f||g||v||I)&&this.resetInitSegment(A,p,S,L,t),(f||v||I)&&this.resetInitialTimestamp(E),c||this.resetContiguity();var C=this.transmux(l,b,T,m,r),x=this.currentTransmuxState;return x.contiguous=!0,x.discontinuity=!1,x.trackSwitch=!1,o.executeEnd=Ie(),C},n.flush=function(e){var t=this,r=e.transmuxing;r.executeStart=Ie();var i=this.decrypter,a=this.currentTransmuxState,o=this.decryptionPromise;if(o)return o.then(function(){return t.flush(e)});var l=[],h=a.timeOffset;if(i){var u=i.flush();u&&l.push(this.push(u,null,e))}var d=this.demuxer,c=this.remuxer;if(!d||!c)return r.executeEnd=Ie(),[Hr(e)];var f=d.flush(h);return Ve(f)?f.then(function(g){return t.flushRemux(l,g,e),l}):(this.flushRemux(l,f,e),l)},n.flushRemux=function(e,t,r){var i=t.audioTrack,a=t.videoTrack,o=t.id3Track,l=t.textTrack,h=this.currentTransmuxState,u=h.accurateTimeOffset,d=h.timeOffset;R.log("[transmuxer.ts]: Flushed fragment "+r.sn+(r.part>-1?" p: "+r.part:"")+" of level "+r.level);var c=this.remuxer.remux(i,a,o,l,d,u,!0,this.id);e.push({remuxResult:c,chunkMeta:r}),r.transmuxing.executeEnd=Ie()},n.resetInitialTimestamp=function(e){var t=this.demuxer,r=this.remuxer;t&&r&&(t.resetTimeStamp(e),r.resetTimeStamp(e))},n.resetContiguity=function(){var e=this.demuxer,t=this.remuxer;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())},n.resetInitSegment=function(e,t,r,i,a){var o=this.demuxer,l=this.remuxer;o&&l&&(o.resetInitSegment(e,t,r,i),l.resetInitSegment(e,t,r,a))},n.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},n.transmux=function(e,t,r,i,a){return t&&t.method==="SAMPLE-AES"?this.transmuxSampleAes(e,t,r,i,a):this.transmuxUnencrypted(e,r,i,a)},n.transmuxUnencrypted=function(e,t,r,i){var a=this.demuxer.demux(e,t,!1,!this.config.progressive),o=a.audioTrack,l=a.videoTrack,h=a.id3Track,u=a.textTrack;return{remuxResult:this.remuxer.remux(o,l,h,u,t,r,!1,this.id),chunkMeta:i}},n.transmuxSampleAes=function(e,t,r,i,a){var o=this;return this.demuxer.demuxSampleAes(e,t,r).then(function(l){return{remuxResult:o.remuxer.remux(l.audioTrack,l.videoTrack,l.id3Track,l.textTrack,r,i,!1,o.id),chunkMeta:a}})},n.configureTransmuxer=function(e){for(var t,r=this.config,i=this.observer,a=this.typeSupported,o=this.vendor,l=0,h=Gr.length;l<h;l++)if(Gr[l].demux.probe(e)){t=Gr[l];break}if(!t)return new Error("Failed to find demuxer by probing fragment data");var u=this.demuxer,d=this.remuxer,c=t.remux,f=t.demux;d&&d instanceof c||(this.remuxer=new c(i,r,a,o)),u&&u instanceof f||(this.demuxer=new f(i,r,a),this.probe=f.probe)},n.needsProbing=function(e,t){return!this.demuxer||!this.remuxer||e||t},n.getDecrypter=function(){var e=this.decrypter;return e||(e=this.decrypter=new wr(this.config)),e},s}(),Hr=function(s){return{remuxResult:{},chunkMeta:s}};function Ve(s){return"then"in s&&s.then instanceof Function}var ms=function(s,n,e,t,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=s,this.videoCodec=n,this.initSegmentData=e,this.duration=t,this.defaultInitPts=r||null},ps=function(s,n,e,t,r,i){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=s,this.contiguous=n,this.accurateTimeOffset=e,this.trackSwitch=t,this.timeOffset=r,this.initSegmentChange=i},Vr={};(function(s){var n=Object.prototype.hasOwnProperty,e="~";function t(){}function r(l,h,u){this.fn=l,this.context=h,this.once=u||!1}function i(l,h,u,d,c){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new r(u,d||l,c),g=e?e+h:h;return l._events[g]?l._events[g].fn?l._events[g]=[l._events[g],f]:l._events[g].push(f):(l._events[g]=f,l._eventsCount++),l}function a(l,h){--l._eventsCount==0?l._events=new t:delete l._events[h]}function o(){this._events=new t,this._eventsCount=0}Object.create&&(t.prototype=Object.create(null),new t().__proto__||(e=!1)),o.prototype.eventNames=function(){var l,h,u=[];if(this._eventsCount===0)return u;for(h in l=this._events)n.call(l,h)&&u.push(e?h.slice(1):h);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(l)):u},o.prototype.listeners=function(l){var h=e?e+l:l,u=this._events[h];if(!u)return[];if(u.fn)return[u.fn];for(var d=0,c=u.length,f=new Array(c);d<c;d++)f[d]=u[d].fn;return f},o.prototype.listenerCount=function(l){var h=e?e+l:l,u=this._events[h];return u?u.fn?1:u.length:0},o.prototype.emit=function(l,h,u,d,c,f){var g=e?e+l:l;if(!this._events[g])return!1;var m,T,v=this._events[g],p=arguments.length;if(v.fn){switch(v.once&&this.removeListener(l,v.fn,void 0,!0),p){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,h),!0;case 3:return v.fn.call(v.context,h,u),!0;case 4:return v.fn.call(v.context,h,u,d),!0;case 5:return v.fn.call(v.context,h,u,d,c),!0;case 6:return v.fn.call(v.context,h,u,d,c,f),!0}for(T=1,m=new Array(p-1);T<p;T++)m[T-1]=arguments[T];v.fn.apply(v.context,m)}else{var S,E=v.length;for(T=0;T<E;T++)switch(v[T].once&&this.removeListener(l,v[T].fn,void 0,!0),p){case 1:v[T].fn.call(v[T].context);break;case 2:v[T].fn.call(v[T].context,h);break;case 3:v[T].fn.call(v[T].context,h,u);break;case 4:v[T].fn.call(v[T].context,h,u,d);break;default:if(!m)for(S=1,m=new Array(p-1);S<p;S++)m[S-1]=arguments[S];v[T].fn.apply(v[T].context,m)}}return!0},o.prototype.on=function(l,h,u){return i(this,l,h,u,!1)},o.prototype.once=function(l,h,u){return i(this,l,h,u,!0)},o.prototype.removeListener=function(l,h,u,d){var c=e?e+l:l;if(!this._events[c])return this;if(!h)return a(this,c),this;var f=this._events[c];if(f.fn)f.fn!==h||d&&!f.once||u&&f.context!==u||a(this,c);else{for(var g=0,m=[],T=f.length;g<T;g++)(f[g].fn!==h||d&&!f[g].once||u&&f[g].context!==u)&&m.push(f[g]);m.length?this._events[c]=m.length===1?m[0]:m:a(this,c)}return this},o.prototype.removeAllListeners=function(l){var h;return l?(h=e?e+l:l,this._events[h]&&a(this,h)):(this._events=new t,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=e,o.EventEmitter=o,s.exports=o})({get exports(){return Vr},set exports(s){Vr=s}});var Vt=Vr;function Yr(s,n){if(!((e=n.remuxResult).audio||e.video||e.text||e.id3||e.initSegment))return!1;var e,t=[],r=n.remuxResult,i=r.audio,a=r.video;return i&&Dn(t,i),a&&Dn(t,a),s.postMessage({event:"transmuxComplete",data:n},t),!0}function Dn(s,n){n.data1&&s.push(n.data1.buffer),n.data2&&s.push(n.data2.buffer)}function In(s,n,e){n.reduce(function(t,r){return Yr(s,r)||t},!1)||s.postMessage({event:"transmuxComplete",data:n[0]}),s.postMessage({event:"flush",data:e})}_e!==void 0&&_e&&function(s){var n=new Vt,e=function(r,i){s.postMessage({event:r,data:i})};n.on(y.FRAG_DECRYPTED,e),n.on(y.ERROR,e);var t=function(){var r=function(a){var o=function(l){e("workerLog",{logType:a,message:l})};R[a]=o};for(var i in R)r(i)};s.addEventListener("message",function(r){var i=r.data;switch(i.cmd){case"init":var a=JSON.parse(i.config);s.transmuxer=new Kr(n,i.typeSupported,a,i.vendor,i.id),ci(a.debug,i.id),t(),e("init",null);break;case"configure":s.transmuxer.configure(i.config);break;case"demux":var o=s.transmuxer.push(i.data,i.decryptdata,i.chunkMeta,i.state);Ve(o)?(s.transmuxer.async=!0,o.then(function(u){Yr(s,u)}).catch(function(u){e(y.ERROR,{type:N.MEDIA_ERROR,details:k.FRAG_PARSING_ERROR,chunkMeta:i.chunkMeta,fatal:!1,error:u,err:u,reason:"transmuxer-worker push error"})})):(s.transmuxer.async=!1,Yr(s,o));break;case"flush":var l=i.chunkMeta,h=s.transmuxer.flush(l);Ve(h)||s.transmuxer.async?(Ve(h)||(h=Promise.resolve(h)),h.then(function(u){In(s,u,l)}).catch(function(u){e(y.ERROR,{type:N.MEDIA_ERROR,details:k.FRAG_PARSING_ERROR,chunkMeta:i.chunkMeta,fatal:!1,error:u,err:u,reason:"transmuxer-worker flush error"})})):In(s,h,l)}})}(self);var Wr=Pr()||{isTypeSupported:function(){return!1}},wn=function(){function s(e,t,r,i){var a=this;this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var o=e.config;this.hls=e,this.id=t,this.useWorker=!!o.enableWorker,this.onTransmuxComplete=r,this.onFlush=i;var l=function(T,v){(v=v||{}).frag=a.frag,v.id=a.id,T===y.ERROR&&(a.error=v.error),a.hls.trigger(T,v)};this.observer=new Vt,this.observer.on(y.FRAG_DECRYPTED,l),this.observer.on(y.ERROR,l);var h,u,d,c,f={mp4:Wr.isTypeSupported("video/mp4"),mpeg:Wr.isTypeSupported("audio/mpeg"),mp3:Wr.isTypeSupported('audio/mp4; codecs="mp3"')},g=navigator.vendor;if(!this.useWorker||typeof Worker>"u"||(o.workerPath,0))this.transmuxer=new Kr(this.observer,f,o,g,t);else try{o.workerPath?(R.log("loading Web Worker "+o.workerPath+' for "'+t+'"'),this.workerContext=(d=o.workerPath,c=new self.URL(d,self.location.href).href,{worker:new self.Worker(c),scriptURL:c})):(R.log('injecting Web Worker for "'+t+'"'),this.workerContext=(h=new self.Blob(["var exports={};var module={exports:exports};function define(f){f()};define.amd=true;("+at.toString()+")(true);"],{type:"text/javascript"}),u=self.URL.createObjectURL(h),{worker:new self.Worker(u),objectURL:u})),this.onwmsg=function(T){return a.onWorkerMessage(T)};var m=this.workerContext.worker;m.addEventListener("message",this.onwmsg),m.onerror=function(T){var v=new Error(T.message+"  ("+T.filename+":"+T.lineno+")");o.enableWorker=!1,R.warn('Error in "'+t+'" Web Worker, fallback to inline'),a.hls.trigger(y.ERROR,{type:N.OTHER_ERROR,details:k.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:v})},m.postMessage({cmd:"init",typeSupported:f,vendor:g,id:t,config:JSON.stringify(o)})}catch(T){R.warn('Error setting up "'+t+'" Web Worker, fallback to inline',T),this.resetWorker(),this.error=null,this.transmuxer=new Kr(this.observer,f,o,g,t)}}var n=s.prototype;return n.resetWorker=function(){if(this.workerContext){var e=this.workerContext,t=e.worker,r=e.objectURL;r&&self.URL.revokeObjectURL(r),t.removeEventListener("message",this.onwmsg),t.onerror=null,t.terminate(),this.workerContext=null}},n.destroy=function(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{var e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}var t=this.observer;t&&t.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},n.push=function(e,t,r,i,a,o,l,h,u,d){var c,f,g=this;u.transmuxing.start=self.performance.now();var m=this.transmuxer,T=o?o.start:a.start,v=a.decryptdata,p=this.frag,S=!(p&&a.cc===p.cc),E=!(p&&u.level===p.level),L=p?u.sn-p.sn:-1,A=this.part?u.part-this.part.index:-1,b=L===0&&u.id>1&&u.id===(p==null?void 0:p.stats.chunkCount),w=!E&&(L===1||L===0&&(A===1||b&&A<=0)),D=self.performance.now();(E||L||a.stats.parsing.start===0)&&(a.stats.parsing.start=D),!o||!A&&w||(o.stats.parsing.start=D);var I=!(p&&((c=a.initSegment)==null?void 0:c.url)===((f=p.initSegment)==null?void 0:f.url)),_=new ps(S,w,h,E,T,I);if(!w||S||I){R.log("[transmuxer-interface, "+a.type+"]: Starting new transmux session for sn: "+u.sn+" p: "+u.part+" level: "+u.level+" id: "+u.id+`
        discontinuity: `+S+`
        trackSwitch: `+E+`
        contiguous: `+w+`
        accurateTimeOffset: `+h+`
        timeOffset: `+T+`
        initSegmentChange: `+I);var C=new ms(r,i,t,l,d);this.configureTransmuxer(C)}if(this.frag=a,this.part=o,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:v,chunkMeta:u,state:_},e instanceof ArrayBuffer?[e]:[]);else if(m){var x=m.push(e,v,u,_);Ve(x)?(m.async=!0,x.then(function(B){g.handleTransmuxComplete(B)}).catch(function(B){g.transmuxerError(B,u,"transmuxer-interface push error")})):(m.async=!1,this.handleTransmuxComplete(x))}},n.flush=function(e){var t=this;e.transmuxing.start=self.performance.now();var r=this.transmuxer;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(r){var i=r.flush(e);Ve(i)||r.async?(Ve(i)||(i=Promise.resolve(i)),i.then(function(a){t.handleFlushResult(a,e)}).catch(function(a){t.transmuxerError(a,e,"transmuxer-interface flush error")})):this.handleFlushResult(i,e)}},n.transmuxerError=function(e,t,r){this.hls&&(this.error=e,this.hls.trigger(y.ERROR,{type:N.MEDIA_ERROR,details:k.FRAG_PARSING_ERROR,chunkMeta:t,fatal:!1,error:e,err:e,reason:r}))},n.handleFlushResult=function(e,t){var r=this;e.forEach(function(i){r.handleTransmuxComplete(i)}),this.onFlush(t)},n.onWorkerMessage=function(e){var t=e.data,r=this.hls;switch(t.event){case"init":var i,a=(i=this.workerContext)==null?void 0:i.objectURL;a&&self.URL.revokeObjectURL(a);break;case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":R[t.data.logType]&&R[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,r.trigger(t.event,t.data)}},n.configureTransmuxer=function(e){var t=this.transmuxer;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)},n.handleTransmuxComplete=function(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)},s}(),ys=function(){function s(e,t,r,i){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=r,this.hls=i}var n=s.prototype;return n.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},n.poll=function(e,t){var r=this.config,i=this.media,a=this.stalled;if(i!==null){var o=i.currentTime,l=i.seeking,h=this.seeking&&!l,u=!this.seeking&&l;if(this.seeking=l,o===e){if(u||h)this.stalled=null;else if(!(i.paused&&!l||i.ended||i.playbackRate===0)&&Q.getBuffered(i).length){var d=Q.bufferInfo(i,o,0),c=d.len>0,f=d.nextStart||0;if(c||f){if(l){var g=d.len>2,m=!f||t&&t.start<=o||f-o>2&&!this.fragmentTracker.getPartialFragment(o);if(g||m)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var T,v=Math.max(f,d.start||0)-o,p=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,S=!(p==null||(T=p.details)==null)&&T.live?2*p.details.targetduration:2,E=this.fragmentTracker.getPartialFragment(o);if(v>0&&(v<=S||E))return void this._trySkipBufferHole(E)}var L=self.performance.now();if(a!==null){var A=L-a;if(l||!(A>=250)||(this._reportStall(d),this.media)){var b=Q.bufferInfo(i,o,r.maxBufferHole);this._tryFixBufferStall(b,A)}}else this.stalled=L}}}else if(this.moved=!0,a!==null){if(this.stallReported){var w=self.performance.now()-a;R.warn("playback not stuck anymore @"+o+", after "+Math.round(w)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}}},n._tryFixBufferStall=function(e,t){var r=this.config,i=this.fragmentTracker,a=this.media;if(a!==null){var o=a.currentTime,l=i.getPartialFragment(o);if(l&&(this._trySkipBufferHole(l)||!this.media))return;(e.len>r.maxBufferHole||e.nextStart&&e.nextStart-o<r.maxBufferHole)&&t>1e3*r.highBufferWatchdogPeriod&&(R.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},n._reportStall=function(e){var t=this.hls,r=this.media;if(!this.stallReported&&r){this.stallReported=!0;var i=new Error("Playback stalling at @"+r.currentTime+" due to low buffer ("+JSON.stringify(e)+")");R.warn(i.message),t.trigger(y.ERROR,{type:N.MEDIA_ERROR,details:k.BUFFER_STALLED_ERROR,fatal:!1,error:i,buffer:e.len})}},n._trySkipBufferHole=function(e){var t=this.config,r=this.hls,i=this.media;if(i===null)return 0;var a=i.currentTime,o=Q.bufferInfo(i,a,0),l=a<o.start?o.start:o.nextStart;if(l){var h=o.len<=t.maxBufferHole,u=o.len>0&&o.len<1&&i.readyState<3,d=l-a;if(d>0&&(h||u)){if(d>t.maxBufferHole){var c=this.fragmentTracker,f=!1;if(a===0){var g=c.getAppendedFrag(0,j);g&&l<g.end&&(f=!0)}if(!f){var m=e||c.getAppendedFrag(a,j);if(m){for(var T=!1,v=m.end;v<l;){var p=c.getPartialFragment(v);if(!p){T=!0;break}v+=p.duration}if(T)return 0}}}var S=Math.max(l+.05,a+.1);if(R.warn("skipping hole, adjusting currentTime from "+a+" to "+S),this.moved=!0,this.stalled=null,i.currentTime=S,e&&!e.gap){var E=new Error("fragment loaded with buffer holes, seeking from "+a+" to "+S);r.trigger(y.ERROR,{type:N.MEDIA_ERROR,details:k.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:E,reason:E.message,frag:e})}return S}}return 0},n._tryNudgeBuffer=function(){var e=this.config,t=this.hls,r=this.media,i=this.nudgeRetry;if(r!==null){var a=r.currentTime;if(this.nudgeRetry++,i<e.nudgeMaxRetry){var o=a+(i+1)*e.nudgeOffset,l=new Error("Nudging 'currentTime' from "+a+" to "+o);R.warn(l.message),r.currentTime=o,t.trigger(y.ERROR,{type:N.MEDIA_ERROR,details:k.BUFFER_NUDGE_ON_STALL,error:l,fatal:!1})}else{var h=new Error("Playhead still not moving while enough data buffered @"+a+" after "+e.nudgeMaxRetry+" nudges");R.error(h.message),t.trigger(y.ERROR,{type:N.MEDIA_ERROR,details:k.BUFFER_STALLED_ERROR,error:h,fatal:!0})}}},s}(),Ts=function(s){function n(t,r,i){var a;return(a=s.call(this,t,r,i,"[stream-controller]",j)||this).audioCodecSwap=!1,a.gapController=null,a.level=-1,a._forceStartLoad=!1,a.altAudio=!1,a.audioOnly=!1,a.fragPlaying=null,a.onvplaying=null,a.onvseeked=null,a.fragLastKbps=0,a.couldBacktrack=!1,a.backtrackFragment=null,a.audioCodecSwitch=!1,a.videoBuffer=null,a._registerListeners(),a}ae(n,s);var e=n.prototype;return e._registerListeners=function(){var t=this.hls;t.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(y.MANIFEST_LOADING,this.onManifestLoading,this),t.on(y.MANIFEST_PARSED,this.onManifestParsed,this),t.on(y.LEVEL_LOADING,this.onLevelLoading,this),t.on(y.LEVEL_LOADED,this.onLevelLoaded,this),t.on(y.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(y.ERROR,this.onError,this),t.on(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(y.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(y.BUFFER_CREATED,this.onBufferCreated,this),t.on(y.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(y.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(y.FRAG_BUFFERED,this.onFragBuffered,this)},e._unregisterListeners=function(){var t=this.hls;t.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(y.MANIFEST_LOADING,this.onManifestLoading,this),t.off(y.MANIFEST_PARSED,this.onManifestParsed,this),t.off(y.LEVEL_LOADED,this.onLevelLoaded,this),t.off(y.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(y.ERROR,this.onError,this),t.off(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(y.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(y.BUFFER_CREATED,this.onBufferCreated,this),t.off(y.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(y.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(y.FRAG_BUFFERED,this.onFragBuffered,this)},e.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},e.startLoad=function(t){if(this.levels){var r=this.lastCurrentTime,i=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){var a=i.startLevel;a===-1&&(i.config.testBandwidth&&this.levels.length>1?(a=0,this.bitrateTest=!0):a=i.nextAutoLevel),this.level=i.nextLoadLevel=a,this.loadedmetadata=!1}r>0&&t===-1&&(this.log("Override startPosition with lastCurrentTime @"+r.toFixed(3)),t=r),this.state=V,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this._forceStartLoad=!0,this.state=de},e.stopLoad=function(){this._forceStartLoad=!1,s.prototype.stopLoad.call(this)},e.doTick=function(){switch(this.state){case et:var t,r=this.levels,i=this.level,a=r==null||(t=r[i])==null?void 0:t.details;if(a&&(!a.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(a))break;this.state=V;break}break;case Je:var o,l=self.performance.now(),h=this.retryDate;(!h||l>=h||(o=this.media)!=null&&o.seeking)&&(this.resetStartWhenNotLoaded(this.level),this.state=V)}this.state===V&&this.doTickIdle(),this.onTickEnd()},e.onTickEnd=function(){s.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},e.doTickIdle=function(){var t=this.hls,r=this.levelLastLoaded,i=this.levels,a=this.media,o=t.config,l=t.nextLoadLevel;if(r!==null&&(a||!this.startFragRequested&&o.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&i!=null&&i[l]){var h=i[l],u=this.getMainFwdBufferInfo();if(u!==null){var d=this.getLevelDetails();if(d&&this._streamEnded(u,d)){var c={};return this.altAudio&&(c.type="video"),this.hls.trigger(y.BUFFER_EOS,c),void(this.state=pt)}t.loadLevel!==l&&t.manualLevel===-1&&this.log("Adapting to level "+l+" from level "+this.level),this.level=t.nextLoadLevel=l;var f=h.details;if(!f||this.state===et||f.live&&this.levelLastLoaded!==l)return this.level=l,void(this.state=et);var g=u.len,m=this.getMaxBufferLength(h.maxBitrate);if(!(g>=m)){this.backtrackFragment&&this.backtrackFragment.start>u.end&&(this.backtrackFragment=null);var T=this.backtrackFragment?this.backtrackFragment.start:u.end,v=this.getNextFragment(T,f);if(this.couldBacktrack&&!this.fragPrevious&&v&&v.sn!=="initSegment"&&this.fragmentTracker.getState(v)!==vt){var p,S=((p=this.backtrackFragment)!=null?p:v).sn-f.startSN,E=f.fragments[S-1];E&&v.cc===E.cc&&(v=E,this.fragmentTracker.removeFragment(E))}else this.backtrackFragment&&u.len&&(this.backtrackFragment=null);if(v&&this.isLoopLoading(v,T)){if(!v.gap){var L=this.audioOnly&&!this.altAudio?se:me,A=(L===me?this.videoBuffer:this.mediaBuffer)||this.media;A&&this.afterBufferFlushed(A,L,j)}v=this.getNextFragmentLoopLoading(v,f,u,j,m)}v&&(!v.initSegment||v.initSegment.data||this.bitrateTest||(v=v.initSegment),this.loadFragment(v,h,T))}}}},e.loadFragment=function(t,r,i){var a=this.fragmentTracker.getState(t);this.fragCurrent=t,a===Mt?t.sn==="initSegment"?this._loadInitSegment(t,r):this.bitrateTest?(this.log("Fragment "+t.sn+" of level "+t.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(t,r)):(this.startFragRequested=!0,s.prototype.loadFragment.call(this,t,r,i)):this.clearTrackerIfNeeded(t)},e.getAppendedFrag=function(t){var r=this.fragmentTracker.getAppendedFrag(t,j);return r&&"fragment"in r?r.fragment:r},e.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,j)},e.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.end+.5):null},e.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},e.nextLevelSwitch=function(){var t=this.levels,r=this.media;if(r!=null&&r.readyState){var i,a=this.getAppendedFrag(r.currentTime);if(a&&a.start>1&&this.flushMainBuffer(0,a.start-1),!r.paused&&t){var o=t[this.hls.nextLoadLevel],l=this.fragLastKbps;i=l&&this.fragCurrent?this.fragCurrent.duration*o.maxBitrate/(1e3*l)+1:0}else i=0;var h=this.getBufferedFrag(r.currentTime+i);if(h){var u=this.followingBufferedFrag(h);if(u){this.abortCurrentFrag();var d=u.maxStartPTS?u.maxStartPTS:u.start,c=u.duration,f=Math.max(h.end,d+Math.min(Math.max(c-this.config.maxFragLookUpTolerance,.5*c),.75*c));this.flushMainBuffer(f,Number.POSITIVE_INFINITY)}}}},e.abortCurrentFrag=function(){var t=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,t&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.state){case Cr:case $e:case Je:case De:case Ut:this.state=V}this.nextLoadPosition=this.getLoadPosition()},e.flushMainBuffer=function(t,r){s.prototype.flushMainBuffer.call(this,t,r,this.altAudio?"video":null)},e.onMediaAttached=function(t,r){s.prototype.onMediaAttached.call(this,t,r);var i=r.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),i.addEventListener("playing",this.onvplaying),i.addEventListener("seeked",this.onvseeked),this.gapController=new ys(this.config,i,this.fragmentTracker,this.hls)},e.onMediaDetaching=function(){var t=this.media;t&&this.onvplaying&&this.onvseeked&&(t.removeEventListener("playing",this.onvplaying),t.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),s.prototype.onMediaDetaching.call(this)},e.onMediaPlaying=function(){this.tick()},e.onMediaSeeked=function(){var t=this.media,r=t?t.currentTime:null;F(r)&&this.log("Media seeked to "+r.toFixed(3));var i=this.getMainFwdBufferInfo();i!==null&&i.len!==0?this.tick():this.warn('Main forward buffer length on "seeked" event '+(i?i.len:"empty")+")")},e.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(y.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},e.onManifestParsed=function(t,r){var i,a,o,l=!1,h=!1;r.levels.forEach(function(u){(i=u.audioCodec)&&(i.indexOf("mp4a.40.2")!==-1&&(l=!0),i.indexOf("mp4a.40.5")!==-1&&(h=!0))}),this.audioCodecSwitch=l&&h&&typeof((o=dn())==null||(a=o.prototype)==null?void 0:a.changeType)!="function",this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=r.levels,this.startFragRequested=!1},e.onLevelLoading=function(t,r){var i=this.levels;if(i&&this.state===V){var a=i[r.level];(!a.details||a.details.live&&this.levelLastLoaded!==r.level||this.waitForCdnTuneIn(a.details))&&(this.state=et)}},e.onLevelLoaded=function(t,r){var i,a=this.levels,o=r.level,l=r.details,h=l.totalduration;if(a){this.log("Level "+o+" loaded ["+l.startSN+","+l.endSN+"], cc ["+l.startCC+", "+l.endCC+"] duration:"+h);var u=a[o],d=this.fragCurrent;!d||this.state!==$e&&this.state!==Je||d.level===r.level&&d.urlId===u.urlId||!d.loader||this.abortCurrentFrag();var c=0;if(l.live||(i=u.details)!=null&&i.live){if(l.fragments[0]||(l.deltaUpdateFailed=!0),l.deltaUpdateFailed)return;c=this.alignPlaylists(l,u.details)}if(u.details=l,this.levelLastLoaded=o,this.hls.trigger(y.LEVEL_UPDATED,{details:l,level:o}),this.state===et){if(this.waitForCdnTuneIn(l))return;this.state=V}this.startFragRequested?l.live&&this.synchronizeToLiveEdge(l):this.setStartPosition(l,c),this.tick()}else this.warn("Levels were reset while loading level "+o)},e._handleFragmentLoadProgress=function(t){var r,i=t.frag,a=t.part,o=t.payload,l=this.levels;if(l){var h=l[i.level],u=h.details;if(!u)return this.warn("Dropping fragment "+i.sn+" of level "+i.level+" after level details were reset"),void this.fragmentTracker.removeFragment(i);var d=h.videoCodec,c=u.PTSKnown||!u.live,f=(r=i.initSegment)==null?void 0:r.data,g=this._getAudioCodec(h),m=this.transmuxer=this.transmuxer||new wn(this.hls,j,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),T=a?a.index:-1,v=T!==-1,p=new Dr(i.level,i.sn,i.stats.chunkCount,o.byteLength,T,v),S=this.initPTS[i.cc];m.push(o,f,g,d,i,a,u.totalduration,c,p,S)}else this.warn("Levels were reset while fragment load was in progress. Fragment "+i.sn+" of level "+i.level+" will not be buffered")},e.onAudioTrackSwitching=function(t,r){var i=this.altAudio;if(!r.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var o=this.hls;i&&(o.trigger(y.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),o.trigger(y.AUDIO_TRACK_SWITCHED,r)}},e.onAudioTrackSwitched=function(t,r){var i=r.id,a=!!this.hls.audioTracks[i].url;if(a){var o=this.videoBuffer;o&&this.mediaBuffer!==o&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=o)}this.altAudio=a,this.tick()},e.onBufferCreated=function(t,r){var i,a,o=r.tracks,l=!1;for(var h in o){var u=o[h];if(u.id==="main"){if(a=h,i=u,h==="video"){var d=o[h];d&&(this.videoBuffer=d.buffer)}}else l=!0}l&&i?(this.log("Alternate track found, use "+a+".buffered to schedule main fragment loading"),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media},e.onFragBuffered=function(t,r){var i=r.frag,a=r.part;if(!i||i.type===j){if(this.fragContextChanged(i))return this.warn("Fragment "+i.sn+(a?" p: "+a.index:"")+" of level "+i.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===Ut&&(this.state=V));var o=a?a.stats:i.stats;this.fragLastKbps=Math.round(8*o.total/(o.buffering.end-o.loading.first)),i.sn!=="initSegment"&&(this.fragPrevious=i),this.fragBufferedComplete(i,a)}},e.onError=function(t,r){var i;if(r.fatal)this.state=Ze;else switch(r.details){case k.FRAG_GAP:case k.FRAG_PARSING_ERROR:case k.FRAG_DECRYPT_ERROR:case k.FRAG_LOAD_ERROR:case k.FRAG_LOAD_TIMEOUT:case k.KEY_LOAD_ERROR:case k.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(j,r);break;case k.LEVEL_LOAD_ERROR:case k.LEVEL_LOAD_TIMEOUT:case k.LEVEL_PARSING_ERROR:r.levelRetry||this.state!==et||((i=r.context)==null?void 0:i.type)!==Ke||(this.state=V);break;case k.BUFFER_FULL_ERROR:if(!r.parent||r.parent!=="main")return;this.reduceLengthAndFlushBuffer(r)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case k.INTERNAL_EXCEPTION:this.recoverWorkerError(r)}},e.checkBuffer=function(){var t=this.media,r=this.gapController;if(t&&r&&t.readyState){if(this.loadedmetadata||!Q.getBuffered(t).length){var i=this.state!==V?this.fragCurrent:null;r.poll(this.lastCurrentTime,i)}this.lastCurrentTime=t.currentTime}},e.onFragLoadEmergencyAborted=function(){this.state=V,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},e.onBufferFlushed=function(t,r){var i=r.type;if(i!==se||this.audioOnly&&!this.altAudio){var a=(i===me?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(a,i,j)}},e.onLevelsUpdated=function(t,r){this.levels=r.levels},e.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},e.seekToStartPos=function(){var t=this.media;if(t){var r=t.currentTime,i=this.startPosition;if(i>=0&&r<i){if(t.seeking)return void this.log("could not seek to "+i+", already seeking at "+r);var a=Q.getBuffered(t),o=(a.length?a.start(0):0)-i;o>0&&(o<this.config.maxBufferHole||o<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+o+" to match buffer start"),i+=o,this.startPosition=i),this.log("seek to target start position "+i+" from current time "+r),t.currentTime=i}}},e._getAudioCodec=function(t){var r=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&r&&(this.log("Swapping audio codec"),r=r.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),r},e._loadBitrateTestFrag=function(t,r){var i=this;t.bitrateTest=!0,this._doFragLoad(t,r).then(function(a){var o=i.hls;if(a&&!i.fragContextChanged(t)){r.fragmentError=0,i.state=V,i.startFragRequested=!1,i.bitrateTest=!1;var l=t.stats;l.parsing.start=l.parsing.end=l.buffering.start=l.buffering.end=self.performance.now(),o.trigger(y.FRAG_LOADED,a),t.bitrateTest=!1}})},e._handleTransmuxComplete=function(t){var r,i="main",a=this.hls,o=t.remuxResult,l=t.chunkMeta,h=this.getCurrentContext(l);if(h){var u=h.frag,d=h.part,c=h.level,f=o.video,g=o.text,m=o.id3,T=o.initSegment,v=c.details,p=this.altAudio?void 0:o.audio;if(this.fragContextChanged(u))this.fragmentTracker.removeFragment(u);else{if(this.state=De,T){T.tracks&&(this._bufferInitSegment(c,T.tracks,u,l),a.trigger(y.FRAG_PARSING_INIT_SEGMENT,{frag:u,id:i,tracks:T.tracks}));var S=T.initPTS,E=T.timescale;F(S)&&(this.initPTS[u.cc]={baseTime:S,timescale:E},a.trigger(y.INIT_PTS_FOUND,{frag:u,id:i,initPTS:S,timescale:E}))}if(f&&o.independent!==!1){if(v){var L=f.startPTS,A=f.endPTS,b=f.startDTS,w=f.endDTS;if(d)d.elementaryStreams[f.type]={startPTS:L,endPTS:A,startDTS:b,endDTS:w};else if(f.firstKeyFrame&&f.independent&&l.id===1&&(this.couldBacktrack=!0),f.dropped&&f.independent){var D=this.getMainFwdBufferInfo();if((D?D.end:this.getLoadPosition())+this.config.maxBufferHole<(f.firstKeyFramePTS?f.firstKeyFramePTS:L)-this.config.maxBufferHole)return void this.backtrack(u);u.setElementaryStreamInfo(f.type,u.start,A,u.start,w,!0)}u.setElementaryStreamInfo(f.type,L,A,b,w),this.backtrackFragment&&(this.backtrackFragment=u),this.bufferFragmentData(f,u,d,l)}}else if(o.independent===!1)return void this.backtrack(u);if(p){var I=p.startPTS,_=p.endPTS,C=p.startDTS,x=p.endDTS;d&&(d.elementaryStreams[se]={startPTS:I,endPTS:_,startDTS:C,endDTS:x}),u.setElementaryStreamInfo(se,I,_,C,x),this.bufferFragmentData(p,u,d,l)}if(v&&m!=null&&(r=m.samples)!=null&&r.length){var B={id:i,frag:u,details:v,samples:m.samples};a.trigger(y.FRAG_PARSING_METADATA,B)}if(v&&g){var P={id:i,frag:u,details:v,samples:g.samples};a.trigger(y.FRAG_PARSING_USERDATA,P)}}}else this.resetWhenMissingContext(l)},e._bufferInitSegment=function(t,r,i,a){var o=this;if(this.state===De){this.audioOnly=!!r.audio&&!r.video,this.altAudio&&!this.audioOnly&&delete r.audio;var l=r.audio,h=r.video,u=r.audiovideo;if(l){var d=t.audioCodec,c=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(d&&(d=d.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),l.metadata.channelCount!==1&&c.indexOf("firefox")===-1&&(d="mp4a.40.5")),c.indexOf("android")!==-1&&l.container!=="audio/mpeg"&&(d="mp4a.40.2",this.log("Android: force audio codec to "+d)),t.audioCodec&&t.audioCodec!==d&&this.log('Swapping manifest audio codec "'+t.audioCodec+'" for "'+d+'"'),l.levelCodec=d,l.id="main",this.log("Init audio buffer, container:"+l.container+", codecs[selected/level/parsed]=["+(d||"")+"/"+(t.audioCodec||"")+"/"+l.codec+"]")}h&&(h.levelCodec=t.videoCodec,h.id="main",this.log("Init video buffer, container:"+h.container+", codecs[level/parsed]=["+(t.videoCodec||"")+"/"+h.codec+"]")),u&&this.log("Init audiovideo buffer, container:"+u.container+", codecs[level/parsed]=["+(t.attrs.CODECS||"")+"/"+u.codec+"]"),this.hls.trigger(y.BUFFER_CODECS,r),Object.keys(r).forEach(function(f){var g=r[f].initSegment;g!=null&&g.byteLength&&o.hls.trigger(y.BUFFER_APPENDING,{type:f,data:g,frag:i,part:null,chunkMeta:a,parent:i.type})}),this.tick()}},e.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,j)},e.backtrack=function(t){this.couldBacktrack=!0,this.backtrackFragment=t,this.resetTransmuxer(),this.flushBufferGap(t),this.fragmentTracker.removeFragment(t),this.fragPrevious=null,this.nextLoadPosition=t.start,this.state=V},e.checkFragmentChanged=function(){var t=this.media,r=null;if(t&&t.readyState>1&&t.seeking===!1){var i=t.currentTime;if(Q.isBuffered(t,i)?r=this.getAppendedFrag(i):Q.isBuffered(t,i+.1)&&(r=this.getAppendedFrag(i+.1)),r){this.backtrackFragment=null;var a=this.fragPlaying,o=r.level;a&&r.sn===a.sn&&a.level===o&&r.urlId===a.urlId||(this.fragPlaying=r,this.hls.trigger(y.FRAG_CHANGED,{frag:r}),a&&a.level===o||this.hls.trigger(y.LEVEL_SWITCHED,{level:o}))}}},ee(n,[{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"currentFrag",get:function(){var t=this.media;return t?this.fragPlaying||this.getAppendedFrag(t.currentTime):null}},{key:"currentProgramDateTime",get:function(){var t=this.media;if(t){var r=t.currentTime,i=this.currentFrag;if(i&&F(r)&&F(i.programDateTime)){var a=i.programDateTime+1e3*(r-i.start);return new Date(a)}}return null}},{key:"currentLevel",get:function(){var t=this.currentFrag;return t?t.level:-1}},{key:"nextBufferedFrag",get:function(){var t=this.currentFrag;return t?this.followingBufferedFrag(t):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),n}(_r),rt=function(){function s(e,t,r){t===void 0&&(t=0),r===void 0&&(r=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}var n=s.prototype;return n.sample=function(e,t){var r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e},n.getTotalWeight=function(){return this.totalWeight_},n.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_},s}(),Es=function(){function s(e,t,r,i){i===void 0&&(i=100),this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new rt(e),this.fast_=new rt(t),this.defaultTTFB_=i,this.ttfb_=new rt(e)}var n=s.prototype;return n.update=function(e,t){var r=this.slow_,i=this.fast_,a=this.ttfb_;r.halfLife!==e&&(this.slow_=new rt(e,r.getEstimate(),r.getTotalWeight())),i.halfLife!==t&&(this.fast_=new rt(t,i.getEstimate(),i.getTotalWeight())),a.halfLife!==e&&(this.ttfb_=new rt(e,a.getEstimate(),a.getTotalWeight()))},n.sample=function(e,t){var r=(e=Math.max(e,this.minDelayMs_))/1e3,i=8*t/r;this.fast_.sample(r,i),this.slow_.sample(r,i)},n.sampleTTFB=function(e){var t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))},n.canEstimate=function(){return this.fast_.getTotalWeight()>=this.minWeight_},n.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},n.getEstimateTTFB=function(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_},n.destroy=function(){},s}(),Ss=function(){function s(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=-1,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=e;var t=e.config;this.bwEstimator=new Es(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate),this.registerListeners()}var n=s.prototype;return n.registerListeners=function(){var e=this.hls;e.on(y.FRAG_LOADING,this.onFragLoading,this),e.on(y.FRAG_LOADED,this.onFragLoaded,this),e.on(y.FRAG_BUFFERED,this.onFragBuffered,this),e.on(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(y.LEVEL_LOADED,this.onLevelLoaded,this)},n.unregisterListeners=function(){var e=this.hls;e.off(y.FRAG_LOADING,this.onFragLoading,this),e.off(y.FRAG_LOADED,this.onFragLoaded,this),e.off(y.FRAG_BUFFERED,this.onFragBuffered,this),e.off(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(y.LEVEL_LOADED,this.onLevelLoaded,this)},n.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},n.onFragLoading=function(e,t){var r,i=t.frag;this.ignoreFragment(i)||(this.fragCurrent=i,this.partCurrent=(r=t.part)!=null?r:null,this.clearTimer(),this.timer=self.setInterval(this.onCheck,100))},n.onLevelSwitching=function(e,t){this.clearTimer()},n.getTimeToLoadFrag=function(e,t,r,i){return e+r/t+(i?this.lastLevelLoadSec:0)},n.onLevelLoaded=function(e,t){var r=this.hls.config,i=t.stats,a=i.total,o=i.bwEstimate;F(a)&&F(o)&&(this.lastLevelLoadSec=8*a/o),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)},n._abandonRulesCheck=function(){var e=this.fragCurrent,t=this.partCurrent,r=this.hls,i=r.autoLevelEnabled,a=r.media;if(e&&a){var o=performance.now(),l=t?t.stats:e.stats,h=t?t.duration:e.duration,u=o-l.loading.start;if(l.aborted||l.loaded&&l.loaded===l.total||e.level===0)return this.clearTimer(),void(this._nextAutoLevel=-1);if(i&&!a.paused&&a.playbackRate&&a.readyState){var d=r.mainForwardBufferInfo;if(d!==null){var c=this.bwEstimator.getEstimateTTFB(),f=Math.abs(a.playbackRate);if(!(u<=Math.max(c,h/(2*f)*1e3))){var g=d.len/f;if(!(g>=2*h/f)){var m=l.loading.first?l.loading.first-l.loading.start:-1,T=l.loaded&&m>-1,v=this.bwEstimator.getEstimate(),p=r.levels,S=r.minAutoLevel,E=p[e.level],L=l.total||Math.max(l.loaded,Math.round(h*E.maxBitrate/8)),A=u-m;A<1&&T&&(A=Math.min(u,8*l.loaded/v));var b=T?1e3*l.loaded/A:0,w=b?(L-l.loaded)/b:8*L/v+c/1e3;if(!(w<=g)){var D,I=b?8*b:v,_=Number.POSITIVE_INFINITY;for(D=e.level-1;D>S;D--){var C=p[D].maxBitrate;if((_=this.getTimeToLoadFrag(c/1e3,I,h*C,!p[D].details))<g)break}_>=w||_>10*h||(r.nextLoadLevel=D,T?this.bwEstimator.sample(u-Math.min(c,m),l.loaded):this.bwEstimator.sampleTTFB(u),this.clearTimer(),R.warn("[abr] Fragment "+e.sn+(t?" part "+t.index:"")+" of level "+e.level+` is loading too slowly;
      Time to underbuffer: `+g.toFixed(3)+` s
      Estimated load time for current fragment: `+w.toFixed(3)+` s
      Estimated load time for down switch fragment: `+_.toFixed(3)+` s
      TTFB estimate: `+m+`
      Current BW estimate: `+(F(v)?(v/1024).toFixed(3):"Unknown")+` Kb/s
      New BW estimate: `+(this.bwEstimator.getEstimate()/1024).toFixed(3)+` Kb/s
      Aborting and switching to level `+D),e.loader&&(this.fragCurrent=this.partCurrent=null,e.abortRequests()),r.trigger(y.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:t,stats:l}))}}}}}}},n.onFragLoaded=function(e,t){var r=t.frag,i=t.part,a=i?i.stats:r.stats;if(r.type===j&&this.bwEstimator.sampleTTFB(a.loading.first-a.loading.start),!this.ignoreFragment(r)){if(this.clearTimer(),this.lastLoadedFragLevel=r.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var o=i?i.duration:r.duration,l=this.hls.levels[r.level],h=(l.loaded?l.loaded.bytes:0)+a.loaded,u=(l.loaded?l.loaded.duration:0)+o;l.loaded={bytes:h,duration:u},l.realBitrate=Math.round(8*h/u)}if(r.bitrateTest){var d={stats:a,frag:r,part:i,id:r.type};this.onFragBuffered(y.FRAG_BUFFERED,d),r.bitrateTest=!1}}},n.onFragBuffered=function(e,t){var r=t.frag,i=t.part,a=i!=null&&i.stats.loaded?i.stats:r.stats;if(!a.aborted&&!this.ignoreFragment(r)){var o=a.parsing.end-a.loading.start-Math.min(a.loading.first-a.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,a.loaded),a.bwEstimate=this.bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}},n.ignoreFragment=function(e){return e.type!==j||e.sn==="initSegment"},n.clearTimer=function(){self.clearInterval(this.timer)},n.getNextABRAutoLevel=function(){var e=this.fragCurrent,t=this.partCurrent,r=this.hls,i=r.maxAutoLevel,a=r.config,o=r.minAutoLevel,l=r.media,h=t?t.duration:e?e.duration:0,u=l&&l.playbackRate!==0?Math.abs(l.playbackRate):1,d=this.bwEstimator?this.bwEstimator.getEstimate():a.abrEwmaDefaultEstimate,c=r.mainForwardBufferInfo,f=(c?c.len:0)/u,g=this.findBestLevel(d,o,i,f,a.abrBandWidthFactor,a.abrBandWidthUpFactor);if(g>=0)return g;R.trace("[abr] "+(f?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var m=h?Math.min(h,a.maxStarvationDelay):a.maxStarvationDelay,T=a.abrBandWidthFactor,v=a.abrBandWidthUpFactor;if(!f){var p=this.bitrateTestDelay;p&&(m=(h?Math.min(h,a.maxLoadingDelay):a.maxLoadingDelay)-p,R.trace("[abr] bitrate test took "+Math.round(1e3*p)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*m)+" ms"),T=v=1)}return g=this.findBestLevel(d,o,i,f+m,T,v),Math.max(g,0)},n.findBestLevel=function(e,t,r,i,a,o){for(var l,h=this.fragCurrent,u=this.partCurrent,d=this.lastLoadedFragLevel,c=this.hls.levels,f=c[d],g=!(f==null||(l=f.details)==null||!l.live),m=f==null?void 0:f.codecSet,T=u?u.duration:h?h.duration:0,v=this.bwEstimator.getEstimateTTFB()/1e3,p=t,S=-1,E=r;E>=t;E--){var L=c[E];if(!L||m&&L.codecSet!==m)L&&(p=Math.min(E,p),S=Math.max(E,S));else{S!==-1&&R.trace("[abr] Skipped level(s) "+p+"-"+S+' with CODECS:"'+c[S].attrs.CODECS+'"; not compatible with "'+f.attrs.CODECS+'"');var A=L.details,b=(u?A==null?void 0:A.partTarget:A==null?void 0:A.averagetargetduration)||T,w=void 0;w=E<=d?a*e:o*e;var D=c[E].maxBitrate,I=this.getTimeToLoadFrag(v,w,D*b,A===void 0);if(R.trace("[abr] level:"+E+" adjustedbw-bitrate:"+Math.round(w-D)+" avgDuration:"+b.toFixed(1)+" maxFetchDuration:"+i.toFixed(1)+" fetchDuration:"+I.toFixed(1)),w>D&&(I===0||!F(I)||g&&!this.bitrateTestDelay||I<i))return E}}return-1},ee(s,[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this.bwEstimator;if(e!==-1&&!t.canEstimate())return e;var r=this.getNextABRAutoLevel();if(e!==-1){var i=this.hls.levels;if(i.length>Math.max(e,r)&&i[e].loadError<=i[r].loadError)return e}return e!==-1&&(r=Math.min(e,r)),r},set:function(e){this._nextAutoLevel=e}}]),s}(),Cn=function(){function s(){this.chunks=[],this.dataLength=0}var n=s.prototype;return n.push=function(e){this.chunks.push(e),this.dataLength+=e.length},n.flush=function(){var e,t=this.chunks,r=this.dataLength;return t.length?(e=t.length===1?t[0]:function(i,a){for(var o=new Uint8Array(a),l=0,h=0;h<i.length;h++){var u=i[h];o.set(u,l),l+=u.length}return o}(t,r),this.reset(),e):new Uint8Array(0)},n.reset=function(){this.chunks.length=0,this.dataLength=0},s}(),Ls=function(s){function n(t,r,i){var a;return(a=s.call(this,t,r,i,"[audio-stream-controller]",Le)||this).videoBuffer=null,a.videoTrackCC=-1,a.waitingVideoCC=-1,a.bufferedTrack=null,a.switchingTrack=null,a.trackId=-1,a.waitingData=null,a.mainDetails=null,a.bufferFlushed=!1,a.cachedTrackLoadedData=null,a._registerListeners(),a}ae(n,s);var e=n.prototype;return e.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null},e._registerListeners=function(){var t=this.hls;t.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(y.MANIFEST_LOADING,this.onManifestLoading,this),t.on(y.LEVEL_LOADED,this.onLevelLoaded,this),t.on(y.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(y.ERROR,this.onError,this),t.on(y.BUFFER_RESET,this.onBufferReset,this),t.on(y.BUFFER_CREATED,this.onBufferCreated,this),t.on(y.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(y.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(y.FRAG_BUFFERED,this.onFragBuffered,this)},e._unregisterListeners=function(){var t=this.hls;t.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(y.MANIFEST_LOADING,this.onManifestLoading,this),t.off(y.LEVEL_LOADED,this.onLevelLoaded,this),t.off(y.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(y.ERROR,this.onError,this),t.off(y.BUFFER_RESET,this.onBufferReset,this),t.off(y.BUFFER_CREATED,this.onBufferCreated,this),t.off(y.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(y.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(y.FRAG_BUFFERED,this.onFragBuffered,this)},e.onInitPtsFound=function(t,r){var i=r.frag,a=r.id,o=r.initPTS,l=r.timescale;if(a==="main"){var h=i.cc;this.initPTS[i.cc]={baseTime:o,timescale:l},this.log("InitPTS for cc: "+h+" found from main: "+o),this.videoTrackCC=h,this.state===yt&&this.tick()}},e.startLoad=function(t){if(!this.levels)return this.startPosition=t,void(this.state=de);var r=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),r>0&&t===-1?(this.log("Override startPosition with lastCurrentTime @"+r.toFixed(3)),t=r,this.state=V):(this.loadedmetadata=!1,this.state=mt),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()},e.doTick=function(){switch(this.state){case V:this.doTickIdle();break;case mt:var t,r=this.levels,i=this.trackId,a=r==null||(t=r[i])==null?void 0:t.details;if(a){if(this.waitForCdnTuneIn(a))break;this.state=yt}break;case Je:var o,l=performance.now(),h=this.retryDate;(!h||l>=h||(o=this.media)!=null&&o.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=V);break;case yt:var u=this.waitingData;if(u){var d=u.frag,c=u.part,f=u.cache,g=u.complete;if(this.initPTS[d.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=$e;var m={frag:d,part:c,payload:f.flush(),networkDetails:null};this._handleFragmentLoadProgress(m),g&&s.prototype._handleFragmentLoadComplete.call(this,m)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+d.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var T=this.getLoadPosition(),v=Q.bufferInfo(this.mediaBuffer,T,this.config.maxBufferHole);Lr(v.end,this.config.maxFragLookUpTolerance,d)<0&&(this.log("Waiting fragment cc ("+d.cc+") @ "+d.start+" cancelled because another fragment at "+v.end+" is needed"),this.clearWaitingFragment())}}else this.state=V}this.onTickEnd()},e.clearWaitingFragment=function(){var t=this.waitingData;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=V)},e.resetLoadingState=function(){this.clearWaitingFragment(),s.prototype.resetLoadingState.call(this)},e.onTickEnd=function(){var t=this.media;t!=null&&t.readyState&&(this.lastCurrentTime=t.currentTime)},e.doTickIdle=function(){var t=this.hls,r=this.levels,i=this.media,a=this.trackId,o=t.config;if(r!=null&&r[a]&&(i||!this.startFragRequested&&o.startFragPrefetch)){var l=r[a],h=l.details;if(!h||h.live&&this.levelLastLoaded!==a||this.waitForCdnTuneIn(h))this.state=mt;else{var u=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&u&&(this.bufferFlushed=!1,this.afterBufferFlushed(u,se,Le));var d=this.getFwdBufferInfo(u,Le);if(d!==null){var c=this.bufferedTrack,f=this.switchingTrack;if(!f&&this._streamEnded(d,h))return t.trigger(y.BUFFER_EOS,{type:"audio"}),void(this.state=pt);var g=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,j),m=d.len,T=this.getMaxBufferLength(g==null?void 0:g.len);if(!(m>=T)||f){var v=h.fragments[0].start,p=d.end;if(f&&i){var S=this.getLoadPosition();c&&f.attrs!==c.attrs&&(p=S),h.PTSKnown&&S<v&&(d.end>v||d.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=v+.05)}var E=this.getNextFragment(p,h),L=!1;if(E&&this.isLoopLoading(E,p)&&(L=!!E.gap,E=this.getNextFragmentLoopLoading(E,h,d,j,T)),E){var A=g&&E.start>g.end+h.targetduration;if(A||(g==null||!g.len)&&d.len){var b=this.fragmentTracker.getBufferedFrag(E.start,j);if(b===null||(L||(L=!!b.gap||!!A&&g.len===0),A&&!L||L&&d.nextStart&&d.nextStart<b.end))return}this.loadFragment(E,l,p)}else this.bufferFlushed=!0}}}}},e.getMaxBufferLength=function(t){var r=s.prototype.getMaxBufferLength.call(this);return t?Math.min(Math.max(r,t),this.config.maxMaxBufferLength):r},e.onMediaDetaching=function(){this.videoBuffer=null,s.prototype.onMediaDetaching.call(this)},e.onAudioTracksUpdated=function(t,r){var i=r.audioTracks;this.resetTransmuxer(),this.levels=i.map(function(a){return new ft(a)})},e.onAudioTrackSwitching=function(t,r){var i=!!r.url;this.trackId=r.id;var a=this.fragCurrent;a&&(a.abortRequests(),this.removeUnbufferedFrags(a.start)),this.resetLoadingState(),i?this.setInterval(100):this.resetTransmuxer(),i?(this.switchingTrack=r,this.state=V):(this.switchingTrack=null,this.bufferedTrack=r,this.state=de),this.tick()},e.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1,this.bufferedTrack=null,this.switchingTrack=null},e.onLevelLoaded=function(t,r){this.mainDetails=r.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(y.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},e.onAudioTrackLoaded=function(t,r){var i;if(this.mainDetails!=null){var a=this.levels,o=r.details,l=r.id;if(a){this.log("Track "+l+" loaded ["+o.startSN+","+o.endSN+"],duration:"+o.totalduration);var h=a[l],u=0;if(o.live||(i=h.details)!=null&&i.live){var d=this.mainDetails;if(o.fragments[0]||(o.deltaUpdateFailed=!0),o.deltaUpdateFailed||!d)return;!h.details&&o.hasProgramDateTime&&d.hasProgramDateTime?(hn(o,d),u=o.fragments[0].start):u=this.alignPlaylists(o,h.details)}h.details=o,this.levelLastLoaded=l,this.startFragRequested||!this.mainDetails&&o.live||this.setStartPosition(h.details,u),this.state!==mt||this.waitForCdnTuneIn(o)||(this.state=V),this.tick()}else this.warn("Audio tracks were reset while loading level "+l)}else this.cachedTrackLoadedData=r},e._handleFragmentLoadProgress=function(t){var r,i=t.frag,a=t.part,o=t.payload,l=this.config,h=this.trackId,u=this.levels;if(u){var d=u[h];if(d){var c=d.details;if(!c)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(i.start);var f=l.defaultAudioCodec||d.audioCodec||"mp4a.40.2",g=this.transmuxer;g||(g=this.transmuxer=new wn(this.hls,Le,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var m=this.initPTS[i.cc],T=(r=i.initSegment)==null?void 0:r.data;if(m!==void 0){var v=a?a.index:-1,p=v!==-1,S=new Dr(i.level,i.sn,i.stats.chunkCount,o.byteLength,v,p);g.push(o,T,f,"",i,a,c.totalduration,!1,S,m)}else this.log("Unknown video PTS for cc "+i.cc+", waiting for video PTS before demuxing audio frag "+i.sn+" of ["+c.startSN+" ,"+c.endSN+"],track "+h),(this.waitingData=this.waitingData||{frag:i,part:a,cache:new Cn,complete:!1}).cache.push(new Uint8Array(o)),this.waitingVideoCC=this.videoTrackCC,this.state=yt}else this.warn("Audio track is undefined on fragment load progress")}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+i.sn+" of level "+i.level+" will not be buffered")},e._handleFragmentLoadComplete=function(t){this.waitingData?this.waitingData.complete=!0:s.prototype._handleFragmentLoadComplete.call(this,t)},e.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},e.onBufferCreated=function(t,r){var i=r.tracks.audio;i&&(this.mediaBuffer=i.buffer||null),r.tracks.video&&(this.videoBuffer=r.tracks.video.buffer||null)},e.onFragBuffered=function(t,r){var i,a=r.frag,o=r.part;if(a.type===Le)if(this.fragContextChanged(a))this.warn("Fragment "+a.sn+(o?" p: "+o.index:"")+" of level "+a.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+(this.switchingTrack?this.switchingTrack.name:"false"));else{if(a.sn!=="initSegment"){this.fragPrevious=a;var l=this.switchingTrack;l&&(this.bufferedTrack=l,this.switchingTrack=null,this.hls.trigger(y.AUDIO_TRACK_SWITCHED,ne({},l)))}this.fragBufferedComplete(a,o)}else this.loadedmetadata||a.type!==j||(i=this.videoBuffer||this.media)!=null&&i.buffered.length&&(this.loadedmetadata=!0)},e.onError=function(t,r){var i;if(r.fatal)this.state=Ze;else switch(r.details){case k.FRAG_GAP:case k.FRAG_PARSING_ERROR:case k.FRAG_DECRYPT_ERROR:case k.FRAG_LOAD_ERROR:case k.FRAG_LOAD_TIMEOUT:case k.KEY_LOAD_ERROR:case k.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Le,r);break;case k.AUDIO_TRACK_LOAD_ERROR:case k.AUDIO_TRACK_LOAD_TIMEOUT:case k.LEVEL_PARSING_ERROR:r.levelRetry||this.state!==mt||((i=r.context)==null?void 0:i.type)!==Se||(this.state=V);break;case k.BUFFER_FULL_ERROR:if(!r.parent||r.parent!=="audio")return;this.reduceLengthAndFlushBuffer(r)&&(this.bufferedTrack=null,s.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio"));break;case k.INTERNAL_EXCEPTION:this.recoverWorkerError(r)}},e.onBufferFlushed=function(t,r){r.type===se&&(this.bufferFlushed=!0,this.state===pt&&(this.state=V))},e._handleTransmuxComplete=function(t){var r,i="audio",a=this.hls,o=t.remuxResult,l=t.chunkMeta,h=this.getCurrentContext(l);if(h){var u=h.frag,d=h.part,c=h.level.details,f=o.audio,g=o.text,m=o.id3,T=o.initSegment;if(!this.fragContextChanged(u)&&c){if(this.state=De,this.switchingTrack&&f&&this.completeAudioSwitch(this.switchingTrack),T!=null&&T.tracks&&(this._bufferInitSegment(T.tracks,u,l),a.trigger(y.FRAG_PARSING_INIT_SEGMENT,{frag:u,id:i,tracks:T.tracks})),f){var v=f.startPTS,p=f.endPTS,S=f.startDTS,E=f.endDTS;d&&(d.elementaryStreams[se]={startPTS:v,endPTS:p,startDTS:S,endDTS:E}),u.setElementaryStreamInfo(se,v,p,S,E),this.bufferFragmentData(f,u,d,l)}if(m!=null&&(r=m.samples)!=null&&r.length){var L=$({id:i,frag:u,details:c},m);a.trigger(y.FRAG_PARSING_METADATA,L)}if(g){var A=$({id:i,frag:u,details:c},g);a.trigger(y.FRAG_PARSING_USERDATA,A)}}else this.fragmentTracker.removeFragment(u)}else this.resetWhenMissingContext(l)},e._bufferInitSegment=function(t,r,i){if(this.state===De){t.video&&delete t.video;var a=t.audio;if(a){a.levelCodec=a.codec,a.id="audio",this.log("Init audio buffer, container:"+a.container+", codecs[parsed]=["+a.codec+"]"),this.hls.trigger(y.BUFFER_CODECS,t);var o=a.initSegment;if(o!=null&&o.byteLength){var l={type:"audio",frag:r,part:null,chunkMeta:i,parent:r.type,data:o};this.hls.trigger(y.BUFFER_APPENDING,l)}this.tick()}}},e.loadFragment=function(t,r,i){var a,o=this.fragmentTracker.getState(t);this.fragCurrent=t,this.switchingTrack||o===Mt||o===Nt?t.sn==="initSegment"?this._loadInitSegment(t,r):(a=r.details)!=null&&a.live&&!this.initPTS[t.cc]?(this.log("Waiting for video PTS in continuity counter "+t.cc+" of live stream before loading audio fragment "+t.sn+" of level "+this.trackId),this.state=yt):(this.startFragRequested=!0,s.prototype.loadFragment.call(this,t,r,i)):this.clearTrackerIfNeeded(t)},e.completeAudioSwitch=function(t){var r=this.hls,i=this.media,a=this.bufferedTrack,o=a==null?void 0:a.attrs,l=t.attrs;i&&o&&(o.CHANNELS!==l.CHANNELS||o.NAME!==l.NAME||o.LANGUAGE!==l.LANGUAGE)&&(this.log("Switching audio track : flushing all audio"),s.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.bufferedTrack=t,this.switchingTrack=null,r.trigger(y.AUDIO_TRACK_SWITCHED,ne({},t))},n}(_r),Rs=function(s){function n(t){var r;return(r=s.call(this,t,"[audio-track-controller]")||this).tracks=[],r.groupId=null,r.tracksInGroup=[],r.trackId=-1,r.currentTrack=null,r.selectDefaultTrack=!0,r.registerListeners(),r}ae(n,s);var e=n.prototype;return e.registerListeners=function(){var t=this.hls;t.on(y.MANIFEST_LOADING,this.onManifestLoading,this),t.on(y.MANIFEST_PARSED,this.onManifestParsed,this),t.on(y.LEVEL_LOADING,this.onLevelLoading,this),t.on(y.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(y.ERROR,this.onError,this)},e.unregisterListeners=function(){var t=this.hls;t.off(y.MANIFEST_LOADING,this.onManifestLoading,this),t.off(y.MANIFEST_PARSED,this.onManifestParsed,this),t.off(y.LEVEL_LOADING,this.onLevelLoading,this),t.off(y.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(y.ERROR,this.onError,this)},e.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,s.prototype.destroy.call(this)},e.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0},e.onManifestParsed=function(t,r){this.tracks=r.audioTracks||[]},e.onAudioTrackLoaded=function(t,r){var i=r.id,a=r.groupId,o=r.details,l=this.tracksInGroup[i];if(l&&l.groupId===a){var h=l.details;l.details=r.details,this.log("audio-track "+i+' "'+l.name+'" lang:'+l.lang+" group:"+a+" loaded ["+o.startSN+"-"+o.endSN+"]"),i===this.trackId&&this.playlistLoaded(i,r,h)}else this.warn("Track with id:"+i+" and group:"+a+" not found in active group "+l.groupId)},e.onLevelLoading=function(t,r){this.switchLevel(r.level)},e.onLevelSwitching=function(t,r){this.switchLevel(r.level)},e.switchLevel=function(t){var r=this.hls.levels[t];if(r!=null&&r.audioGroupIds){var i=r.audioGroupIds[r.urlId];if(this.groupId!==i){this.groupId=i||null;var a=this.tracks.filter(function(l){return!i||l.groupId===i});this.selectDefaultTrack&&!a.some(function(l){return l.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=a;var o={audioTracks:a};this.log("Updating audio tracks, "+a.length+" track(s) found in group:"+i),this.hls.trigger(y.AUDIO_TRACKS_UPDATED,o),this.selectInitialTrack()}else this.shouldReloadPlaylist(this.currentTrack)&&this.setAudioTrack(this.trackId)}},e.onError=function(t,r){!r.fatal&&r.context&&r.context.type===Se&&r.context.id===this.trackId&&r.context.groupId===this.groupId&&(this.requestScheduled=-1,this.checkRetry(r))},e.setAudioTrack=function(t){var r=this.tracksInGroup;if(t<0||t>=r.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var i=this.currentTrack;r[this.trackId];var a=r[t],o=a.groupId,l=a.name;if(this.log("Switching to audio-track "+t+' "'+l+'" lang:'+a.lang+" group:"+o),this.trackId=t,this.currentTrack=a,this.selectDefaultTrack=!1,this.hls.trigger(y.AUDIO_TRACK_SWITCHING,ne({},a)),!a.details||a.details.live){var h=this.switchParams(a.url,i==null?void 0:i.details);this.loadPlaylist(h)}}},e.selectInitialTrack=function(){var t=this.tracksInGroup,r=this.findTrackId(this.currentTrack)|this.findTrackId(null);if(r!==-1)this.setAudioTrack(r);else{var i=new Error("No track found for running audio group-ID: "+this.groupId+" track count: "+t.length);this.warn(i.message),this.hls.trigger(y.ERROR,{type:N.MEDIA_ERROR,details:k.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:i})}},e.findTrackId=function(t){for(var r=this.tracksInGroup,i=0;i<r.length;i++){var a=r[i];if((!this.selectDefaultTrack||a.default)&&(!t||t.attrs["STABLE-RENDITION-ID"]===a.attrs["STABLE-RENDITION-ID"]||t.name===a.name&&t.lang===a.lang))return a.id}return-1},e.loadPlaylist=function(t){s.prototype.loadPlaylist.call(this);var r=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(r)){var i=r.id,a=r.groupId,o=r.url;if(t)try{o=t.addDirectives(o)}catch(l){this.warn("Could not construct new URL with HLS Delivery Directives: "+l)}this.log("loading audio-track playlist "+i+' "'+r.name+'" lang:'+r.lang+" group:"+a),this.clearTimer(),this.hls.trigger(y.AUDIO_TRACK_LOADING,{url:o,id:i,groupId:a,deliveryDirectives:t||null})}},ee(n,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1,this.setAudioTrack(t)}}]),n}(br);function _n(s,n){if(s.length!==n.length)return!1;for(var e=0;e<s.length;e++)if(!As(s[e].attrs,n[e].attrs))return!1;return!0}function As(s,n){var e=s["STABLE-RENDITION-ID"];return e?e===n["STABLE-RENDITION-ID"]:!["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED"].some(function(t){return s[t]!==n[t]})}var bs=function(s){function n(t,r,i){var a;return(a=s.call(this,t,r,i,"[subtitle-stream-controller]",xe)||this).levels=[],a.currentTrackId=-1,a.tracksBuffered=[],a.mainDetails=null,a._registerListeners(),a}ae(n,s);var e=n.prototype;return e.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},e._registerListeners=function(){var t=this.hls;t.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(y.MANIFEST_LOADING,this.onManifestLoading,this),t.on(y.LEVEL_LOADED,this.onLevelLoaded,this),t.on(y.ERROR,this.onError,this),t.on(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(y.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(y.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(y.FRAG_BUFFERED,this.onFragBuffered,this)},e._unregisterListeners=function(){var t=this.hls;t.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(y.MANIFEST_LOADING,this.onManifestLoading,this),t.off(y.LEVEL_LOADED,this.onLevelLoaded,this),t.off(y.ERROR,this.onError,this),t.off(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(y.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(y.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(y.FRAG_BUFFERED,this.onFragBuffered,this)},e.startLoad=function(t){this.stopLoad(),this.state=V,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()},e.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},e.onMediaDetaching=function(){this.tracksBuffered=[],s.prototype.onMediaDetaching.call(this)},e.onLevelLoaded=function(t,r){this.mainDetails=r.details},e.onSubtitleFragProcessed=function(t,r){var i=r.frag,a=r.success;if(this.fragPrevious=i,this.state=V,a){var o=this.tracksBuffered[this.currentTrackId];if(o){for(var l,h=i.start,u=0;u<o.length;u++)if(h>=o[u].start&&h<=o[u].end){l=o[u];break}var d=i.start+i.duration;l?l.end=d:(l={start:h,end:d},o.push(l)),this.fragmentTracker.fragBuffered(i)}}},e.onBufferFlushing=function(t,r){var i=r.startOffset,a=r.endOffset;if(i===0&&a!==Number.POSITIVE_INFINITY){var o=this.currentTrackId,l=this.levels;if(!l.length||!l[o]||!l[o].details)return;var h=a-l[o].details.targetduration;if(h<=0)return;r.endOffsetSubtitles=Math.max(0,h),this.tracksBuffered.forEach(function(u){for(var d=0;d<u.length;)if(u[d].end<=h)u.shift();else{if(!(u[d].start<h))break;u[d].start=h,d++}}),this.fragmentTracker.removeFragmentsInRange(i,h,xe)}},e.onFragBuffered=function(t,r){var i;this.loadedmetadata||r.frag.type!==j||(i=this.media)!=null&&i.buffered.length&&(this.loadedmetadata=!0)},e.onError=function(t,r){var i=r.frag;(i==null?void 0:i.type)===xe&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==de&&(this.state=V))},e.onSubtitleTracksUpdated=function(t,r){var i=this,a=r.subtitleTracks;_n(this.levels,a)?this.levels=a.map(function(o){return new ft(o)}):(this.tracksBuffered=[],this.levels=a.map(function(o){var l=new ft(o);return i.tracksBuffered[l.id]=[],l}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,xe),this.fragPrevious=null,this.mediaBuffer=null)},e.onSubtitleTrackSwitch=function(t,r){if(this.currentTrackId=r.id,this.levels.length&&this.currentTrackId!==-1){var i=this.levels[this.currentTrackId];i!=null&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.setInterval(500)}else this.clearInterval()},e.onSubtitleTrackLoaded=function(t,r){var i,a=r.details,o=r.id,l=this.currentTrackId,h=this.levels;if(h.length){var u=h[l];if(!(o>=h.length||o!==l)&&u){this.mediaBuffer=this.mediaBufferTimeRanges;var d=0;if(a.live||(i=u.details)!=null&&i.live){var c=this.mainDetails;if(a.deltaUpdateFailed||!c)return;var f=c.fragments[0];u.details?(d=this.alignPlaylists(a,u.details))===0&&f&&Er(a,d=f.start):a.hasProgramDateTime&&c.hasProgramDateTime?(hn(a,c),d=a.fragments[0].start):f&&Er(a,d=f.start)}u.details=a,this.levelLastLoaded=o,this.startFragRequested||!this.mainDetails&&a.live||this.setStartPosition(u.details,d),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===V&&(gt(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),u.details=void 0))}}},e._handleFragmentLoadComplete=function(t){var r=this,i=t.frag,a=t.payload,o=i.decryptdata,l=this.hls;if(!this.fragContextChanged(i)&&a&&a.byteLength>0&&o&&o.key&&o.iv&&o.method==="AES-128"){var h=performance.now();this.decrypter.decrypt(new Uint8Array(a),o.key.buffer,o.iv.buffer).catch(function(u){throw l.trigger(y.ERROR,{type:N.MEDIA_ERROR,details:k.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:i}),u}).then(function(u){var d=performance.now();l.trigger(y.FRAG_DECRYPTED,{frag:i,payload:u,stats:{tstart:h,tdecrypt:d}})}).catch(function(u){r.warn(u.name+": "+u.message),r.state=V})}},e.doTick=function(){if(this.media){if(this.state===V){var t=this.currentTrackId,r=this.levels,i=r[t];if(!r.length||!i||!i.details)return;var a=i.details,o=a.targetduration,l=this.config,h=this.getLoadPosition(),u=Q.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],h-o,l.maxBufferHole),d=u.end,c=u.len,f=this.getFwdBufferInfo(this.media,j);if(c>this.getMaxBufferLength(f==null?void 0:f.len)+o)return;var g=a.fragments,m=g.length,T=a.edge,v=null,p=this.fragPrevious;if(d<T){var S=l.maxFragLookUpTolerance;!(v=gt(p,g,Math.max(g[0].start,d),S))&&p&&p.start<g[0].start&&(v=g[0])}else v=g[m-1];if(!v)return;v=this.mapToInitFragWhenRequired(v),this.fragmentTracker.getState(v)===Mt&&this.loadFragment(v,i,d)}}else this.state=V},e.getMaxBufferLength=function(t){var r=s.prototype.getMaxBufferLength.call(this);return t?Math.max(r,t):r},e.loadFragment=function(t,r,i){this.fragCurrent=t,t.sn==="initSegment"?this._loadInitSegment(t,r):(this.startFragRequested=!0,s.prototype.loadFragment.call(this,t,r,i))},ee(n,[{key:"mediaBufferTimeRanges",get:function(){return new ks(this.tracksBuffered[this.currentTrackId]||[])}}]),n}(_r),ks=function(s){this.buffered=void 0;var n=function(e,t,r){if((t>>>=0)>r-1)throw new DOMException("Failed to execute '"+e+"' on 'TimeRanges': The index provided ("+t+") is greater than the maximum bound ("+r+")");return s[t][e]};this.buffered={get length(){return s.length},end:function(e){return n("end",e,s.length)},start:function(e){return n("start",e,s.length)}}},Ds=function(s){function n(t){var r;return(r=s.call(this,t,"[subtitle-track-controller]")||this).media=null,r.tracks=[],r.groupId=null,r.tracksInGroup=[],r.trackId=-1,r.selectDefaultTrack=!0,r.queuedDefaultTrack=-1,r.trackChangeListener=function(){return r.onTextTracksChanged()},r.asyncPollTrackChange=function(){return r.pollTrackChange(0)},r.useTextTrackPolling=!1,r.subtitlePollingInterval=-1,r._subtitleDisplay=!0,r.registerListeners(),r}ae(n,s);var e=n.prototype;return e.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,s.prototype.destroy.call(this)},e.registerListeners=function(){var t=this.hls;t.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(y.MANIFEST_LOADING,this.onManifestLoading,this),t.on(y.MANIFEST_PARSED,this.onManifestParsed,this),t.on(y.LEVEL_LOADING,this.onLevelLoading,this),t.on(y.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(y.ERROR,this.onError,this)},e.unregisterListeners=function(){var t=this.hls;t.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(y.MANIFEST_LOADING,this.onManifestLoading,this),t.off(y.MANIFEST_PARSED,this.onManifestParsed,this),t.off(y.LEVEL_LOADING,this.onLevelLoading,this),t.off(y.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(y.ERROR,this.onError,this)},e.onMediaAttached=function(t,r){this.media=r.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},e.pollTrackChange=function(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,t)},e.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),jr(this.media.textTracks).forEach(function(t){Xe(t)}),this.subtitleTrack=-1,this.media=null)},e.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},e.onManifestParsed=function(t,r){this.tracks=r.subtitleTracks},e.onSubtitleTrackLoaded=function(t,r){var i=r.id,a=r.details,o=this.trackId,l=this.tracksInGroup[o];if(l){var h=l.details;l.details=r.details,this.log("subtitle track "+i+" loaded ["+a.startSN+"-"+a.endSN+"]"),i===this.trackId&&this.playlistLoaded(i,r,h)}else this.warn("Invalid subtitle track id "+i)},e.onLevelLoading=function(t,r){this.switchLevel(r.level)},e.onLevelSwitching=function(t,r){this.switchLevel(r.level)},e.switchLevel=function(t){var r=this.hls.levels[t];if(r!=null&&r.textGroupIds){var i=r.textGroupIds[r.urlId],a=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;if(this.groupId!==i){var o=this.tracks.filter(function(u){return!i||u.groupId===i});this.tracksInGroup=o;var l=this.findTrackId(a==null?void 0:a.name)||this.findTrackId();this.groupId=i||null;var h={subtitleTracks:o};this.log("Updating subtitle tracks, "+o.length+' track(s) found in "'+i+'" group-id'),this.hls.trigger(y.SUBTITLE_TRACKS_UPDATED,h),l!==-1&&this.setSubtitleTrack(l,a)}else this.shouldReloadPlaylist(a)&&this.setSubtitleTrack(this.trackId,a)}},e.findTrackId=function(t){for(var r=this.tracksInGroup,i=0;i<r.length;i++){var a=r[i];if((!this.selectDefaultTrack||a.default)&&(!t||t===a.name))return a.id}return-1},e.onError=function(t,r){!r.fatal&&r.context&&r.context.type===be&&r.context.id===this.trackId&&r.context.groupId===this.groupId&&this.checkRetry(r)},e.loadPlaylist=function(t){s.prototype.loadPlaylist.call(this);var r=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(r)){var i=r.id,a=r.groupId,o=r.url;if(t)try{o=t.addDirectives(o)}catch(l){this.warn("Could not construct new URL with HLS Delivery Directives: "+l)}this.log("Loading subtitle playlist for id "+i),this.hls.trigger(y.SUBTITLE_TRACK_LOADING,{url:o,id:i,groupId:a,deliveryDirectives:t||null})}},e.toggleTrackModes=function(t){var r=this,i=this.media,a=this.trackId;if(i){var o=jr(i.textTracks),l=o.filter(function(d){return d.groupId===r.groupId});if(t===-1)[].slice.call(o).forEach(function(d){d.mode="disabled"});else{var h=l[a];h&&(h.mode="disabled")}var u=l[t];u&&(u.mode=this.subtitleDisplay?"showing":"hidden")}},e.setSubtitleTrack=function(t,r){var i,a=this.tracksInGroup;if(this.media){if(this.trackId!==t&&this.toggleTrackModes(t),!(this.trackId===t&&(t===-1||(i=a[t])!=null&&i.details)||t<-1||t>=a.length)){this.clearTimer();var o=a[t];if(this.log("Switching to subtitle-track "+t+(o?' "'+o.name+'" lang:'+o.lang+" group:"+o.groupId:"")),this.trackId=t,o){var l=o.id,h=o.groupId,u=h===void 0?"":h,d=o.name,c=o.type,f=o.url;this.hls.trigger(y.SUBTITLE_TRACK_SWITCH,{id:l,groupId:u,name:d,type:c,url:f});var g=this.switchParams(o.url,r==null?void 0:r.details);this.loadPlaylist(g)}else this.hls.trigger(y.SUBTITLE_TRACK_SWITCH,{id:t})}}else this.queuedDefaultTrack=t},e.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var t=-1,r=jr(this.media.textTracks),i=0;i<r.length;i++)if(r[i].mode==="hidden")t=i;else if(r[i].mode==="showing"){t=i;break}this.subtitleTrack!==t&&(this.subtitleTrack=t)}},ee(n,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(t){this._subtitleDisplay=t,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1;var r=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(t,r)}}]),n}(br);function jr(s){for(var n=[],e=0;e<s.length;e++){var t=s[e];t.kind!=="subtitles"&&t.kind!=="captions"||!t.label||n.push(s[e])}return n}var Is=function(){function s(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}var n=s.prototype;return n.append=function(e,t){var r=this.queues[t];r.push(e),r.length===1&&this.buffers[t]&&this.executeNext(t)},n.insertAbort=function(e,t){this.queues[t].unshift(e),this.executeNext(t)},n.appendBlocker=function(e){var t,r=new Promise(function(a){t=a}),i={execute:t,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(i,e),r},n.executeNext=function(e){var t=this.buffers,r=this.queues,i=t[e],a=r[e];if(a.length){var o=a[0];try{o.execute()}catch(l){R.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),o.onError(l),i!=null&&i.updating||(a.shift(),this.executeNext(e))}}},n.shiftAndExecuteNext=function(e){this.queues[e].shift(),this.executeNext(e)},n.current=function(e){return this.queues[e][0]},s}(),Pn=Pr(),xn=/([ha]vc.)(?:\.[^.,]+)+/,ws=function(){function s(e){var t=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var r=t.media,i=t.mediaSource;R.log("[buffer-controller]: Media source opened"),r&&(r.removeEventListener("emptied",t._onMediaEmptied),t.updateMediaElementDuration(),t.hls.trigger(y.MEDIA_ATTACHED,{media:r})),i&&i.removeEventListener("sourceopen",t._onMediaSourceOpen),t.checkPendingTracks()},this._onMediaSourceClose=function(){R.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){R.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=function(){var r=t.media,i=t._objectUrl;r&&r.src!==i&&R.error("Media element src was set while attaching MediaSource ("+i+" > "+r.src+")")},this.hls=e,this._initSourceBuffer(),this.registerListeners()}var n=s.prototype;return n.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},n.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null},n.registerListeners=function(){var e=this.hls;e.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.BUFFER_RESET,this.onBufferReset,this),e.on(y.BUFFER_APPENDING,this.onBufferAppending,this),e.on(y.BUFFER_CODECS,this.onBufferCodecs,this),e.on(y.BUFFER_EOS,this.onBufferEos,this),e.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(y.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(y.FRAG_PARSED,this.onFragParsed,this),e.on(y.FRAG_CHANGED,this.onFragChanged,this)},n.unregisterListeners=function(){var e=this.hls;e.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.BUFFER_RESET,this.onBufferReset,this),e.off(y.BUFFER_APPENDING,this.onBufferAppending,this),e.off(y.BUFFER_CODECS,this.onBufferCodecs,this),e.off(y.BUFFER_EOS,this.onBufferEos,this),e.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(y.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(y.FRAG_PARSED,this.onFragParsed,this),e.off(y.FRAG_CHANGED,this.onFragChanged,this)},n._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new Is(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null},n.onManifestParsed=function(e,t){var r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,this.details=null,R.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},n.onMediaAttaching=function(e,t){var r=this.media=t.media;if(r&&Pn){var i=this.mediaSource=new Pn;i.addEventListener("sourceopen",this._onMediaSourceOpen),i.addEventListener("sourceended",this._onMediaSourceEnded),i.addEventListener("sourceclose",this._onMediaSourceClose),r.src=self.URL.createObjectURL(i),this._objectUrl=r.src,r.addEventListener("emptied",this._onMediaEmptied)}},n.onMediaDetaching=function(){var e=this.media,t=this.mediaSource,r=this._objectUrl;if(t){if(R.log("[buffer-controller]: media source detaching"),t.readyState==="open")try{t.endOfStream()}catch(i){R.warn("[buffer-controller]: onMediaDetaching: "+i.message+" while calling endOfStream")}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(e.removeEventListener("emptied",this._onMediaEmptied),r&&self.URL.revokeObjectURL(r),e.src===r?(e.removeAttribute("src"),e.load()):R.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(y.MEDIA_DETACHED,void 0)},n.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach(function(t){var r=e.sourceBuffer[t];try{r&&(e.removeBufferListeners(t),e.mediaSource&&e.mediaSource.removeSourceBuffer(r),e.sourceBuffer[t]=void 0)}catch(i){R.warn("[buffer-controller]: Failed to reset the "+t+" buffer",i)}}),this._initSourceBuffer()},n.onBufferCodecs=function(e,t){var r=this,i=this.getSourceBufferTypes().length;Object.keys(t).forEach(function(a){if(i){var o=r.tracks[a];if(o&&typeof o.buffer.changeType=="function"){var l=t[a],h=l.id,u=l.codec,d=l.levelCodec,c=l.container,f=l.metadata,g=(o.levelCodec||o.codec).replace(xn,"$1"),m=(d||u).replace(xn,"$1");if(g!==m){var T=c+";codecs="+(d||u);r.appendChangeType(a,T),R.log("[buffer-controller]: switching codec "+g+" to "+m),r.tracks[a]={buffer:o.buffer,codec:u,container:c,levelCodec:d,metadata:f,id:h}}}}else r.pendingTracks[a]=t[a]}),i||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},n.appendChangeType=function(e,t){var r=this,i=this.operationQueue,a={execute:function(){var o=r.sourceBuffer[e];o&&(R.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+t),o.changeType(t)),i.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(o){R.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",o)}};i.append(a,e)},n.onBufferAppending=function(e,t){var r=this,i=this.hls,a=this.operationQueue,o=this.tracks,l=t.data,h=t.type,u=t.frag,d=t.part,c=t.chunkMeta,f=c.buffering[h],g=self.performance.now();f.start=g;var m=u.stats.buffering,T=d?d.stats.buffering:null;m.start===0&&(m.start=g),T&&T.start===0&&(T.start=g);var v=o.audio,p=!1;h==="audio"&&(v==null?void 0:v.container)==="audio/mpeg"&&(p=!this.lastMpegAudioChunk||c.id===1||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);var S=u.start,E={execute:function(){if(f.executeStart=self.performance.now(),p){var L=r.sourceBuffer[h];if(L){var A=S-L.timestampOffset;Math.abs(A)>=.1&&(R.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+S+" (delta: "+A+") sn: "+u.sn+")"),L.timestampOffset=S)}}r.appendExecutor(l,h)},onStart:function(){},onComplete:function(){var L=self.performance.now();f.executeEnd=f.end=L,m.first===0&&(m.first=L),T&&T.first===0&&(T.first=L);var A=r.sourceBuffer,b={};for(var w in A)b[w]=Q.getBuffered(A[w]);r.appendError=0,r.hls.trigger(y.BUFFER_APPENDED,{type:h,frag:u,part:d,chunkMeta:c,parent:u.type,timeRanges:b})},onError:function(L){R.error("[buffer-controller]: Error encountered while trying to append to the "+h+" SourceBuffer",L);var A={type:N.MEDIA_ERROR,parent:u.type,details:k.BUFFER_APPEND_ERROR,frag:u,part:d,chunkMeta:c,error:L,err:L,fatal:!1};L.code===DOMException.QUOTA_EXCEEDED_ERR?A.details=k.BUFFER_FULL_ERROR:(r.appendError++,A.details=k.BUFFER_APPEND_ERROR,r.appendError>i.config.appendErrorMaxRetry&&(R.error("[buffer-controller]: Failed "+i.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),A.fatal=!0)),i.trigger(y.ERROR,A)}};a.append(E,h)},n.onBufferFlushing=function(e,t){var r=this,i=this.operationQueue,a=function(o){return{execute:r.removeExecutor.bind(r,o,t.startOffset,t.endOffset),onStart:function(){},onComplete:function(){r.hls.trigger(y.BUFFER_FLUSHED,{type:o})},onError:function(l){R.warn("[buffer-controller]: Failed to remove from "+o+" SourceBuffer",l)}}};t.type?i.append(a(t.type),t.type):this.getSourceBufferTypes().forEach(function(o){i.append(a(o),o)})},n.onFragParsed=function(e,t){var r=this,i=t.frag,a=t.part,o=[],l=a?a.elementaryStreams:i.elementaryStreams;l[tr]?o.push("audiovideo"):(l[se]&&o.push("audio"),l[me]&&o.push("video")),o.length===0&&R.warn("Fragments must have at least one ElementaryStreamType set. type: "+i.type+" level: "+i.level+" sn: "+i.sn),this.blockBuffers(function(){var h=self.performance.now();i.stats.buffering.end=h,a&&(a.stats.buffering.end=h);var u=a?a.stats:i.stats;r.hls.trigger(y.FRAG_BUFFERED,{frag:i,part:a,stats:u,id:i.type})},o)},n.onFragChanged=function(e,t){this.flushBackBuffer()},n.onBufferEos=function(e,t){var r=this;this.getSourceBufferTypes().reduce(function(i,a){var o=r.sourceBuffer[a];return!o||t.type&&t.type!==a||(o.ending=!0,o.ended||(o.ended=!0,R.log("[buffer-controller]: "+a+" sourceBuffer now EOS"))),i&&!(o&&!o.ended)},!0)&&(R.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(function(){r.getSourceBufferTypes().forEach(function(a){var o=r.sourceBuffer[a];o&&(o.ending=!1)});var i=r.mediaSource;i&&i.readyState==="open"?(R.log("[buffer-controller]: Calling mediaSource.endOfStream()"),i.endOfStream()):i&&R.info("[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: "+i.readyState)}))},n.onLevelUpdated=function(e,t){var r=t.details;r.fragments.length&&(this.details=r,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},n.flushBackBuffer=function(){var e=this.hls,t=this.details,r=this.media,i=this.sourceBuffer;if(r&&t!==null){var a=this.getSourceBufferTypes();if(a.length){var o=t.live&&e.config.liveBackBufferLength!==null?e.config.liveBackBufferLength:e.config.backBufferLength;if(F(o)&&!(o<0)){var l=r.currentTime,h=t.levelTargetDuration,u=Math.max(o,h),d=Math.floor(l/h)*h-u;a.forEach(function(c){var f=i[c];if(f){var g=Q.getBuffered(f);if(g.length>0&&d>g.start(0)){if(e.trigger(y.BACK_BUFFER_REACHED,{bufferEnd:d}),t.live)e.trigger(y.LIVE_BACK_BUFFER_REACHED,{bufferEnd:d});else if(f.ended&&g.end(g.length-1)-l<2*h)return void R.info("[buffer-controller]: Cannot flush "+c+" back buffer while SourceBuffer is in ended state");e.trigger(y.BUFFER_FLUSHING,{startOffset:0,endOffset:d,type:c})}}})}}}},n.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&this.mediaSource.readyState==="open"){var e=this.details,t=this.hls,r=this.media,i=this.mediaSource,a=e.fragments[0].start+e.totalduration,o=r.duration,l=F(i.duration)?i.duration:0;e.live&&t.config.liveDurationInfinity?(R.log("[buffer-controller]: Media Source duration is set to Infinity"),i.duration=1/0,this.updateSeekableRange(e)):(a>l&&a>o||!F(o))&&(R.log("[buffer-controller]: Updating Media Source duration to "+a.toFixed(3)),i.duration=a)}},n.updateSeekableRange=function(e){var t=this.mediaSource,r=e.fragments;if(r.length&&e.live&&t!=null&&t.setLiveSeekableRange){var i=Math.max(0,r[0].start),a=Math.max(i,i+e.totalduration);t.setLiveSeekableRange(i,a)}},n.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.operationQueue,r=this.pendingTracks,i=Object.keys(r).length;if(i&&!e||i===2){this.createSourceBuffers(r),this.pendingTracks={};var a=this.getSourceBufferTypes();if(a.length)this.hls.trigger(y.BUFFER_CREATED,{tracks:this.tracks}),a.forEach(function(l){t.executeNext(l)});else{var o=new Error("could not create source buffer for media codec(s)");this.hls.trigger(y.ERROR,{type:N.MEDIA_ERROR,details:k.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:o,reason:o.message})}}},n.createSourceBuffers=function(e){var t=this.sourceBuffer,r=this.mediaSource;if(!r)throw Error("createSourceBuffers called when mediaSource was null");for(var i in e)if(!t[i]){var a=e[i];if(!a)throw Error("source buffer exists for track "+i+", however track does not");var o=a.levelCodec||a.codec,l=a.container+";codecs="+o;R.log("[buffer-controller]: creating sourceBuffer("+l+")");try{var h=t[i]=r.addSourceBuffer(l),u=i;this.addBufferListener(u,"updatestart",this._onSBUpdateStart),this.addBufferListener(u,"updateend",this._onSBUpdateEnd),this.addBufferListener(u,"error",this._onSBUpdateError),this.tracks[i]={buffer:h,codec:o,container:a.container,levelCodec:a.levelCodec,metadata:a.metadata,id:a.id}}catch(d){R.error("[buffer-controller]: error while trying to add sourceBuffer: "+d.message),this.hls.trigger(y.ERROR,{type:N.MEDIA_ERROR,details:k.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:d,mimeType:l})}}},n._onSBUpdateStart=function(e){this.operationQueue.current(e).onStart()},n._onSBUpdateEnd=function(e){var t=this.operationQueue;t.current(e).onComplete(),t.shiftAndExecuteNext(e)},n._onSBUpdateError=function(e,t){var r=new Error(e+" SourceBuffer error");R.error("[buffer-controller]: "+r,t),this.hls.trigger(y.ERROR,{type:N.MEDIA_ERROR,details:k.BUFFER_APPENDING_ERROR,error:r,fatal:!1});var i=this.operationQueue.current(e);i&&i.onError(t)},n.removeExecutor=function(e,t,r){var i=this.media,a=this.mediaSource,o=this.operationQueue,l=this.sourceBuffer[e];if(!i||!a||!l)return R.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),void o.shiftAndExecuteNext(e);var h=F(i.duration)?i.duration:1/0,u=F(a.duration)?a.duration:1/0,d=Math.max(0,t),c=Math.min(r,h,u);c>d&&!l.ending?(l.ended=!1,R.log("[buffer-controller]: Removing ["+d+","+c+"] from the "+e+" SourceBuffer"),l.remove(d,c)):o.shiftAndExecuteNext(e)},n.appendExecutor=function(e,t){var r=this.operationQueue,i=this.sourceBuffer[t];if(!i)return R.warn("[buffer-controller]: Attempting to append to the "+t+" SourceBuffer, but it does not exist"),void r.shiftAndExecuteNext(t);i.ended=!1,i.appendBuffer(e)},n.blockBuffers=function(e,t){var r=this;if(t===void 0&&(t=this.getSourceBufferTypes()),!t.length)return R.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(e);var i=this.operationQueue,a=t.map(function(o){return i.appendBlocker(o)});Promise.all(a).then(function(){e(),t.forEach(function(o){var l=r.sourceBuffer[o];l!=null&&l.updating||i.shiftAndExecuteNext(o)})})},n.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},n.addBufferListener=function(e,t,r){var i=this.sourceBuffer[e];if(i){var a=r.bind(this,e);this.listeners[e].push({event:t,listener:a}),i.addEventListener(t,a)}},n.removeBufferListeners=function(e){var t=this.sourceBuffer[e];t&&this.listeners[e].forEach(function(r){t.removeEventListener(r.event,r.listener)})},s}(),Fn={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},On=function(s){var n=s;return Fn.hasOwnProperty(s)&&(n=Fn[s]),String.fromCharCode(n)},Ye=15,we=100,Cs={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},_s={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Ps={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},xs={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Fs=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],Os=function(){function s(){this.time=null,this.verboseLevel=0}return s.prototype.log=function(n,e){if(this.verboseLevel>=n){var t=typeof e=="function"?e():e;R.log(this.time+" ["+n+"] "+t)}},s}(),We=function(s){for(var n=[],e=0;e<s.length;e++)n.push(s[e].toString(16));return n},Mn=function(){function s(e,t,r,i,a){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=r||!1,this.background=i||"black",this.flash=a||!1}var n=s.prototype;return n.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},n.setStyles=function(e){for(var t=["foreground","underline","italics","background","flash"],r=0;r<t.length;r++){var i=t[r];e.hasOwnProperty(i)&&(this[i]=e[i])}},n.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},n.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},n.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},n.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},s}(),Ms=function(){function s(e,t,r,i,a,o){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new Mn(t,r,i,a,o)}var n=s.prototype;return n.reset=function(){this.uchar=" ",this.penState.reset()},n.setChar=function(e,t){this.uchar=e,this.penState.copy(t)},n.setPenState=function(e){this.penState.copy(e)},n.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},n.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},n.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},s}(),Ns=function(){function s(e){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var t=0;t<we;t++)this.chars.push(new Ms);this.logger=e,this.pos=0,this.currPenState=new Mn}var n=s.prototype;return n.equals=function(e){for(var t=!0,r=0;r<we;r++)if(!this.chars[r].equals(e.chars[r])){t=!1;break}return t},n.copy=function(e){for(var t=0;t<we;t++)this.chars[t].copy(e.chars[t])},n.isEmpty=function(){for(var e=!0,t=0;t<we;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},n.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>we&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=we)},n.moveCursor=function(e){var t=this.pos+e;if(e>1)for(var r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)},n.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},n.insertChar=function(e){var t=this;e>=144&&this.backSpace();var r=On(e);this.pos>=we?this.logger.log(0,function(){return"Cannot insert "+e.toString(16)+" ("+r+") at position "+t.pos+". Skipping it!"}):(this.chars[this.pos].setChar(r,this.currPenState),this.moveCursor(1))},n.clearFromPos=function(e){var t;for(t=e;t<we;t++)this.chars[t].reset()},n.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},n.clearToEndOfRow=function(){this.clearFromPos(this.pos)},n.getTextString=function(){for(var e=[],t=!0,r=0;r<we;r++){var i=this.chars[r].uchar;i!==" "&&(t=!1),e.push(i)}return t?"":e.join("")},n.setPenStyles=function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},s}(),qr=function(){function s(e){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var t=0;t<Ye;t++)this.rows.push(new Ns(e));this.logger=e,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var n=s.prototype;return n.reset=function(){for(var e=0;e<Ye;e++)this.rows[e].clear();this.currRow=14},n.equals=function(e){for(var t=!0,r=0;r<Ye;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t},n.copy=function(e){for(var t=0;t<Ye;t++)this.rows[t].copy(e.rows[t])},n.isEmpty=function(){for(var e=!0,t=0;t<Ye;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},n.backSpace=function(){this.rows[this.currRow].backSpace()},n.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},n.insertChar=function(e){this.rows[this.currRow].insertChar(e)},n.setPen=function(e){this.rows[this.currRow].setPenStyles(e)},n.moveCursor=function(e){this.rows[this.currRow].moveCursor(e)},n.setCursor=function(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)},n.setPAC=function(e){this.logger.log(2,function(){return"pacData = "+JSON.stringify(e)});var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var r=0;r<Ye;r++)this.rows[r].clear();var i=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){var o=a.rows[i].cueStartTime,l=this.logger.time;if(o&&l!==null&&o<l)for(var h=0;h<this.nrRollUpRows;h++)this.rows[t-this.nrRollUpRows+h+1].copy(a.rows[i+h])}}this.currRow=t;var u=this.rows[this.currRow];if(e.indent!==null){var d=e.indent,c=Math.max(d-1,0);u.setCursor(e.indent),e.color=u.chars[c].penState.foreground}var f={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(f)},n.setBkgData=function(e){this.logger.log(2,function(){return"bkgData = "+JSON.stringify(e)}),this.backSpace(),this.setPen(e),this.insertChar(32)},n.setRollUpRows=function(e){this.nrRollUpRows=e},n.rollUp=function(){var e=this;if(this.nrRollUpRows!==null){this.logger.log(1,function(){return e.getDisplayText()});var t=this.currRow+1-this.nrRollUpRows,r=this.rows.splice(t,1)[0];r.clear(),this.rows.splice(this.currRow,0,r),this.logger.log(2,"Rolling up")}else this.logger.log(3,"roll_up but nrRollUpRows not set yet")},n.getDisplayText=function(e){e=e||!1;for(var t=[],r="",i=-1,a=0;a<Ye;a++){var o=this.rows[a].getTextString();o&&(i=a+1,e?t.push("Row "+i+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(r=e?"["+t.join(" | ")+"]":t.join(`
`)),r},n.getTextAndFormat=function(){return this.rows},s}(),Nn=function(){function s(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new qr(r),this.nonDisplayedMemory=new qr(r),this.lastOutputScreen=new qr(r),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}var n=s.prototype;return n.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},n.getHandler=function(){return this.outputFilter},n.setHandler=function(e){this.outputFilter=e},n.setPAC=function(e){this.writeScreen.setPAC(e)},n.setBkgData=function(e){this.writeScreen.setBkgData(e)},n.setMode=function(e){e!==this.mode&&(this.mode=e,this.logger.log(2,function(){return"MODE="+e}),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},n.insertChars=function(e){for(var t=this,r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,function(){return i+": "+t.writeScreen.getDisplayText(!0)}),this.mode!=="MODE_PAINT-ON"&&this.mode!=="MODE_ROLL-UP"||(this.logger.log(1,function(){return"DISPLAYED: "+t.displayedMemory.getDisplayText(!0)}),this.outputDataUpdate())},n.ccRCL=function(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},n.ccBS=function(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},n.ccAOF=function(){},n.ccAON=function(){},n.ccDER=function(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},n.ccRU=function(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},n.ccFON=function(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},n.ccRDC=function(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},n.ccTR=function(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")},n.ccRTD=function(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")},n.ccEDM=function(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},n.ccCR=function(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},n.ccENM=function(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},n.ccEOC=function(){var e=this;if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,function(){return"DISP: "+e.displayedMemory.getDisplayText()})}this.outputDataUpdate(!0)},n.ccTO=function(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},n.ccMIDROW=function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var r=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][r]}this.logger.log(2,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},n.outputDataUpdate=function(e){e===void 0&&(e=!1);var t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime!==null||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},n.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},s}(),Un=function(){function s(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var i=new Os;this.channels=[null,new Nn(e,t,i),new Nn(e+1,r,i)],this.cmdHistory={a:null,b:null},this.logger=i}var n=s.prototype;return n.getHandler=function(e){return this.channels[e].getHandler()},n.setHandler=function(e,t){this.channels[e].setHandler(t)},n.addData=function(e,t){var r,i,a,o=!1;this.logger.time=e;for(var l=0;l<t.length;l+=2)if(i=127&t[l],a=127&t[l+1],i!==0||a!==0){if(this.logger.log(3,"["+We([t[l],t[l+1]])+"] -> ("+We([i,a])+")"),(r=this.parseCmd(i,a))||(r=this.parseMidrow(i,a)),r||(r=this.parsePAC(i,a)),r||(r=this.parseBackgroundAttributes(i,a)),!r&&(o=this.parseChars(i,a))){var h=this.currentChannel;h&&h>0?this.channels[h].insertChars(o):this.logger.log(2,"No channel found yet. TEXT-MODE?")}r||o||this.logger.log(2,"Couldn't parse cleaned data "+We([i,a])+" orig: "+We([t[l],t[l+1]]))}},n.parseCmd=function(e,t){var r=this.cmdHistory;if(!((e===20||e===28||e===21||e===29)&&t>=32&&t<=47||(e===23||e===31)&&t>=33&&t<=35))return!1;if(Bn(e,t,r))return it(null,null,r),this.logger.log(3,"Repeated command ("+We([e,t])+") is dropped"),!0;var i=e===20||e===21||e===23?1:2,a=this.channels[i];return e===20||e===21||e===28||e===29?t===32?a.ccRCL():t===33?a.ccBS():t===34?a.ccAOF():t===35?a.ccAON():t===36?a.ccDER():t===37?a.ccRU(2):t===38?a.ccRU(3):t===39?a.ccRU(4):t===40?a.ccFON():t===41?a.ccRDC():t===42?a.ccTR():t===43?a.ccRTD():t===44?a.ccEDM():t===45?a.ccCR():t===46?a.ccENM():t===47&&a.ccEOC():a.ccTO(t-32),it(e,t,r),this.currentChannel=i,!0},n.parseMidrow=function(e,t){var r=0;if((e===17||e===25)&&t>=32&&t<=47){if((r=e===17?1:2)!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;var i=this.channels[r];return!!i&&(i.ccMIDROW(t),this.logger.log(3,"MIDROW ("+We([e,t])+")"),!0)}return!1},n.parsePAC=function(e,t){var r,i=this.cmdHistory;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127||(e===16||e===24)&&t>=64&&t<=95))return!1;if(Bn(e,t,i))return it(null,null,i),!0;var a=e<=23?1:2;r=t>=64&&t<=95?a===1?Cs[e]:Ps[e]:a===1?_s[e]:xs[e];var o=this.channels[a];return!!o&&(o.setPAC(this.interpretPAC(r,t)),it(e,t,i),this.currentChannel=a,!0)},n.interpretPAC=function(e,t){var r,i={color:null,italics:!1,indent:null,underline:!1,row:e};return r=t>95?t-96:t-64,i.underline=(1&r)==1,r<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((r-16)/2),i},n.parseChars=function(e,t){var r,i,a=null,o=null;if(e>=25?(r=2,o=e-8):(r=1,o=e),o>=17&&o<=19?(i=o===17?t+80:o===18?t+112:t+144,this.logger.log(2,"Special char '"+On(i)+"' in channel "+r),a=[i]):e>=32&&e<=127&&(a=t===0?[e]:[e,t]),a){var l=We(a);this.logger.log(3,"Char codes =  "+l.join(",")),it(e,t,this.cmdHistory)}return a},n.parseBackgroundAttributes=function(e,t){var r;if(!((e===16||e===24)&&t>=32&&t<=47||(e===23||e===31)&&t>=45&&t<=47))return!1;var i={};e===16||e===24?(r=Math.floor((t-32)/2),i.background=Fs[r],t%2==1&&(i.background=i.background+"_semi")):t===45?i.background="transparent":(i.foreground="black",t===47&&(i.underline=!0));var a=e<=23?1:2;return this.channels[a].setBkgData(i),it(e,t,this.cmdHistory),!0},n.reset=function(){for(var e=0;e<Object.keys(this.channels).length;e++){var t=this.channels[e];t&&t.reset()}this.cmdHistory={a:null,b:null}},n.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++){var r=this.channels[t];r&&r.cueSplitAtTime(e)}},s}();function it(s,n,e){e.a=s,e.b=n}function Bn(s,n,e){return e.a===s&&e.b===n}var Yt=function(){function s(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}var n=s.prototype;return n.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},n.newCue=function(e,t,r){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)},n.reset=function(){this.cueRanges=[],this.startTime=null},s}(),zr=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var s=["","lr","rl"],n=["start","middle","end","left","right"];function e(a,o){if(typeof o!="string"||!Array.isArray(a))return!1;var l=o.toLowerCase();return!!~a.indexOf(l)&&l}function t(a){return e(n,a)}function r(a){for(var o=arguments.length,l=new Array(o>1?o-1:0),h=1;h<o;h++)l[h-1]=arguments[h];for(var u=1;u<arguments.length;u++){var d=arguments[u];for(var c in d)a[c]=d[c]}return a}function i(a,o,l){var h=this,u={enumerable:!0};h.hasBeenReset=!1;var d="",c=!1,f=a,g=o,m=l,T=null,v="",p=!0,S="auto",E="start",L=50,A="middle",b=50,w="middle";Object.defineProperty(h,"id",r({},u,{get:function(){return d},set:function(D){d=""+D}})),Object.defineProperty(h,"pauseOnExit",r({},u,{get:function(){return c},set:function(D){c=!!D}})),Object.defineProperty(h,"startTime",r({},u,{get:function(){return f},set:function(D){if(typeof D!="number")throw new TypeError("Start time must be set to a number.");f=D,this.hasBeenReset=!0}})),Object.defineProperty(h,"endTime",r({},u,{get:function(){return g},set:function(D){if(typeof D!="number")throw new TypeError("End time must be set to a number.");g=D,this.hasBeenReset=!0}})),Object.defineProperty(h,"text",r({},u,{get:function(){return m},set:function(D){m=""+D,this.hasBeenReset=!0}})),Object.defineProperty(h,"region",r({},u,{get:function(){return T},set:function(D){T=D,this.hasBeenReset=!0}})),Object.defineProperty(h,"vertical",r({},u,{get:function(){return v},set:function(D){var I=function(_){return e(s,_)}(D);if(I===!1)throw new SyntaxError("An invalid or illegal string was specified.");v=I,this.hasBeenReset=!0}})),Object.defineProperty(h,"snapToLines",r({},u,{get:function(){return p},set:function(D){p=!!D,this.hasBeenReset=!0}})),Object.defineProperty(h,"line",r({},u,{get:function(){return S},set:function(D){if(typeof D!="number"&&D!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");S=D,this.hasBeenReset=!0}})),Object.defineProperty(h,"lineAlign",r({},u,{get:function(){return E},set:function(D){var I=t(D);if(!I)throw new SyntaxError("An invalid or illegal string was specified.");E=I,this.hasBeenReset=!0}})),Object.defineProperty(h,"position",r({},u,{get:function(){return L},set:function(D){if(D<0||D>100)throw new Error("Position must be between 0 and 100.");L=D,this.hasBeenReset=!0}})),Object.defineProperty(h,"positionAlign",r({},u,{get:function(){return A},set:function(D){var I=t(D);if(!I)throw new SyntaxError("An invalid or illegal string was specified.");A=I,this.hasBeenReset=!0}})),Object.defineProperty(h,"size",r({},u,{get:function(){return b},set:function(D){if(D<0||D>100)throw new Error("Size must be between 0 and 100.");b=D,this.hasBeenReset=!0}})),Object.defineProperty(h,"align",r({},u,{get:function(){return w},set:function(D){var I=t(D);if(!I)throw new SyntaxError("An invalid or illegal string was specified.");w=I,this.hasBeenReset=!0}})),h.displayState=void 0}return i.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},i}(),Us=function(){function s(){}return s.prototype.decode=function(n,e){if(!n)return"";if(typeof n!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(n))},s}();function Gn(s){function n(t,r,i,a){return 3600*(0|t)+60*(0|r)+(0|i)+parseFloat(a||0)}var e=s.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return e?parseFloat(e[2])>59?n(e[2],e[3],0,e[4]):n(e[1],e[2],e[3],e[4]):null}var Bs=function(){function s(){this.values=Object.create(null)}var n=s.prototype;return n.set=function(e,t){this.get(e)||t===""||(this.values[e]=t)},n.get=function(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t},n.has=function(e){return e in this.values},n.alt=function(e,t,r){for(var i=0;i<r.length;++i)if(t===r[i]){this.set(e,t);break}},n.integer=function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},n.percent=function(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){var r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1},s}();function Kn(s,n,e,t){var r=t?s.split(t):[s];for(var i in r)if(typeof r[i]=="string"){var a=r[i].split(e);a.length===2&&n(a[0],a[1])}}var Xr=new zr(0,0,""),Wt=Xr.align==="middle"?"middle":"center";function Gs(s,n,e){var t=s;function r(){var a=Gn(s);if(a===null)throw new Error("Malformed timestamp: "+t);return s=s.replace(/^[^\sa-zA-Z-]+/,""),a}function i(){s=s.replace(/^\s+/,"")}if(i(),n.startTime=r(),i(),s.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+t);s=s.slice(3),i(),n.endTime=r(),i(),function(a,o){var l=new Bs;Kn(a,function(d,c){var f;switch(d){case"region":for(var g=e.length-1;g>=0;g--)if(e[g].id===c){l.set(d,e[g].region);break}break;case"vertical":l.alt(d,c,["rl","lr"]);break;case"line":f=c.split(","),l.integer(d,f[0]),l.percent(d,f[0])&&l.set("snapToLines",!1),l.alt(d,f[0],["auto"]),f.length===2&&l.alt("lineAlign",f[1],["start",Wt,"end"]);break;case"position":f=c.split(","),l.percent(d,f[0]),f.length===2&&l.alt("positionAlign",f[1],["start",Wt,"end","line-left","line-right","auto"]);break;case"size":l.percent(d,c);break;case"align":l.alt(d,c,["start",Wt,"end","left","right"])}},/:/,/\s/),o.region=l.get("region",null),o.vertical=l.get("vertical","");var h=l.get("line","auto");h==="auto"&&Xr.line===-1&&(h=-1),o.line=h,o.lineAlign=l.get("lineAlign","start"),o.snapToLines=l.get("snapToLines",!0),o.size=l.get("size",100),o.align=l.get("align",Wt);var u=l.get("position","auto");u==="auto"&&Xr.position===50&&(u=o.align==="start"||o.align==="left"?0:o.align==="end"||o.align==="right"?100:50),o.position=u}(s,n)}function Hn(s){return s.replace(/<br(?: \/)?>/gi,`
`)}var Ks=function(){function s(){this.state="INITIAL",this.buffer="",this.decoder=new Us,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var n=s.prototype;return n.parse=function(e){var t=this;function r(){var h=t.buffer,u=0;for(h=Hn(h);u<h.length&&h[u]!=="\r"&&h[u]!==`
`;)++u;var d=h.slice(0,u);return h[u]==="\r"&&++u,h[u]===`
`&&++u,t.buffer=h.slice(u),d}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var i="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;var a=(i=r()).match(/^()?WEBVTT([ \t].*)?$/);if(a==null||!a[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var o=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:i=r(),t.state){case"HEADER":/:/.test(i)?Kn(i,function(h,u){},/:/):i||(t.state="ID");continue;case"NOTE":i||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){t.state="NOTE";break}if(!i)continue;if(t.cue=new zr(0,0,""),t.state="CUE",i.indexOf("-->")===-1){t.cue.id=i;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{Gs(i,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var l=i.indexOf("-->")!==-1;if(!i||l&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=i;continue;case"BADCUE":i||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},n.flush=function(){var e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this},s}(),Hs=/\r\n|\n\r|\n|\r/g,Qr=function(s,n,e){return e===void 0&&(e=0),s.slice(e,e+n.length)===n},$r=function(s){for(var n=5381,e=s.length;e;)n=33*n^s.charCodeAt(--e);return(n>>>0).toString()};function Jr(s,n,e){return $r(s.toString())+$r(n.toString())+$r(e)}function Vs(s,n,e,t,r,i,a){var o,l,h,u=new Ks,d=Te(new Uint8Array(s)).trim().replace(Hs,`
`).split(`
`),c=[],f=(o=n.baseTime,(l=n.timescale)===void 0&&(l=1),Nr(o,9e4,1/l)),g="00:00.000",m=0,T=0,v=!0;u.oncue=function(p){var S=e[t],E=e.ccOffset,L=(m-f)/9e4;S!=null&&S.new&&(T!==void 0?E=e.ccOffset=S.start:function(D,I,_){var C=D[I],x=D[C.prevCC];if(!x||!x.new&&C.new)return D.ccOffset=D.presentationOffset=C.start,void(C.new=!1);for(;(B=x)!=null&&B.new;){var B;D.ccOffset+=C.start-x.start,C.new=!1,x=D[(C=x).prevCC]}D.presentationOffset=_}(e,t,L)),L&&(E=L-e.presentationOffset);var A=p.endTime-p.startTime,b=ce(9e4*(p.startTime+E-T),9e4*r)/9e4;p.startTime=Math.max(b,0),p.endTime=Math.max(b+A,0);var w=p.text.trim();p.text=decodeURIComponent(encodeURIComponent(w)),p.id||(p.id=Jr(p.startTime,p.endTime,w)),p.endTime>0&&c.push(p)},u.onparsingerror=function(p){h=p},u.onflush=function(){h?a(h):i(c)},d.forEach(function(p){if(v){if(Qr(p,"X-TIMESTAMP-MAP=")){v=!1,p.slice(16).split(",").forEach(function(S){Qr(S,"LOCAL:")?g=S.slice(6):Qr(S,"MPEGTS:")&&(m=parseInt(S.slice(7)))});try{T=function(S){var E=parseInt(S.slice(-3)),L=parseInt(S.slice(-6,-4)),A=parseInt(S.slice(-9,-7)),b=S.length>9?parseInt(S.substring(0,S.indexOf(":"))):0;if(!(F(E)&&F(L)&&F(A)&&F(b)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+S);return E+=1e3*L,(E+=6e4*A)+36e5*b}(g)/1e3}catch(S){h=S}return}p===""&&(v=!1)}u.parse(p+`
`)}),u.flush()}var Zr="stpp.ttml.im1t",Vn=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Yn=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,Ys={left:"start",center:"center",right:"end",start:"start",end:"end"};function Wn(s,n,e,t){var r=W(new Uint8Array(s),["mdat"]);if(r.length!==0){var i,a,o,l,h=r.map(function(d){return Te(d)}),u=(i=n.baseTime,a=1,(o=n.timescale)===void 0&&(o=1),l===void 0&&(l=!1),Nr(i,a,1/o,l));try{h.forEach(function(d){return e(function(c,f){var g=new DOMParser().parseFromString(c,"text/xml").getElementsByTagName("tt")[0];if(!g)throw new Error("Invalid ttml");var m={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},T=Object.keys(m).reduce(function(L,A){return L[A]=g.getAttribute("ttp:"+A)||m[A],L},{}),v=g.getAttribute("xml:space")!=="preserve",p=jn(ei(g,"styling","style")),S=jn(ei(g,"layout","region")),E=ei(g,"body","[begin]");return[].map.call(E,function(L){var A=qn(L,v);if(!A||!L.hasAttribute("begin"))return null;var b=ri(L.getAttribute("begin"),T),w=ri(L.getAttribute("dur"),T),D=ri(L.getAttribute("end"),T);if(b===null)throw zn(L);if(D===null){if(w===null)throw zn(L);D=b+w}var I=new zr(b-f,D-f,A);I.id=Jr(I.startTime,I.endTime,I.text);var _=function(B,P,O){var U="http://www.w3.org/ns/ttml#styling",M=null,K=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],H=B!=null&&B.hasAttribute("style")?B.getAttribute("style"):null;return H&&O.hasOwnProperty(H)&&(M=O[H]),K.reduce(function(Y,q){var le=ti(P,U,q)||ti(B,U,q)||ti(M,U,q);return le&&(Y[q]=le),Y},{})}(S[L.getAttribute("region")],p[L.getAttribute("style")],p),C=_.textAlign;if(C){var x=Ys[C];x&&(I.lineAlign=x),I.align=C}return $(I,_),I}).filter(function(L){return L!==null})}(d,u))})}catch(d){t(d)}}else t(new Error("Could not parse IMSC1 mdat"))}function ei(s,n,e){var t=s.getElementsByTagName(n)[0];return t?[].slice.call(t.querySelectorAll(e)):[]}function jn(s){return s.reduce(function(n,e){var t=e.getAttribute("xml:id");return t&&(n[t]=e),n},{})}function qn(s,n){return[].slice.call(s.childNodes).reduce(function(e,t,r){var i;return t.nodeName==="br"&&r?e+`
`:(i=t.childNodes)!=null&&i.length?qn(t,n):n?e+t.textContent.trim().replace(/\s+/g," "):e+t.textContent},"")}function ti(s,n,e){return s&&s.hasAttributeNS(n,e)?s.getAttributeNS(n,e):null}function zn(s){return new Error("Could not parse ttml timestamp "+s)}function ri(s,n){if(!s)return null;var e=Gn(s);return e===null&&(Vn.test(s)?e=function(t,r){var i=Vn.exec(t),a=(0|i[4])+(0|i[5])/r.subFrameRate;return 3600*(0|i[1])+60*(0|i[2])+(0|i[3])+a/r.frameRate}(s,n):Yn.test(s)&&(e=function(t,r){var i=Yn.exec(t),a=Number(i[1]);switch(i[2]){case"h":return 3600*a;case"m":return 60*a;case"ms":return 1e3*a;case"f":return a/r.frameRate;case"t":return a/r.tickRate}return a}(s,n))),e}var Ws=function(){function s(e){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var t=new Yt(this,"textTrack1"),r=new Yt(this,"textTrack2"),i=new Yt(this,"textTrack3"),a=new Yt(this,"textTrack4");this.cea608Parser1=new Un(1,t,r),this.cea608Parser2=new Un(3,i,a)}e.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(y.FRAG_LOADING,this.onFragLoading,this),e.on(y.FRAG_LOADED,this.onFragLoaded,this),e.on(y.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(y.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(y.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(y.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this)}var n=s.prototype;return n.destroy=function(){var e=this.hls;e.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(y.FRAG_LOADING,this.onFragLoading,this),e.off(y.FRAG_LOADED,this.onFragLoaded,this),e.off(y.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(y.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(y.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(y.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},n.addCues=function(e,t,r,i,a){for(var o,l,h,u,d=!1,c=a.length;c--;){var f=a[c],g=(o=f[0],l=f[1],h=t,u=r,Math.min(l,u)-Math.max(o,h));if(g>=0&&(f[0]=Math.min(f[0],t),f[1]=Math.max(f[1],r),d=!0,g/(r-t)>.5))return}if(d||a.push([t,r]),this.config.renderTextTracksNatively){var m=this.captionsTracks[e];this.Cues.newCue(m,t,r,i)}else{var T=this.Cues.newCue(null,t,r,i);this.hls.trigger(y.CUES_PARSED,{type:"captions",cues:T,track:e})}},n.onInitPtsFound=function(e,t){var r=this,i=t.frag,a=t.id,o=t.initPTS,l=t.timescale,h=this.unparsedVttFrags;a==="main"&&(this.initPTS[i.cc]={baseTime:o,timescale:l}),h.length&&(this.unparsedVttFrags=[],h.forEach(function(u){r.onFragLoaded(y.FRAG_LOADED,u)}))},n.getExistingTrack=function(e){var t=this.media;if(t)for(var r=0;r<t.textTracks.length;r++){var i=t.textTracks[r];if(i[e])return i}return null},n.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},n.createNativeTrack=function(e){if(!this.captionsTracks[e]){var t=this.captionsProperties,r=this.captionsTracks,i=this.media,a=t[e],o=a.label,l=a.languageCode,h=this.getExistingTrack(e);if(h)r[e]=h,Xe(r[e]),Wi(r[e],i);else{var u=this.createTextTrack("captions",o,l);u&&(u[e]=!0,r[e]=u)}}},n.createNonNativeTrack=function(e){if(!this.nonNativeCaptionsTracks[e]){var t=this.captionsProperties[e];if(t){var r={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(y.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}}},n.createTextTrack=function(e,t,r){var i=this.media;if(i)return i.addTextTrack(e,t,r)},n.onMediaAttaching=function(e,t){this.media=t.media,this._cleanTracks()},n.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach(function(t){Xe(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}},n.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},n._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var r=0;r<t.length;r++)Xe(t[r])}},n.onSubtitleTracksUpdated=function(e,t){var r=this,i=t.subtitleTracks||[],a=i.some(function(h){return h.textCodec===Zr});if(this.config.enableWebVTT||a&&this.config.enableIMSC1){if(_n(this.tracks,i))return void(this.tracks=i);if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){var o=this.media?this.media.textTracks:null;this.tracks.forEach(function(h,u){var d;if(o&&u<o.length){for(var c=null,f=0;f<o.length;f++)if(js(o[f],h)){c=o[f];break}c&&(d=c)}if(d)Xe(d);else{var g=r._captionsOrSubtitlesFromCharacteristics(h);(d=r.createTextTrack(g,h.name,h.lang))&&(d.mode="disabled")}d&&(d.groupId=h.groupId,r.textTracks.push(d))})}else if(this.tracks.length){var l=this.tracks.map(function(h){return{label:h.name,kind:h.type.toLowerCase(),default:h.default,subtitleTrack:h}});this.hls.trigger(y.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:l})}}},n._captionsOrSubtitlesFromCharacteristics=function(e){if(e.attrs.CHARACTERISTICS){var t=/transcribes-spoken-dialog/gi.test(e.attrs.CHARACTERISTICS),r=/describes-music-and-sound/gi.test(e.attrs.CHARACTERISTICS);if(t&&r)return"captions"}return"subtitles"},n.onManifestLoaded=function(e,t){var r=this;this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(function(i){var a=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(a){var o="textTrack"+a[1],l=r.captionsProperties[o];l&&(l.label=i.name,i.lang&&(l.languageCode=i.lang),l.media=i)}})},n.closedCaptionsForLevel=function(e){var t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]},n.onFragLoading=function(e,t){var r=this.cea608Parser1,i=this.cea608Parser2,a=this.lastSn,o=this.lastPartIndex;if(this.enabled&&r&&i&&t.frag.type===j){var l,h,u=t.frag.sn,d=(l=t==null||(h=t.part)==null?void 0:h.index)!=null?l:-1;u===a+1||u===a&&d===o+1||(r.reset(),i.reset()),this.lastSn=u,this.lastPartIndex=d}},n.onFragLoaded=function(e,t){var r=t.frag,i=t.payload,a=this.initPTS,o=this.unparsedVttFrags;if(r.type===xe)if(i.byteLength){if(!a[r.cc])return o.push(t),void(a.length&&this.hls.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Missing initial subtitle PTS")}));var l=r.decryptdata,h="stats"in t;if(l==null||!l.encrypted||h){var u=this.tracks[r.level],d=this.vttCCs;d[r.cc]||(d[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),u&&u.textCodec===Zr?this._parseIMSC1(r,i):this._parseVTTs(r,i,d)}}else this.hls.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})},n._parseIMSC1=function(e,t){var r=this,i=this.hls;Wn(t,this.initPTS[e.cc],function(a){r._appendCues(a,e.level),i.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(a){R.log("Failed to parse IMSC1: "+a),i.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:a})})},n._parseVTTs=function(e,t,r){var i,a=this,o=this.hls;Vs((i=e.initSegment)!=null&&i.data?Ge(e.initSegment.data,new Uint8Array(t)):t,this.initPTS[e.cc],r,e.cc,e.start,function(l){a._appendCues(l,e.level),o.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(l){a._fallbackToIMSC1(e,t),R.log("Failed to parse VTT cue: "+l),o.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:l})})},n._fallbackToIMSC1=function(e,t){var r=this,i=this.tracks[e.level];i.textCodec||Wn(t,this.initPTS[e.cc],function(){i.textCodec=Zr,r._parseIMSC1(e,t)},function(){i.textCodec="wvtt"})},n._appendCues=function(e,t){var r=this.hls;if(this.config.renderTextTracksNatively){var i=this.textTracks[t];if(!i||i.mode==="disabled")return;e.forEach(function(l){return ji(i,l)})}else{var a=this.tracks[t];if(!a)return;var o=a.default?"default":"subtitles"+t;r.trigger(y.CUES_PARSED,{type:"subtitles",cues:e,track:o})}},n.onFragDecrypted=function(e,t){var r=t.frag;if(r.type===xe){if(!this.initPTS[r.cc])return void this.unparsedVttFrags.push(t);this.onFragLoaded(y.FRAG_LOADED,t)}},n.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},n.onFragParsingUserdata=function(e,t){var r=this.cea608Parser1,i=this.cea608Parser2;if(this.enabled&&r&&i){var a=t.frag,o=t.samples;if(a.type!==j||this.closedCaptionsForLevel(a)!=="NONE")for(var l=0;l<o.length;l++){var h=o[l].bytes;if(h){var u=this.extractCea608Data(h);r.addData(o[l].pts,u[0]),i.addData(o[l].pts,u[1])}}}},n.onBufferFlushing=function(e,t){var r=t.startOffset,i=t.endOffset,a=t.endOffsetSubtitles,o=t.type,l=this.media;if(l&&!(l.currentTime<i)){if(!o||o==="video"){var h=this.captionsTracks;Object.keys(h).forEach(function(d){return gr(h[d],r,i)})}if(this.config.renderTextTracksNatively&&r===0&&a!==void 0){var u=this.textTracks;Object.keys(u).forEach(function(d){return gr(u[d],r,a)})}}},n.extractCea608Data=function(e){for(var t=[[],[]],r=31&e[0],i=2,a=0;a<r;a++){var o=e[i++],l=127&e[i++],h=127&e[i++];if((l!==0||h!==0)&&4&o){var u=3&o;u!==0&&u!==1||(t[u].push(l),t[u].push(h))}}return t},s}();function js(s,n){return!!s&&s.label===n.name&&!(s.textTrack1||s.textTrack2)}var qs=function(){function s(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var n=s.prototype;return n.setStreamController=function(e){this.streamController=e},n.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},n.registerListeners=function(){var e=this.hls;e.on(y.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.BUFFER_CODECS,this.onBufferCodecs,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this)},n.unregisterListener=function(){var e=this.hls;e.off(y.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.BUFFER_CODECS,this.onBufferCodecs,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this)},n.onFpsDropLevelCapping=function(e,t){var r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})},n.onMediaAttaching=function(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null},n.onManifestParsed=function(e,t){var r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()},n.onBufferCodecs=function(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()},n.onMediaDetaching=function(){this.stopCapping()},n.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var e=this.hls.levels;if(e.length){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e.length-1),t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},n.getMaxLevel=function(e){var t=this,r=this.hls.levels;if(!r.length)return-1;var i=r.filter(function(a,o){return t.isLevelAllowed(a)&&o<=e});return this.clientRect=null,s.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)},n.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},n.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},n.getDimensions=function(){if(this.clientRect)return this.clientRect;var e=this.media,t={width:0,height:0};if(e){var r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,t.width||t.height||(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t},n.isLevelAllowed=function(e){return!this.restrictedLevels.some(function(t){return e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height})},s.getMaxLevelByMediaSize=function(e,t,r){if(e==null||!e.length)return-1;for(var i,a,o=e.length-1,l=0;l<e.length;l+=1){var h=e[l];if((h.width>=t||h.height>=r)&&(i=h,!(a=e[l+1])||i.width!==a.width||i.height!==a.height)){o=l;break}}return o},ee(s,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return e}}]),s}(),zs=function(){function s(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}var n=s.prototype;return n.setStreamController=function(e){this.streamController=e},n.registerListeners=function(){this.hls.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this)},n.unregisterListeners=function(){this.hls.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this)},n.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},n.onMediaAttaching=function(e,t){var r=this.hls.config;if(r.capLevelOnFPSDrop){var i=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=i,i&&typeof i.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}},n.checkFPS=function(e,t,r){var i=performance.now();if(t){if(this.lastTime){var a=i-this.lastTime,o=r-this.lastDroppedFrames,l=t-this.lastDecodedFrames,h=1e3*o/a,u=this.hls;if(u.trigger(y.FPS_DROP,{currentDropped:o,currentDecoded:l,totalDroppedFrames:r}),h>0&&o>u.config.fpsDroppedMonitoringThreshold*l){var d=u.currentLevel;R.warn("drop FPS ratio greater than max allowed value for currentLevel: "+d),d>0&&(u.autoLevelCapping===-1||u.autoLevelCapping>=d)&&(d-=1,u.trigger(y.FPS_DROP_LEVEL_CAPPING,{level:d,droppedLevel:u.currentLevel}),u.autoLevelCapping=d,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=r,this.lastDecodedFrames=t}},n.checkFPSInterval=function(){var e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},s}(),jt="[eme]",Xn=function(){function s(e){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=s.CDMCleanupPromise?[s.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=R.debug.bind(R,jt),this.log=R.log.bind(R,jt),this.warn=R.warn.bind(R,jt),this.error=R.error.bind(R,jt),this.hls=e,this.config=e.config,this.registerListeners()}var n=s.prototype;return n.destroy=function(){this.unregisterListeners(),this.onMediaDetached();var e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null},n.registerListeners=function(){this.hls.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(y.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(y.MANIFEST_LOADED,this.onManifestLoaded,this)},n.unregisterListeners=function(){this.hls.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(y.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(y.MANIFEST_LOADED,this.onManifestLoaded,this)},n.getLicenseServerUrl=function(e){var t=this.config,r=t.drmSystems,i=t.widevineLicenseUrl,a=r[e];if(a)return a.licenseUrl;if(e===z.WIDEVINE&&i)return i;throw new Error('no license server URL configured for key-system "'+e+'"')},n.getServerCertificateUrl=function(e){var t=this.config.drmSystems[e];if(t)return t.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'+e+'"]')},n.attemptKeySystemAccess=function(e){var t=this,r=this.hls.levels,i=function(l,h,u){return!!l&&u.indexOf(l)===h},a=r.map(function(l){return l.audioCodec}).filter(i),o=r.map(function(l){return l.videoCodec}).filter(i);return a.length+o.length===0&&o.push("avc1.42e01e"),new Promise(function(l,h){(function u(d){var c=d.shift();t.getMediaKeysPromise(c,a,o).then(function(f){return l({keySystem:c,mediaKeys:f})}).catch(function(f){d.length?u(d):h(f instanceof fe?f:new fe({type:N.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_NO_ACCESS,error:f,fatal:!0},f.message))})})(e)})},n.requestMediaKeySystemAccess=function(e,t){var r=this.config.requestMediaKeySystemAccessFunc;if(typeof r!="function"){var i="Configured requestMediaKeySystemAccess is not a function "+r;return Ei===null&&self.location.protocol==="http:"&&(i="navigator.requestMediaKeySystemAccess is not available over insecure protocol "+location.protocol),Promise.reject(new Error(i))}return r(e,t)},n.getMediaKeysPromise=function(e,t,r){var i=this,a=function(u,d,c,f){var g;switch(u){case z.FAIRPLAY:g=["cenc","sinf"];break;case z.WIDEVINE:case z.PLAYREADY:g=["cenc"];break;case z.CLEARKEY:g=["cenc","keyids"];break;default:throw new Error("Unknown key-system: "+u)}return function(m,T,v,p){return[{initDataTypes:m,persistentState:p.persistentState||"not-allowed",distinctiveIdentifier:p.distinctiveIdentifier||"not-allowed",sessionTypes:p.sessionTypes||[p.sessionType||"temporary"],audioCapabilities:T.map(function(S){return{contentType:'audio/mp4; codecs="'+S+'"',robustness:p.audioRobustness||"",encryptionScheme:p.audioEncryptionScheme||null}}),videoCapabilities:v.map(function(S){return{contentType:'video/mp4; codecs="'+S+'"',robustness:p.videoRobustness||"",encryptionScheme:p.videoEncryptionScheme||null}})}]}(g,d,c,f)}(e,t,r,this.config.drmSystemOptions),o=this.keySystemAccessPromises[e],l=o==null?void 0:o.keySystemAccess;if(!l){this.log('Requesting encrypted media "'+e+'" key-system access with config: '+JSON.stringify(a)),l=this.requestMediaKeySystemAccess(e,a);var h=this.keySystemAccessPromises[e]={keySystemAccess:l};return l.catch(function(u){i.log('Failed to obtain access to key-system "'+e+'": '+u)}),l.then(function(u){i.log('Access for key-system "'+u.keySystem+'" obtained');var d=i.fetchServerCertificate(e);return i.log('Create media-keys for "'+e+'"'),h.mediaKeys=u.createMediaKeys().then(function(c){return i.log('Media-keys created for "'+e+'"'),d.then(function(f){return f?i.setMediaKeysServerCertificate(c,e,f):c})}),h.mediaKeys.catch(function(c){i.error('Failed to create media-keys for "'+e+'"}: '+c)}),h.mediaKeys})}return l.then(function(){return o.mediaKeys})},n.createMediaKeySessionContext=function(e){var t=e.decryptdata,r=e.keySystem,i=e.mediaKeys;this.log('Creating key-system session "'+r+'" keyId: '+Ee(t.keyId||[]));var a=i.createSession(),o={decryptdata:t,keySystem:r,mediaKeys:i,mediaKeysSession:a,keyStatus:"status-pending"};return this.mediaKeySessions.push(o),o},n.renewKeySession=function(e){var t=e.decryptdata;if(t.pssh){var r=this.createMediaKeySessionContext(e),i=this.getKeyIdString(t);this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(r,"cenc",t.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)},n.getKeyIdString=function(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return Ee(e.keyId)},n.updateKeySession=function(e,t){var r,i=e.mediaKeysSession;return this.log('Updating key-session "'+i.sessionId+'" for keyID '+Ee(((r=e.decryptdata)==null?void 0:r.keyId)||[])+`
      } (data length: `+(t&&t.byteLength)+")"),i.update(t)},n.selectKeySystemFormat=function(e){var t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: "+e.sn+" "+e.type+": "+e.level+") key formats "+t.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise},n.getKeyFormatPromise=function(e){var t=this;return new Promise(function(r,i){var a=sr(t.config),o=e.map(pi).filter(function(l){return!!l&&a.indexOf(l)!==-1});return t.getKeySystemSelectionPromise(o).then(function(l){var h=l.keySystem,u=Ti(h);u?r(u):i(new Error('Unable to find format for key-system "'+h+'"'))}).catch(i)})},n.loadKey=function(e){var t=this,r=e.keyInfo.decryptdata,i=this.getKeyIdString(r),a="(keyId: "+i+' format: "'+r.keyFormat+'" method: '+r.method+" uri: "+r.uri+")";this.log("Starting session for key "+a);var o=this.keyIdToKeySessionPromise[i];return o||(o=this.keyIdToKeySessionPromise[i]=this.getKeySystemForKeyPromise(r).then(function(l){var h=l.keySystem,u=l.mediaKeys;return t.throwIfDestroyed(),t.log("Handle encrypted media sn: "+e.frag.sn+" "+e.frag.type+": "+e.frag.level+" using key "+a),t.attemptSetMediaKeys(h,u).then(function(){t.throwIfDestroyed();var d=t.createMediaKeySessionContext({keySystem:h,mediaKeys:u,decryptdata:r});return t.generateRequestWithPreferredKeySession(d,"cenc",r.pssh,"playlist-key")})})).catch(function(l){return t.handleError(l)}),o},n.throwIfDestroyed=function(e){if(!this.hls)throw new Error("invalid state")},n.handleError=function(e){this.hls&&(this.error(e.message),e instanceof fe?this.hls.trigger(y.ERROR,e.data):this.hls.trigger(y.ERROR,{type:N.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))},n.getKeySystemForKeyPromise=function(e){var t=this.getKeyIdString(e),r=this.keyIdToKeySessionPromise[t];if(!r){var i=pi(e.keyFormat),a=i?[i]:sr(this.config);return this.attemptKeySystemAccess(a)}return r},n.getKeySystemSelectionPromise=function(e){if(e.length||(e=sr(this.config)),e.length===0)throw new fe({type:N.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options "+JSON.stringify({drmSystems:this.config.drmSystems}));return this.attemptKeySystemAccess(e)},n._onMediaEncrypted=function(e){var t=this,r=e.initDataType,i=e.initData;if(this.debug('"'+e.type+'" event: init data type: "'+r+'"'),i!==null){var a,o;if(r==="sinf"&&this.config.drmSystems[z.FAIRPLAY]){var l=te(new Uint8Array(i));try{var h=ir(JSON.parse(l).sinf),u=Ii(new Uint8Array(h));if(!u)return;a=u.subarray(8,24),o=z.FAIRPLAY}catch{return void this.warn('Failed to parse sinf "encrypted" event message initData')}}else{var d=function(S){if(!(S instanceof ArrayBuffer)||S.byteLength<32)return null;var E={version:0,systemId:"",kids:null,data:null},L=new DataView(S),A=L.getUint32(0);if(S.byteLength!==A&&A>44||L.getUint32(4)!==1886614376||(E.version=L.getUint32(8)>>>24,E.version>1))return null;E.systemId=Ee(new Uint8Array(S,12,16));var b=L.getUint32(28);if(E.version===0){if(A-32<b)return null;E.data=new Uint8Array(S,32,b)}else if(E.version===1){E.kids=[];for(var w=0;w<b;w++)E.kids.push(new Uint8Array(S,32+16*w,16))}return E}(i);if(d===null)return;d.version===0&&d.systemId===yi&&d.data&&(a=d.data.subarray(8,24)),o=function(S){if(S===yi)return z.WIDEVINE}(d.systemId)}if(o&&a){for(var c=Ee(a),f=this.keyIdToKeySessionPromise,g=this.mediaKeySessions,m=f[c],T=function(){var S=g[v],E=S.decryptdata;if(E.pssh||!E.keyId)return"continue";var L=Ee(E.keyId);return c===L||E.uri.replace(/-/g,"").indexOf(c)!==-1?(m=f[L],delete f[L],E.pssh=new Uint8Array(i),E.keyId=a,m=f[c]=m.then(function(){return t.generateRequestWithPreferredKeySession(S,r,i,"encrypted-event-key-match")}),"break"):void 0},v=0;v<g.length;v++){var p=T();if(p!=="continue"&&p==="break")break}m||(m=f[c]=this.getKeySystemSelectionPromise([o]).then(function(S){var E,L=S.keySystem,A=S.mediaKeys;t.throwIfDestroyed();var b=new hr("ISO-23001-7",c,(E=Ti(L))!=null?E:"");return b.pssh=new Uint8Array(i),b.keyId=a,t.attemptSetMediaKeys(L,A).then(function(){t.throwIfDestroyed();var w=t.createMediaKeySessionContext({decryptdata:b,keySystem:L,mediaKeys:A});return t.generateRequestWithPreferredKeySession(w,r,i,"encrypted-event-no-match")})})),m.catch(function(S){return t.handleError(S)})}}},n._onWaitingForKey=function(e){this.log('"'+e.type+'" event')},n.attemptSetMediaKeys=function(e,t){var r=this,i=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'+e+'"');var a=Promise.all(i).then(function(){if(!r.media)throw new Error("Attempted to set mediaKeys without media element attached");return r.media.setMediaKeys(t)});return this.setMediaKeysQueue.push(a),a.then(function(){r.log('Media-keys set for "'+e+'"'),i.push(a),r.setMediaKeysQueue=r.setMediaKeysQueue.filter(function(o){return i.indexOf(o)===-1})})},n.generateRequestWithPreferredKeySession=function(e,t,r,i){var a,o,l=this,h=(a=this.config.drmSystems)==null||(o=a[e.keySystem])==null?void 0:o.generateRequest;if(h)try{var u=h.call(this.hls,t,r,e);if(!u)throw new Error("Invalid response from configured generateRequest filter");t=u.initDataType,r=e.decryptdata.pssh=u.initData?new Uint8Array(u.initData):null}catch(m){var d;if(this.warn(m.message),(d=this.hls)!=null&&d.config.debug)throw m}if(r===null)return this.log('Skipping key-session request for "'+i+'" (no initData)'),Promise.resolve(e);var c=this.getKeyIdString(e.decryptdata);this.log('Generating key-session request for "'+i+'": '+c+" (init data type: "+t+" length: "+(r?r.byteLength:null)+")");var f=new Vt;e.mediaKeysSession.onmessage=function(m){var T=e.mediaKeysSession;if(T){var v=m.messageType,p=m.message;l.log('"'+v+'" message event for session "'+T.sessionId+'" message size: '+p.byteLength),v==="license-request"||v==="license-renewal"?l.renewLicense(e,p).catch(function(S){l.handleError(S),f.emit("error",S)}):v==="license-release"?e.keySystem===z.FAIRPLAY&&(l.updateKeySession(e,mi("acknowledged")),l.removeSession(e)):l.warn('unhandled media key message type "'+v+'"')}else f.emit("error",new Error("invalid state"))},e.mediaKeysSession.onkeystatuseschange=function(m){if(e.mediaKeysSession){l.onKeyStatusChange(e);var T=e.keyStatus;f.emit("keyStatus",T),T==="expired"&&(l.warn(e.keySystem+" expired for key "+c),l.renewKeySession(e))}else f.emit("error",new Error("invalid state"))};var g=new Promise(function(m,T){f.on("error",T),f.on("keyStatus",function(v){v.startsWith("usable")?m():v==="output-restricted"?T(new fe({type:N.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):v==="internal-error"?T(new fe({type:N.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},'key status changed to "'+v+'"')):v==="expired"?T(new Error("key expired while generating request")):l.warn('unhandled key status change "'+v+'"')})});return e.mediaKeysSession.generateRequest(t,r).then(function(){var m;l.log('Request generated for key-session "'+((m=e.mediaKeysSession)==null?void 0:m.sessionId)+'" keyId: '+c)}).catch(function(m){throw new fe({type:N.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_NO_SESSION,error:m,fatal:!1},"Error generating key-session request: "+m)}).then(function(){return g}).catch(function(m){throw f.removeAllListeners(),l.removeSession(e),m}).then(function(){return f.removeAllListeners(),e})},n.onKeyStatusChange=function(e){var t=this;e.mediaKeysSession.keyStatuses.forEach(function(r,i){t.log('key status change "'+r+'" for keyStatuses keyId: '+Ee("buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i))+" session keyId: "+Ee(new Uint8Array(e.decryptdata.keyId||[]))+" uri: "+e.decryptdata.uri),e.keyStatus=r})},n.fetchServerCertificate=function(e){var t=this.config,r=new t.loader(t),i=this.getServerCertificateUrl(e);return i?(this.log('Fetching serverCertificate for "'+e+'"'),new Promise(function(a,o){var l={responseType:"arraybuffer",url:i},h=t.certLoadPolicy.default,u={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:function(c,f,g,m){a(c.data)},onError:function(c,f,g,m){o(new fe({type:N.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:g,response:ne({url:l.url,data:void 0},c)},'"'+e+'" certificate request failed ('+i+"). Status: "+c.code+" ("+c.text+")"))},onTimeout:function(c,f,g){o(new fe({type:N.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:g,response:{url:l.url,data:void 0}},'"'+e+'" certificate request timed out ('+i+")"))},onAbort:function(c,f,g){o(new Error("aborted"))}};r.load(l,u,d)})):Promise.resolve()},n.setMediaKeysServerCertificate=function(e,t,r){var i=this;return new Promise(function(a,o){e.setServerCertificate(r).then(function(l){i.log("setServerCertificate "+(l?"success":"not supported by CDM")+" ("+(r==null?void 0:r.byteLength)+') on "'+t+'"'),a(e)}).catch(function(l){o(new fe({type:N.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:l,fatal:!0},l.message))})})},n.renewLicense=function(e,t){var r=this;return this.requestLicense(e,new Uint8Array(t)).then(function(i){return r.updateKeySession(e,new Uint8Array(i)).catch(function(a){throw new fe({type:N.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:a,fatal:!0},a.message)})})},n.setupLicenseXHR=function(e,t,r,i){var a=this,o=this.config.licenseXhrSetup;return o?Promise.resolve().then(function(){if(!r.decryptdata)throw new Error("Key removed");return o.call(a.hls,e,t,r,i)}).catch(function(l){if(!r.decryptdata)throw l;return e.open("POST",t,!0),o.call(a.hls,e,t,r,i)}).then(function(l){return e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:l||i}}):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:i}))},n.requestLicense=function(e,t){var r=this,i=this.config.keyLoadPolicy.default;return new Promise(function(a,o){var l=r.getLicenseServerUrl(e.keySystem);r.log("Sending license request to URL: "+l);var h=new XMLHttpRequest;h.responseType="arraybuffer",h.onreadystatechange=function(){if(!r.hls||!e.mediaKeysSession)return o(new Error("invalid state"));if(h.readyState===4)if(h.status===200){r._requestLicenseFailureCount=0;var u=h.response;r.log("License received "+(u instanceof ArrayBuffer?u.byteLength:u));var d=r.config.licenseResponseCallback;if(d)try{u=d.call(r.hls,h,l,e)}catch(m){r.error(m)}a(u)}else{var c=i.errorRetry,f=c?c.maxNumRetry:0;if(r._requestLicenseFailureCount++,r._requestLicenseFailureCount>f||h.status>=400&&h.status<500)o(new fe({type:N.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:h,response:{url:l,data:void 0,code:h.status,text:h.statusText}},"License Request XHR failed ("+l+"). Status: "+h.status+" ("+h.statusText+")"));else{var g=f-r._requestLicenseFailureCount+1;r.warn("Retrying license request, "+g+" attempts left"),r.requestLicense(e,t).then(a,o)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=h,r.setupLicenseXHR(h,l,e,t).then(function(u){var d=u.xhr,c=u.licenseChallenge;d.send(c)})})},n.onMediaAttached=function(e,t){if(this.config.emeEnabled){var r=t.media;this.media=r,r.addEventListener("encrypted",this.onMediaEncrypted),r.addEventListener("waitingforkey",this.onWaitingForKey)}},n.onMediaDetached=function(){var e=this,t=this.media,r=this.mediaKeySessions;t&&(t.removeEventListener("encrypted",this.onMediaEncrypted),t.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},hr.clearKeyUriToKeyIdMap();var i=r.length;s.CDMCleanupPromise=Promise.all(r.map(function(a){return e.removeSession(a)}).concat(t==null?void 0:t.setMediaKeys(null).catch(function(a){e.log("Could not clear media keys: "+a+". media.src: "+(t==null?void 0:t.src))}))).then(function(){i&&(e.log("finished closing key sessions and clearing media keys"),r.length=0)}).catch(function(a){e.log("Could not close sessions and clear media keys: "+a+". media.src: "+(t==null?void 0:t.src))})},n.onManifestLoaded=function(e,t){var r=t.sessionKeys;if(r&&this.config.emeEnabled&&!this.keyFormatPromise){var i=r.reduce(function(a,o){return a.indexOf(o.keyFormat)===-1&&a.push(o.keyFormat),a},[]);this.log("Selecting key-system from session-keys "+i.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(i)}},n.removeSession=function(e){var t=this,r=e.mediaKeysSession,i=e.licenseXhr;if(r){this.log("Remove licenses and keys and close session "+r.sessionId),r.onmessage=null,r.onkeystatuseschange=null,i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;var a=this.mediaKeySessions.indexOf(e);return a>-1&&this.mediaKeySessions.splice(a,1),r.remove().catch(function(o){t.log("Could not remove session: "+o)}).then(function(){return r.close()}).catch(function(o){t.log("Could not close session: "+o)})}},s}();Xn.CDMCleanupPromise=void 0;var fe=function(s){function n(e,t){var r;return(r=s.call(this,t)||this).data=void 0,e.error||(e.error=new Error(t)),r.data=e,e.err=e.error,r}return ae(n,s),n}(ot(Error)),Xs="m",qt="a",ii="v",ni="av",Qn="i",Qs="tt",$s=function(){function s(e){var t=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){t.initialized&&(t.starved=!0),t.buffering=!0},this.onPlaying=function(){t.initialized||(t.initialized=!0),t.buffering=!1},this.applyPlaylistData=function(a){try{t.apply(a,{ot:Xs,su:!t.initialized})}catch(o){R.warn("Could not generate manifest CMCD data.",o)}},this.applyFragmentData=function(a){try{var o=a.frag,l=t.hls.levels[o.level],h=t.getObjectType(o),u={d:1e3*o.duration,ot:h};h!==ii&&h!==qt&&h!=ni||(u.br=l.bitrate/1e3,u.tb=t.getTopBandwidth(h)/1e3,u.bl=t.getBufferLength(h)),t.apply(a,u)}catch(d){R.warn("Could not generate segment CMCD data.",d)}},this.hls=e;var r=this.config=e.config,i=r.cmcd;i!=null&&(r.pLoader=this.createPlaylistLoader(),r.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||s.uuid(),this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.registerListeners())}var n=s.prototype;return n.registerListeners=function(){var e=this.hls;e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHED,this.onMediaDetached,this),e.on(y.BUFFER_CREATED,this.onBufferCreated,this)},n.unregisterListeners=function(){var e=this.hls;e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHED,this.onMediaDetached,this),e.off(y.BUFFER_CREATED,this.onBufferCreated,this)},n.destroy=function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},n.onMediaAttached=function(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},n.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},n.onBufferCreated=function(e,t){var r,i;this.audioBuffer=(r=t.tracks.audio)==null?void 0:r.buffer,this.videoBuffer=(i=t.tracks.video)==null?void 0:i.buffer},n.createData=function(){var e;return{v:1,sf:"h",sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},n.apply=function(e,t){t===void 0&&(t={}),$(t,this.createData());var r=t.ot===Qn||t.ot===ii||t.ot===ni;if(this.starved&&r&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering),this.useHeaders){var i=s.toHeaders(t);if(!Object.keys(i).length)return;e.headers||(e.headers={}),$(e.headers,i)}else{var a=s.toQuery(t);if(!a)return;e.url=s.appendQueryToUri(e.url,a)}},n.getObjectType=function(e){var t=e.type;return t==="subtitle"?Qs:e.sn==="initSegment"?Qn:t==="audio"?qt:t==="main"?this.hls.audioTracks.length?ii:ni:void 0},n.getTopBandwidth=function(e){var t,r=0,i=this.hls;if(e===qt)t=i.audioTracks;else{var a=i.maxAutoLevel,o=a>-1?a+1:i.levels.length;t=i.levels.slice(0,o)}for(var l,h=hi(t);!(l=h()).done;){var u=l.value;u.bitrate>r&&(r=u.bitrate)}return r>0?r:NaN},n.getBufferLength=function(e){var t=this.hls.media,r=e===qt?this.audioBuffer:this.videoBuffer;return r&&t?1e3*Q.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len:NaN},n.createPlaylistLoader=function(){var e=this.config.pLoader,t=this.applyPlaylistData,r=e||this.config.loader;return function(){function i(o){this.loader=void 0,this.loader=new r(o)}var a=i.prototype;return a.destroy=function(){this.loader.destroy()},a.abort=function(){this.loader.abort()},a.load=function(o,l,h){t(o),this.loader.load(o,l,h)},ee(i,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),i}()},n.createFragmentLoader=function(){var e=this.config.fLoader,t=this.applyFragmentData,r=e||this.config.loader;return function(){function i(o){this.loader=void 0,this.loader=new r(o)}var a=i.prototype;return a.destroy=function(){this.loader.destroy()},a.abort=function(){this.loader.abort()},a.load=function(o,l,h){t(o),this.loader.load(o,l,h)},ee(i,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),i}()},s.uuid=function(){var e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)},s.serialize=function(e){for(var t,r=[],i=function(m){return!Number.isNaN(m)&&m!=null&&m!==""&&m!==!1},a=function(m){return Math.round(m)},o=function(m){return 100*a(m/100)},l={br:a,d:a,bl:o,dl:o,mtp:o,nor:function(m){return encodeURIComponent(m)},rtp:o,tb:a},h=hi(Object.keys(e||{}).sort());!(t=h()).done;){var u=t.value,d=e[u];if(i(d)&&!(u==="v"&&d===1||u=="pr"&&d===1)){var c=l[u];c&&(d=c(d));var f=typeof d,g=void 0;g=u==="ot"||u==="sf"||u==="st"?u+"="+d:f==="boolean"?u:f==="number"?u+"="+d:u+"="+JSON.stringify(d),r.push(g)}}return r.join(",")},s.toHeaders=function(e){for(var t={},r=["Object","Request","Session","Status"],i=[{},{},{},{}],a={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},o=0,l=Object.keys(e);o<l.length;o++){var h=l[o];i[a[h]!=null?a[h]:1][h]=e[h]}for(var u=0;u<i.length;u++){var d=s.serialize(i[u]);d&&(t["CMCD-"+r[u]]=d)}return t},s.toQuery=function(e){return"CMCD="+encodeURIComponent(s.serialize(e))},s.appendQueryToUri=function(e,t){if(!t)return e;var r=e.includes("?")?"&":"?";return""+e+r+t},s}(),Js=function(){function s(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=R.log.bind(R,"[content-steering]:"),this.registerListeners()}var n=s.prototype;return n.registerListeners=function(){var e=this.hls;e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.ERROR,this.onError,this)},n.unregisterListeners=function(){var e=this.hls;e&&(e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.ERROR,this.onError,this))},n.startLoad=function(){if(this.started=!0,self.clearTimeout(this.reloadTimer),this.enabled&&this.uri)if(this.updated){var e=Math.max(1e3*this.timeToLoad-(performance.now()-this.updated),0);this.scheduleRefresh(this.uri,e)}else this.loadSteeringManifest(this.uri)},n.stopLoad=function(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),self.clearTimeout(this.reloadTimer)},n.destroy=function(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null},n.removeLevel=function(e){var t=this.levels;t&&(this.levels=t.filter(function(r){return r!==e}))},n.onManifestLoading=function(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null},n.onManifestLoaded=function(e,t){var r=t.contentSteering;r!==null&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())},n.onManifestParsed=function(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks},n.onError=function(e,t){var r=t.errorAction;if((r==null?void 0:r.action)===He&&r.flags===Ft){var i=this.pathwayPriority,a=this.pathwayId;this.penalizedPathways[a]||(this.penalizedPathways[a]=performance.now()),!i&&this.levels&&(i=this.levels.reduce(function(o,l){return o.indexOf(l.pathwayId)===-1&&o.push(l.pathwayId),o},[])),i&&i.length>1&&(this.updatePathwayPriority(i),r.resolved=this.pathwayId!==a)}},n.filterParsedLevels=function(e){this.levels=e;var t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){var r=e[0].pathwayId;this.log("No levels found in Pathway "+this.pathwayId+'. Setting initial Pathway to "'+r+'"'),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length?(this.log("Found "+t.length+"/"+e.length+' levels in Pathway "'+this.pathwayId+'"'),t):e},n.getLevelsForPathway=function(e){return this.levels===null?[]:this.levels.filter(function(t){return e===t.pathwayId})},n.updatePathwayPriority=function(e){var t;this.pathwayPriority=e;var r=this.penalizedPathways,i=performance.now();Object.keys(r).forEach(function(d){i-r[d]>3e5&&delete r[d]});for(var a=0;a<e.length;a++){var o=e[a];if(!r[o]){if(o===this.pathwayId)return;var l=this.hls.nextLoadLevel,h=this.hls.levels[l];if((t=this.getLevelsForPathway(o)).length>0){this.log('Setting Pathway to "'+o+'"'),this.pathwayId=o,this.hls.trigger(y.LEVELS_UPDATED,{levels:t});var u=this.hls.levels[l];h&&u&&this.levels&&(u.attrs["STABLE-VARIANT-ID"]!==h.attrs["STABLE-VARIANT-ID"]&&u.bitrate!==h.bitrate&&this.log("Unstable Pathways change from bitrate "+h.bitrate+" to "+u.bitrate),this.hls.nextLoadLevel=l);break}}}},n.clonePathways=function(e){var t=this,r=this.levels;if(r){var i={},a={};e.forEach(function(o){var l=o.ID,h=o["BASE-ID"],u=o["URI-REPLACEMENT"];if(!r.some(function(c){return c.pathwayId===l})){var d=t.getLevelsForPathway(h).map(function(c){var f=$({},c);f.details=void 0,f.url=Jn(c.uri,c.attrs["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",u);var g=new X(c.attrs);g["PATHWAY-ID"]=l;var m=g.AUDIO&&g.AUDIO+"_clone_"+l,T=g.SUBTITLES&&g.SUBTITLES+"_clone_"+l;m&&(i[g.AUDIO]=m,g.AUDIO=m),T&&(a[g.SUBTITLES]=T,g.SUBTITLES=T),f.attrs=g;var v=new ft(f);return Ot(v,"audio",m),Ot(v,"text",T),v});r.push.apply(r,d),$n(t.audioTracks,i,u,l),$n(t.subtitleTracks,a,u,l)}})}},n.loadSteeringManifest=function(e){var t,r=this,i=this.hls.config,a=i.loader;this.loader&&this.loader.destroy(),this.loader=new a(i);try{t=new self.URL(e)}catch{return this.enabled=!1,void this.log("Failed to parse Steering Manifest URI: "+e)}if(t.protocol!=="data:"){var o=0|(this.hls.bandwidthEstimate||i.abrEwmaDefaultEstimate);t.searchParams.set("_HLS_pathway",this.pathwayId),t.searchParams.set("_HLS_throughput",""+o)}var l={responseType:"json",url:t.href},h=i.steeringManifestLoadPolicy.default,u=h.errorRetry||h.timeoutRetry||{},d={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:u.maxNumRetry||0,retryDelay:u.retryDelayMs||0,maxRetryDelay:u.maxRetryDelayMs||0},c={onSuccess:function(f,g,m,T){r.log('Loaded steering manifest: "'+t+'"');var v=f.data;if(v.VERSION===1){r.updated=performance.now(),r.timeToLoad=v.TTL;var p=v["RELOAD-URI"],S=v["PATHWAY-CLONES"],E=v["PATHWAY-PRIORITY"];if(p)try{r.uri=new self.URL(p,t).href}catch{return r.enabled=!1,void r.log("Failed to parse Steering Manifest RELOAD-URI: "+p)}r.scheduleRefresh(r.uri||m.url),S&&r.clonePathways(S),E&&r.updatePathwayPriority(E)}else r.log("Steering VERSION "+v.VERSION+" not supported!")},onError:function(f,g,m,T){if(r.log("Error loading steering manifest: "+f.code+" "+f.text+" ("+g.url+")"),r.stopLoad(),f.code===410)return r.enabled=!1,void r.log("Steering manifest "+g.url+" no longer available");var v=1e3*r.timeToLoad;if(f.code!==429)r.scheduleRefresh(r.uri||g.url,v);else{var p=r.loader;if(typeof(p==null?void 0:p.getResponseHeader)=="function"){var S=p.getResponseHeader("Retry-After");S&&(v=1e3*parseFloat(S))}r.log("Steering manifest "+g.url+" rate limited")}},onTimeout:function(f,g,m){r.log("Timeout loading steering manifest ("+g.url+")"),r.scheduleRefresh(r.uri||g.url)}};this.log("Requesting steering manifest: "+t),this.loader.load(l,d,c)},n.scheduleRefresh=function(e,t){var r=this;t===void 0&&(t=1e3*this.timeToLoad),self.clearTimeout(this.reloadTimer),this.reloadTimer=self.setTimeout(function(){r.loadSteeringManifest(e)},t)},s}();function $n(s,n,e,t){s&&Object.keys(n).forEach(function(r){var i=s.filter(function(a){return a.groupId===r}).map(function(a){var o=$({},a);return o.details=void 0,o.attrs=new X(o.attrs),o.url=o.attrs.URI=Jn(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",e),o.groupId=o.attrs["GROUP-ID"]=n[r],o.attrs["PATHWAY-ID"]=t,o});s.push.apply(s,i)})}function Jn(s,n,e,t){var r,i=t.HOST,a=t.PARAMS,o=t[e];n&&(r=o==null?void 0:o[n])&&(s=r);var l=new self.URL(s);return i&&!r&&(l.host=i),a&&Object.keys(a).sort().forEach(function(h){h&&l.searchParams.set(h,a[h])}),l.href}var Zs=/^age:\s*[\d.]+\s*$/im,Zn=function(){function s(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Rt,this.retryDelay=0}var n=s.prototype;return n.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},n.abortInternal=function(){var e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))},n.abort=function(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},n.load=function(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()},n.loadInternal=function(){var e=this,t=this.config,r=this.context;if(t){var i=this.loader=new self.XMLHttpRequest,a=this.stats;a.loading.first=0,a.loaded=0;var o=this.xhrSetup;o?Promise.resolve().then(function(){if(!e.stats.aborted)return o(i,r.url)}).catch(function(l){return i.open("GET",r.url,!0),o(i,r.url)}).then(function(){e.stats.aborted||e.openAndSendXhr(i,r,t)}).catch(function(l){e.callbacks.onError({code:i.status,text:l.message},r,i,a)}):this.openAndSendXhr(i,r,t)}},n.openAndSendXhr=function(e,t,r){e.readyState||e.open("GET",t.url,!0);var i=this.context.headers,a=r.loadPolicy,o=a.maxTimeToFirstByteMs,l=a.maxLoadTimeMs;if(i)for(var h in i)e.setRequestHeader(h,i[h]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=o&&F(o)?o:l,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()},n.readystatechange=function(){var e=this.context,t=this.loader,r=this.stats;if(e&&t){var i=t.readyState,a=this.config;if(!r.aborted&&i>=2&&(r.loading.first===0&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),a.timeout!==a.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),a.timeout=a.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),a.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),i===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;var o=t.status,l=t.responseType!=="text";if(o>=200&&o<300&&(l&&t.response||t.responseText!==null)){r.loading.end=Math.max(self.performance.now(),r.loading.first);var h=l?t.response:t.responseText,u=t.responseType==="arraybuffer"?h.byteLength:h.length;if(r.loaded=r.total=u,r.bwEstimate=8e3*r.total/(r.loading.end-r.loading.first),!this.callbacks)return;var d=this.callbacks.onProgress;if(d&&d(r,e,h,t),!this.callbacks)return;var c={url:t.responseURL,data:h,code:o};this.callbacks.onSuccess(c,r,e,t)}else{var f=a.loadPolicy.errorRetry;Pt(f,r.retry,!1,o)?this.retry(f):(R.error(o+" while loading "+e.url),this.callbacks.onError({code:o,text:t.statusText},e,t,r))}}}},n.loadtimeout=function(){var e,t=(e=this.config)==null?void 0:e.loadPolicy.timeoutRetry;if(Pt(t,this.stats.retry,!0))this.retry(t);else{R.warn("timeout while loading "+this.context.url);var r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}},n.retry=function(e){var t=this.context,r=this.stats;this.retryDelay=Sr(e,r.retry),r.retry++,R.warn((status?"HTTP Status "+status:"Timeout")+" while loading "+t.url+", retrying "+r.retry+"/"+e.maxNumRetry+" in "+this.retryDelay+"ms"),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)},n.loadprogress=function(e){var t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)},n.getCacheAge=function(){var e=null;if(this.loader&&Zs.test(this.loader.getAllResponseHeaders())){var t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e},n.getResponseHeader=function(e){return this.loader&&new RegExp("^"+e+":\\s*[\\d.]+\\s*$","im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null},s}(),eo=/(\d+)-(\d+)\/(\d+)/,ea=function(){function s(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||to,this.controller=new self.AbortController,this.stats=new Rt}var n=s.prototype;return n.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},n.abortInternal=function(){var e=this.response;e!=null&&e.ok||(this.stats.aborted=!0,this.controller.abort())},n.abort=function(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},n.load=function(e,t,r){var i=this,a=this.stats;if(a.loading.start)throw new Error("Loader can only be used once.");a.loading.start=self.performance.now();var o=function(g,m){var T={method:"GET",mode:"cors",credentials:"same-origin",signal:m,headers:new self.Headers($({},g.headers))};return g.rangeEnd&&T.headers.set("Range","bytes="+g.rangeStart+"-"+String(g.rangeEnd-1)),T}(e,this.controller.signal),l=r.onProgress,h=e.responseType==="arraybuffer",u=h?"byteLength":"length",d=t.loadPolicy,c=d.maxTimeToFirstByteMs,f=d.maxLoadTimeMs;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,o),self.clearTimeout(this.requestTimeout),t.timeout=c&&F(c)?c:f,this.requestTimeout=self.setTimeout(function(){i.abortInternal(),r.onTimeout(a,e,i.response)},t.timeout),self.fetch(this.request).then(function(g){i.response=i.loader=g;var m=Math.max(self.performance.now(),a.loading.start);if(self.clearTimeout(i.requestTimeout),t.timeout=f,i.requestTimeout=self.setTimeout(function(){i.abortInternal(),r.onTimeout(a,e,i.response)},f-(m-a.loading.start)),!g.ok){var T=g.status,v=g.statusText;throw new ro(v||"fetch, bad network response",T,g)}return a.loading.first=m,a.total=function(p){var S=p.get("Content-Range");if(S){var E=function(A){var b=eo.exec(A);if(b)return parseInt(b[2])-parseInt(b[1])+1}(S);if(F(E))return E}var L=p.get("Content-Length");if(L)return parseInt(L)}(g.headers)||a.total,l&&F(t.highWaterMark)?i.loadProgressively(g,a,e,t.highWaterMark,l):h?g.arrayBuffer():e.responseType==="json"?g.json():g.text()}).then(function(g){var m=i.response;self.clearTimeout(i.requestTimeout),a.loading.end=Math.max(self.performance.now(),a.loading.first);var T=g[u];T&&(a.loaded=a.total=T);var v={url:m.url,data:g,code:m.status};l&&!F(t.highWaterMark)&&l(a,e,g,m),r.onSuccess(v,a,e,m)}).catch(function(g){if(self.clearTimeout(i.requestTimeout),!a.aborted){var m=g&&g.code||0,T=g?g.message:null;r.onError({code:m,text:T},e,g?g.details:null,a)}})},n.getCacheAge=function(){var e=null;if(this.response){var t=this.response.headers.get("age");e=t?parseFloat(t):null}return e},n.getResponseHeader=function(e){return this.response?this.response.headers.get(e):null},n.loadProgressively=function(e,t,r,i,a){i===void 0&&(i=0);var o=new Cn,l=e.body.getReader();return function h(){return l.read().then(function(u){if(u.done)return o.dataLength&&a(t,r,o.flush(),e),Promise.resolve(new ArrayBuffer(0));var d=u.value,c=d.length;return t.loaded+=c,c<i||o.dataLength?(o.push(d),o.dataLength>=i&&a(t,r,o.flush(),e)):a(t,r,d,e),h()}).catch(function(){return Promise.reject()})}()},s}();function to(s,n){return new self.Request(s.url,n)}var ro=function(s){function n(e,t,r){var i;return(i=s.call(this,e)||this).code=void 0,i.details=void 0,i.code=t,i.details=r,i}return ae(n,s),n}(ot(Error)),io=/\s/,no=ne(ne({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:Zn,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:Ss,bufferController:ws,capLevelController:qs,errorController:Ka,fpsController:zs,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:Ei,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:{newCue:function(s,n,e,t){for(var r,i,a,o,l,h=[],u=self.VTTCue||self.TextTrackCue,d=0;d<t.rows.length;d++)if(a=!0,o=0,l="",!(r=t.rows[d]).isEmpty()){for(var c,f=0;f<r.chars.length;f++)io.test(r.chars[f].uchar)&&a?o++:(l+=r.chars[f].uchar,a=!1);r.cueStartTime=n,n===e&&(e+=1e-4),o>=16?o--:o++;var g=Hn(l.trim()),m=Jr(n,e,g);s!=null&&(c=s.cues)!=null&&c.getCueById(m)||((i=new u(n,e,g)).id=m,i.line=d+1,i.align="left",i.position=10+Math.min(80,10*Math.floor(8*o/32)),h.push(i))}return s&&h.length&&(h.sort(function(T,v){return T.line==="auto"||v.line==="auto"?0:T.line>8&&v.line>8?v.line-T.line:T.line-v.line}),h.forEach(function(T){return ji(s,T)})),h}},enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:bs,subtitleTrackController:Ds,timelineController:Ws,audioStreamController:Ls,audioTrackController:Rs,emeController:Xn,cmcdController:$s,contentSteeringController:Js});function ai(s){return s&&typeof s=="object"?Array.isArray(s)?s.map(ai):Object.keys(s).reduce(function(n,e){return n[e]=ai(s[e]),n},{}):s}function ao(s){var n=s.loader;n!==ea&&n!==Zn?(R.log("[config]: Custom loader detected, cannot enable progressive streaming"),s.progressive=!1):function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}()&&(s.loader=ea,s.progressive=!0,s.enableSoftwareAES=!0,R.log("[config]: Progressive streaming enabled, using FetchLoader"))}var ta=function(){function s(e){e===void 0&&(e={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Vt,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,ci(e.debug||!1,"Hls instance");var t=this.config=function(_,C){if((C.liveSyncDurationCount||C.liveMaxLatencyDurationCount)&&(C.liveSyncDuration||C.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(C.liveMaxLatencyDurationCount!==void 0&&(C.liveSyncDurationCount===void 0||C.liveMaxLatencyDurationCount<=C.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(C.liveMaxLatencyDuration!==void 0&&(C.liveSyncDuration===void 0||C.liveMaxLatencyDuration<=C.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');var x=ai(_),B=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach(function(P){var O=(P==="level"?"playlist":P)+"LoadPolicy",U=C[O]===void 0,M=[];B.forEach(function(K){var H=P+"Loading"+K,Y=C[H];if(Y!==void 0&&U){M.push(H);var q=x[O].default;switch(C[O]={default:q},K){case"TimeOut":q.maxLoadTimeMs=Y,q.maxTimeToFirstByteMs=Y;break;case"MaxRetry":q.errorRetry.maxNumRetry=Y,q.timeoutRetry.maxNumRetry=Y;break;case"RetryDelay":q.errorRetry.retryDelayMs=Y,q.timeoutRetry.retryDelayMs=Y;break;case"MaxRetryTimeout":q.errorRetry.maxRetryDelayMs=Y,q.timeoutRetry.maxRetryDelayMs=Y}}}),M.length&&R.warn('hls.js config: "'+M.join('", "')+'" setting(s) are deprecated, use "'+O+'": '+JSON.stringify(C[O]))}),ne(ne({},x),C)}(s.DefaultConfig,e);this.userConfig=e,this._autoLevelCapping=-1,t.progressive&&ao(t);var r=t.abrController,i=t.bufferController,a=t.capLevelController,o=t.errorController,l=t.fpsController,h=new o(this),u=this.abrController=new r(this),d=this.bufferController=new i(this),c=this.capLevelController=new a(this),f=new l(this),g=new Pa(this),m=new Fa(this),T=t.contentSteeringController,v=T?new T(this):null,p=this.levelController=new Ha(this,v),S=new Va(this),E=new Wa(this.config),L=this.streamController=new Ts(this,S,E);c.setStreamController(L),f.setStreamController(L);var A=[g,p,L];v&&A.splice(1,0,v),this.networkControllers=A;var b=[u,d,c,f,m,S];this.audioTrackController=this.createController(t.audioTrackController,A);var w=t.audioStreamController;w&&A.push(new w(this,S,E)),this.subtitleTrackController=this.createController(t.subtitleTrackController,A);var D=t.subtitleStreamController;D&&A.push(new D(this,S,E)),this.createController(t.timelineController,b),E.emeController=this.emeController=this.createController(t.emeController,b),this.cmcdController=this.createController(t.cmcdController,b),this.latencyController=this.createController(Oa,b),this.coreComponents=b,A.push(h);var I=h.onErrorOut;typeof I=="function"&&this.on(y.ERROR,I,h)}s.isSupported=function(){return function(){var e=Pr();if(!e)return!1;var t=dn(),r=e&&typeof e.isTypeSupported=="function"&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),i=!t||t.prototype&&typeof t.prototype.appendBuffer=="function"&&typeof t.prototype.remove=="function";return!!r&&!!i}()};var n=s.prototype;return n.createController=function(e,t){if(e){var r=new e(this);return t&&t.push(r),r}return null},n.on=function(e,t,r){r===void 0&&(r=this),this._emitter.on(e,t,r)},n.once=function(e,t,r){r===void 0&&(r=this),this._emitter.once(e,t,r)},n.removeAllListeners=function(e){this._emitter.removeAllListeners(e)},n.off=function(e,t,r,i){r===void 0&&(r=this),this._emitter.off(e,t,r,i)},n.listeners=function(e){return this._emitter.listeners(e)},n.emit=function(e,t,r){return this._emitter.emit(e,t,r)},n.trigger=function(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(r){R.error("An internal error happened while handling event "+e+'. Error message: "'+r.message+'". Here is a stacktrace:',r),this.trigger(y.ERROR,{type:N.OTHER_ERROR,details:k.INTERNAL_EXCEPTION,fatal:!1,event:e,error:r})}return!1},n.listenerCount=function(e){return this._emitter.listenerCount(e)},n.destroy=function(){R.log("destroy"),this.trigger(y.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(t){return t.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(t){return t.destroy()}),this.coreComponents.length=0;var e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null},n.attachMedia=function(e){R.log("attachMedia"),this._media=e,this.trigger(y.MEDIA_ATTACHING,{media:e})},n.detachMedia=function(){R.log("detachMedia"),this.trigger(y.MEDIA_DETACHING,void 0),this._media=null},n.loadSource=function(e){this.stopLoad();var t=this.media,r=this.url,i=this.url=lt.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});R.log("loadSource:"+i),t&&r&&r!==i&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(t)),this.trigger(y.MANIFEST_LOADING,{url:e})},n.startLoad=function(e){e===void 0&&(e=-1),R.log("startLoad("+e+")"),this.networkControllers.forEach(function(t){t.startLoad(e)})},n.stopLoad=function(){R.log("stopLoad"),this.networkControllers.forEach(function(e){e.stopLoad()})},n.swapAudioCodec=function(){R.log("swapAudioCodec"),this.streamController.swapAudioCodec()},n.recoverMediaError=function(){R.log("recoverMediaError");var e=this._media;this.detachMedia(),e&&this.attachMedia(e)},n.removeLevel=function(e,t){t===void 0&&(t=0),this.levelController.removeLevel(e,t)},ee(s,[{key:"levels",get:function(){var e=this.levelController.levels;return e||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){R.log("set currentLevel:"+e),this.loadLevel=e,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){R.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){R.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){R.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){R.log("set startLevel:"+e),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(e){var t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping!==e&&(R.log("set autoLevelCapping:"+e),this._autoLevelCapping=e)}},{key:"bandwidthEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimate():NaN}},{key:"ttfbEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimateTTFB():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(e){pr.indexOf(e)>-1&&(this._maxHdcpLevel=e)}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var e=this.levels,t=this.config.minAutoBitrate;if(!e)return 0;for(var r=e.length,i=0;i<r;i++)if(e[i].maxBitrate>=t)return i;return 0}},{key:"maxAutoLevel",get:function(){var e,t=this.levels,r=this.autoLevelCapping,i=this.maxHdcpLevel;if(e=r===-1&&t&&t.length?t.length-1:r,i)for(var a=e;a--;){var o=t[a].attrs["HDCP-LEVEL"];if(o&&o<=i)return a}return e}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(e){this.config.lowLatencyMode=e}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.4.0"}},{key:"Events",get:function(){return y}},{key:"ErrorTypes",get:function(){return N}},{key:"ErrorDetails",get:function(){return k}},{key:"DefaultConfig",get:function(){return s.defaultConfig?s.defaultConfig:no},set:function(e){s.defaultConfig=e}}]),s}();return ta.defaultConfig=void 0,ta},Ne.exports=Pe()})(!1)})(vo);const mo=Qt,po=go({__proto__:null,default:mo},[Qt]);export{po as h};
